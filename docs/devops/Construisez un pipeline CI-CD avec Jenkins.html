<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-devops/Construisez un pipeline CI-CD avec Jenkins" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Construisez un pipeline CI-CD avec Jenkins | ON APPREND SANS CESSE</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://mossaabfrifita.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://mossaabfrifita.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://mossaabfrifita.github.io/docs/devops/Construisez un pipeline CI-CD avec Jenkins"><meta data-rh="true" property="og:locale" content="fr"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Construisez un pipeline CI-CD avec Jenkins | ON APPREND SANS CESSE"><meta data-rh="true" name="description" content="Jusqu&#x27;à présent, nous avons utilisé Maven pour construire notre application Spring Boot, Docker pour la containeriser dans un environnement isolé, SonarQube pour tester la qualité de notre code, et Nexus comme registre privé pour stocker et partager les images Docker. De plus, nous avons mis en place deux environnements, staging et production, pour déployer l&#x27;application avec Ansible."><meta data-rh="true" property="og:description" content="Jusqu&#x27;à présent, nous avons utilisé Maven pour construire notre application Spring Boot, Docker pour la containeriser dans un environnement isolé, SonarQube pour tester la qualité de notre code, et Nexus comme registre privé pour stocker et partager les images Docker. De plus, nous avons mis en place deux environnements, staging et production, pour déployer l&#x27;application avec Ansible."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://mossaabfrifita.github.io/docs/devops/Construisez un pipeline CI-CD avec Jenkins"><link data-rh="true" rel="alternate" href="https://mossaabfrifita.github.io/docs/devops/Construisez un pipeline CI-CD avec Jenkins" hreflang="fr"><link data-rh="true" rel="alternate" href="https://mossaabfrifita.github.io/docs/devops/Construisez un pipeline CI-CD avec Jenkins" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ea9770ca.css">
<script src="/assets/js/runtime~main.5a46b655.js" defer="defer"></script>
<script src="/assets/js/main.0cd224c4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/custom-logo.jpg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/custom-logo.jpg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mossaab Frifita</b></a><a class="navbar__item navbar__link" href="/docs/category/devops-cicd-pipeline">DevOps</a><a class="navbar__item navbar__link" href="/docs/category/spring-framework">Spring</a><a class="navbar__item navbar__link" href="/docs/category/angular">Angular</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/MossaabFrifita" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops-cicd-pipeline">DevOps CI/CD pipeline</a><button aria-label="Réduire la catégorie &#x27;DevOps CI/CD pipeline&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Ce que vous apprendrez">Ce que vous apprendrez</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Créez votre environnement de travail">Créez votre environnement de travail</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Installez et configurez Docker">Installez et configurez Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Créez une simple application Spring Boot">Créez une simple application Spring Boot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Installation et configuration de SonarQube et JaCoCo">Installation et configuration de SonarQube et JaCoCo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Conteneurisez l&#x27;application Spring Boot avec Docker">Conteneurisez l&#x27;application Spring Boot avec Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Créez un registre docker privé et un docker hub proxy avec Nexus">Créez un registre docker privé et un docker hub proxy avec Nexus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Utilisez Ansible pour automatiser le déploiement de votre application">Utilisez Ansible pour automatiser le déploiement de votre application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Gérez le Versioning en livraison continue">Gérez le Versioning en livraison continue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/devops/Construisez un pipeline CI-CD avec Jenkins">Construisez un pipeline CI-CD avec Jenkins</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/spring-framework">Spring Framework</a><button aria-label="Développer la catégorie &#x27;Spring Framework&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/angular">Angular</a><button aria-label="Développer la catégorie &#x27;Angular&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops-cicd-pipeline"><span itemprop="name">DevOps CI/CD pipeline</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Construisez un pipeline CI-CD avec Jenkins</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><header><h1>Construisez un pipeline CI-CD avec Jenkins</h1></header><p>Jusqu&#x27;à présent, nous avons utilisé Maven pour construire notre application Spring Boot, Docker pour la containeriser dans un environnement isolé, SonarQube pour tester la qualité de notre code, et Nexus comme registre privé pour stocker et partager les images Docker. De plus, nous avons mis en place deux environnements, <code>staging</code> et <code>production</code>, pour déployer l&#x27;application avec Ansible.</p>
<p>Ces étapes sont nécessaires à chaque modification du code. Afin d&#x27;automatiser ce processus, nous allons mettre en œuvre un pipeline CI/CD avec Jenkins.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installez-jenkins">Installez Jenkins<a href="#installez-jenkins" class="hash-link" aria-label="Lien direct vers Installez Jenkins" title="Lien direct vers Installez Jenkins">​</a></h2>
<p>Il existe plusieurs manière d&#x27;installer Jenkins, vous pouvez consulter la <a href="https://www.jenkins.io/doc/book/installing/" target="_blank" rel="noopener noreferrer">documentation officielle</a>, dans ce cours je vais l&#x27;installer directement sur le serveur <code>masterserver</code>.</p>
<p>Jenkins a besoin de Java pour fonctionner, installez <code>openjdk 17</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get update &amp;&amp; apt-get -y install openjdk-17-jdk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mossaabfr@masterserver:~$ java --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openjdk 17.0.9 2023-10-17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OpenJDK Runtime Environment (build 17.0.9+9-Ubuntu-122.04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OpenJDK 64-Bit Server VM (build 17.0.9+9-Ubuntu-122.04, mixed mode, sharing)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Installez ensuite la version LTS de Jenkins :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo wget -O /usr/share/keyrings/jenkins-keyring.asc \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  https://pkg.jenkins.io/debian-stable binary/ | sudo tee \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /etc/apt/sources.list.d/jenkins.list &gt; /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install jenkins</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Activez et démarrez le service Jenkins :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl start jenkins</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Par défaut Jenkins est accessible par le port <code>8080</code>, pour moi c&#x27;est <code>prod.local:8080</code>.</p>
<p>Lors de la première connexion à Jenkins, un mot de passe administrateur vous sera demandé. Vous pouvez le récupérer en consultant le contenu du fichier <code>initialAdminPassword</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat /var/lib/jenkins/secrets/initialAdminPassword</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Après avoir fourni le mot de passe, suivez les étapes d&#x27;initialisation suivantes :</p>
<ol>
<li>Choisissez l&#x27;option &quot;install suggested plugins&quot; pour installer les plugins recommandés.</li>
<li>Créez un utilisateur administrateur lorsque cela vous est demandé.</li>
<li>Enfin, configurez l&#x27;URL de votre serveur Jenkins. Dans mon cas, l&#x27;URL serait <code>http://prod.local:8080</code>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="quest-ce-quun-pipeline-jenkins-">Qu&#x27;est-ce qu&#x27;un pipeline Jenkins ?<a href="#quest-ce-quun-pipeline-jenkins-" class="hash-link" aria-label="Lien direct vers Qu&#x27;est-ce qu&#x27;un pipeline Jenkins ?" title="Lien direct vers Qu&#x27;est-ce qu&#x27;un pipeline Jenkins ?">​</a></h2>
<p>Un pipeline dans Jenkins est un ensemble d&#x27;étapes organisées de manière séquentielle, que le serveur Jenkins exécute pour accomplir les différentes tâches nécessaires au processus CI/CD telles que la compilation du code source, les tests, l&#x27;analyse statique du code, la construction d&#x27;artefacts, le déploiement sur des environnements spécifiques, etc.</p>
<p>Jenkins propose deux méthodes pour définir des pipelines : la méthode script et la méthode déclarative. Dans ce cours, nous allons utiliser <strong>la méthode déclarative</strong> qui offre une approche plus structurée et lisible pour définir les pipelines. Elle permet aux utilisateurs de décrire le flux de travail global de manière déclarative, en spécifiant les étapes, les paramètres et les conditions d&#x27;exécution sans la nécessité d&#x27;écrire un script complet.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="structure-de-base">Structure de Base<a href="#structure-de-base" class="hash-link" aria-label="Lien direct vers Structure de Base" title="Lien direct vers Structure de Base">​</a></h3>
<p>La méthode déclarative permet de définir les étapes du pipeline en créant un fichier texte appelé <code>Jenkinsfile</code> et en utilisant une syntaxe compatible avec <code>Groovy</code> . Il commence généralement par une déclaration du pipeline, suivie d&#x27;une section &quot;agent&quot; spécifiant l&#x27;agent sur lequel les étapes seront exécutés. Voici un exemple de structure de base :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Etape 1&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // Actions spécifiques de l&#x27;étape 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Etape 2&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // Actions spécifiques de l&#x27;étape 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Actions à effectuer après l&#x27;exécution des étapes principales</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vous pouvez tester la création d&#x27;un pipeline avec un exemple classique &#x27;Hello World&#x27; :</p>
<ol>
<li>Sur le tableau de bord, cliquez sur &#x27;Nouvel item&#x27;, choisissez un nom, par exemple, &quot;demoPipeline&quot;, et dans le type, choisissez <code>Pipeline</code>.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240121233926961" src="data:image/png;base64,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" width="934" height="117" class="img_ev3q"></p>
<ol start="2">
<li>Ensuite, dans la section &quot;Pipeline&quot;, choisissez l&#x27;exemple de &#x27;Hello World&#x27;.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240121231005520" src="/assets/images/image-20240121231005520-7fbcdb2318c67f0348400e3759e179a2.png" width="1065" height="711" class="img_ev3q"></p>
<ol start="3">
<li>Sauvegardez le pipeline et cliquez sur &#x27;Lancer un build&#x27; pour exécuter le pipeline manuellement. Après le build, vous pouvez consulter l&#x27;historique. Jenkins attribue un numéro unique, s&#x27;auto-incrémentant à chaque nouveau build.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240121231205880" src="/assets/images/image-20240121231205880-b9722df77991a3b503ed83d405b4e309.png" width="949" height="731" class="img_ev3q"></p>
<p>Pour notre application Spring Boot, nous allons inclure directement le fichier <code>Jenkinsfile</code> avec le code source, ce qui est d&#x27;ailleurs une meilleure pratique. De plus, vous allez configurer Jenkins pour détecter automatiquement les modifications du code source et déclencher le build.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="versionnez-votre-code-source">Versionnez votre code source<a href="#versionnez-votre-code-source" class="hash-link" aria-label="Lien direct vers Versionnez votre code source" title="Lien direct vers Versionnez votre code source">​</a></h2>
<p>Nous allons utiliser Git et GitHub pour versionner le code source de notre petite application Spring Boot.</p>
<ol>
<li>Créez un fichier vide pour le moment nommé <code>Jenkinsfile</code> à la racine du projet</li>
<li>Poussez le projet sur GitHub :</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git add .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit -m &quot;initial commit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git remote add origin git@github.com:MossaabFrifita/devops-jenkins-ci-cd.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git branch -M main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git push -u origin main</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="créez-un-pipeline-jenkins">Créez un pipeline Jenkins<a href="#créez-un-pipeline-jenkins" class="hash-link" aria-label="Lien direct vers Créez un pipeline Jenkins" title="Lien direct vers Créez un pipeline Jenkins">​</a></h2>
<ol>
<li>Créez un nouveau pipeline pour notre application, choisissez le type <code>pipeline</code> et spécifiez le nom, par exemple <code>devops-project-samples</code>.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240122111102223" src="/assets/images/image-20240122111102223-06c2cefe397c82cd6d4001bca72ada34.png" width="997" height="820" class="img_ev3q"></p>
<ol start="2">
<li>Dans la définition du pipeline, choisissez  <code>Pipeline script from SCM</code>et entrez l&#x27;URL de votre dépôt GitHub.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240122111432219" src="/assets/images/image-20240122111432219-3056149e43b48424290a43b0a6a7886d.png" width="1268" height="707" class="img_ev3q"></p>
<ol start="3">
<li>Ensuite, dans les &#x27;branches à construire&#x27;, ajoutez deux branches : <code>main</code> et <code>develop</code>. À chaque modification du code source, nous allons déployer la branche <code>main</code> sur le serveur de production (<code>prodserver</code>) et la branche <code>develop</code> sur le serveur de test (<code>testserver</code>).</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240122111651668" src="/assets/images/image-20240122111651668-b0e4a72593522731bd99d17179289363.png" width="1264" height="827" class="img_ev3q"></p>
<ol start="4">
<li>Enfin, sauvegardez le pipeline.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="créez-la-branche-de-développement-develop">Créez la branche de développement (develop)<a href="#créez-la-branche-de-développement-develop" class="hash-link" aria-label="Lien direct vers Créez la branche de développement (develop)" title="Lien direct vers Créez la branche de développement (develop)">​</a></h2>
<p>Vous allez créez la branche <code>develop</code> à partir de votre branche principe <code>main</code> pour commencer à écrire le pipeline :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git checkout -b develop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="définissez-les-étapes-du-pipeline">Définissez les étapes du pipeline<a href="#définissez-les-étapes-du-pipeline" class="hash-link" aria-label="Lien direct vers Définissez les étapes du pipeline" title="Lien direct vers Définissez les étapes du pipeline">​</a></h2>
<p>Les étapes du pipeline doivent être écrites dans le fichier <code>Jenkinsfile</code> que vous avez créé. Si vous utilisez IntelliJ comme IDE, vous pouvez le configurer pour qu&#x27;il reconnaisse le type de fichier. Cela peut inclure la coloration syntaxique, l&#x27;auto-complétion et d&#x27;autres fonctionnalités pour faciliter l&#x27;écriture et la gestion du pipeline.</p>
<p>Dans l&#x27;onglet &#x27;File &#x27;=&gt; &#x27;settings &#x27;=&gt; &#x27;editor &#x27;=&gt; &#x27;file type&#x27; =&gt; &#x27;groovy &#x27;: ajoutez le pattern &#x27;Jenkinsfile&#x27;</p>
<p><img decoding="async" loading="lazy" alt="image-20240207123143066" src="/assets/images/image-20240207123143066-45082da485937769e4e562701f2a9f56.png" width="897" height="498" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="définissez-les-variables-denvironnement">Définissez les variables d&#x27;environnement<a href="#définissez-les-variables-denvironnement" class="hash-link" aria-label="Lien direct vers Définissez les variables d&#x27;environnement" title="Lien direct vers Définissez les variables d&#x27;environnement">​</a></h3>
<p>Nous aurons besoin de définir des variables d&#x27;environnement spécifiques qui seront utilisées dans le pipeline :</p>
<ul>
<li><code>BRANCHE_DEV</code> définit le nom de la branche de développement qui sera déployée sur le <code>testserver</code>.</li>
<li><code>BRANCHE_PROD</code> définit le nom de la branche de production qui sera déployée sur le <code>prodserver</code>.</li>
<li><code>NEXUS_DOCKER_REGISTRY</code> définit l&#x27;URL du registre Docker privé.</li>
<li><code>DOCKER_IMAGE_NAME</code> définit le nom de l&#x27;image Docker à construire.</li>
<li><code>DOCKER_IMAGE_TAG</code> définit le tag de l&#x27;image Docker.</li>
</ul>
<blockquote>
<p>Remarque : Jenkins expose des variables d&#x27;environnement accessibles via la variable globale <code>env</code>, telles que <code>BUILD_ID</code> et <code>JOB_NAME</code>. Vous pouvez en savoir plus dans la documentation officielle sur <a href="https://www.jenkins.io/doc/book/pipeline/jenkinsfile/#using-environment-variables" target="_blank" rel="noopener noreferrer">l&#x27;utilisation des variables d&#x27;environnement</a>.</p>
</blockquote>
<p>Ajoutez le bloc <code>environment</code> à votre pipeline :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BRANCHE_DEV = &#x27;origin/develop&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BRANCHE_PROD = &#x27;origin/main&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NEXUS_DOCKER_REGISTRY = &quot;http://prod.local:5003&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DOCKER_IMAGE_NAME = &quot;api-demo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DOCKER_IMAGE_TAG = &quot;prod.local:5003&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="récupérez-le-code-source">Récupérez le code source<a href="#récupérez-le-code-source" class="hash-link" aria-label="Lien direct vers Récupérez le code source" title="Lien direct vers Récupérez le code source">​</a></h3>
<p>Ce stage sert à récupérer le code source du projet depuis le référentiel Git :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stage(&#x27;Checkout&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        checkout scm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        echo &#x27;Pulling... &#x27; + env.GIT_BRANCH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La variable environnement  <code>env.GIT_BRANCH</code> contient le nom de la branche à partir de laquelle le code est récupéré.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exécutez-les-tests-unitaires">Exécutez les tests unitaires<a href="#exécutez-les-tests-unitaires" class="hash-link" aria-label="Lien direct vers Exécutez les tests unitaires" title="Lien direct vers Exécutez les tests unitaires">​</a></h3>
<p>Ce stage permet d&#x27;exécuter les tests unitaires avec Maven, il faut que Maven soit installé sur le serveur <code>masterserver</code></p>
<p>Pour ce cours je l&#x27;ai installé directement depuis le terminal avec la commande <code>sudo apt-get install maven</code>, vous pouvez aussi l&#x27;installer automatiquement via l&#x27;interface graphique de Jenkins, en accédant à  &#x27;Administrer Jenkins &gt; Tools&#x27;</p>
<p><img decoding="async" loading="lazy" alt="image-20240207174128816" src="/assets/images/image-20240207174128816-83c6a44ff7eba878042d398d6eb78f1d.png" width="803" height="644" class="img_ev3q"></p>
<blockquote>
<p>Si vous installez Maven depuis Jenkins, vous devrez spécifier la version de Maven que vous souhaitez utiliser dans votre pipeline dans la section Tools. Vous pouvez suivre ce <a href="https://www.jenkins.io/blog/2017/02/07/declarative-maven-project/" target="_blank" rel="noopener noreferrer">lien</a> dans la documentation officielle pour plus d&#x27;informations à ce sujet.</p>
</blockquote>
<p>Ajoutez le stage des tests unitaires à votre pipeline :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stage(&#x27;Tests&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sh &#x27;mvn test&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testez-la-qualité-de-votre-code-avec-sonarqube">Testez la qualité de votre code avec SonarQube<a href="#testez-la-qualité-de-votre-code-avec-sonarqube" class="hash-link" aria-label="Lien direct vers Testez la qualité de votre code avec SonarQube" title="Lien direct vers Testez la qualité de votre code avec SonarQube">​</a></h3>
<p>A chaque exécution du pipeline, nous voulons nous assurer que le code respecte bien les règles de qualité définies dans SonarQube. Vous avez déjà testé l&#x27;analyse de code. Maintenant, dans votre pipeline, vous allez intégrer SonarQube.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="intégrez-sonarqube-avec-jenkins">Intégrez SonarQube avec Jenkins<a href="#intégrez-sonarqube-avec-jenkins" class="hash-link" aria-label="Lien direct vers Intégrez SonarQube avec Jenkins" title="Lien direct vers Intégrez SonarQube avec Jenkins">​</a></h3>
<ol>
<li>Installez le plugin <code>SonarQube Scanner</code> depuis &#x27;Administrer Jenkins &gt; Plugins&#x27; :</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240207182947526" src="/assets/images/image-20240207182947526-9a14f11cb40591a8b80ef86ef49d067a.png" width="915" height="380" class="img_ev3q"></p>
<blockquote>
<p>Comme indiqué dans la section de SonarQube, pour pouvoir envoyer le rapport d&#x27;analyse au serveur, il faut un token d&#x27;autorisation. Vous pouvez utiliser celui que vous avez généré, ou en générer un nouveau si vous ne l&#x27;avez pas noté.</p>
</blockquote>
<ol start="3">
<li>Dans &#x27;Administrer Jenkins &gt; Credentials,&#x27; cliquez sur &#x27;Domains (global)&#x27; ensuite &#x27;Add credentials&#x27;</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240207183837645" src="/assets/images/image-20240207183837645-78b38faca4fa49bae690eae4e0095c0d.png" width="923" height="209" class="img_ev3q"></p>
<ol start="4">
<li>Ensuite, ajoutez un credentials de type <code>Secret text</code> et donnez-lui un ID, par exemple <code>sonar-token</code></li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240207183359090" src="/assets/images/image-20240207183359090-8ea331e815d3c05d052d5d50085f906b.png" width="972" height="587" class="img_ev3q"></p>
<ol start="5">
<li>
<p>Pour pouvoir communiquer avec le serveur SonarQube dans le pipeline, vous devez le configurer dans &#x27;Administrer Jenkins &gt; System&#x27; :</p>
<ul>
<li>
<p>Choisissez un nom de votre choix, par exemple <code>sonar-server</code>.</p>
</li>
<li>
<p>Ajoutez l&#x27;URL du serveur. Dans mon cas, il est installé sur le <code>masterserver</code> et donc accessible via <code>http://prod.local:9000</code>.</p>
</li>
<li>
<p>Sélectionnez le token d&#x27;authentification que vous avez créé.</p>
</li>
</ul>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240207224745544" src="/assets/images/image-20240207224745544-34f95b13e7420b2bf9d449c226cc15d6.png" width="964" height="642" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sonarqube-webhooks">SonarQube Webhooks<a href="#sonarqube-webhooks" class="hash-link" aria-label="Lien direct vers SonarQube Webhooks" title="Lien direct vers SonarQube Webhooks">​</a></h3>
<p>Les webhooks de SonarQube permettent de notifier des services externes lorsque l&#x27;analyse d&#x27;un projet est terminée. Une requête HTTP POST, contenant un payload JSON, est envoyée à chaque URL configurée comme webhook. Cela permet à Jenkins de recevoir le résultat de l&#x27;analyse et de mettre fin au build si les règles de qualité du code ne sont pas respectées.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sonarqube-scanner-pour-jenkins">SonarQube Scanner pour Jenkins<a href="#sonarqube-scanner-pour-jenkins" class="hash-link" aria-label="Lien direct vers SonarQube Scanner pour Jenkins" title="Lien direct vers SonarQube Scanner pour Jenkins">​</a></h3>
<p>Après avoir configuré le serveur SonarQube, le plugin offre deux fonctionnalités que vous allez utiliser dans votre pipeline :</p>
<ul>
<li><code>withSonarQubeEnv</code> : Permet de configurer l&#x27;environnement du pipeline pour utiliser les paramètres de connexion au serveur SonarQube que vous avez configuré.</li>
<li><code>waitForQualityGate</code> : Permet de mettre en pause l&#x27;exécution du pipeline jusqu&#x27;à ce que SonarQube termine l&#x27;analyse du projet. Elle écoute sur l&#x27;URL <code>Jenkins_instance_url/sonarqube-webhook</code> pour recevoir le résultat de l&#x27;analyse du code.</li>
</ul>
<p>Du côté de SonarQube, pour le projet <code>devops-project-samples</code>, vous allez configurer un webhook qui pointe vers <code>/sonarqube-webhook</code> :</p>
<ol>
<li>Dans le serveur SonarQube, sélectionnez le projet <code>devops-project-samples</code>, puis allez dans &#x27;Project Settings &gt; Webhooks&#x27;</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240208110903053" src="/assets/images/image-20240208110903053-53d258fa6a9f8002f77631a897073b8f.png" width="1091" height="606" class="img_ev3q"></p>
<ol start="2">
<li>
<p>Cliquez sur &#x27;Create&#x27; pour créer un nouveau Webhook :</p>
<ul>
<li>Entrez un nom, par exemple <code>JenkinsWebhooks</code>.</li>
<li>Entrez l&#x27;URL du serveur Jenkins. J&#x27;ai utilisé directement l&#x27;adresse IP du serveur <code>masterserver</code> au lieu du nom de domaine <code>prod.local</code>, car le serveur SonarQube s&#x27;exécute dans un conteneur Docker et ne peut pas résoudre le nom de domaine que j&#x27;ai configuré manuellement sur le serveur, à moins que je ne le configure également. J&#x27;ai donc simplement utilisé l&#x27;adresse IP pour la démo.</li>
</ul>
</li>
<li>
<p>Cliquez sur &#x27;Create&#x27; pour sauvgarder.</p>
<p><img decoding="async" loading="lazy" alt="image-20240208111312483" src="/assets/images/image-20240208111312483-24963eb16a2ab123826013e0071ac8a5.png" width="444" height="516" class="img_ev3q"></p>
</li>
</ol>
<p>Voici un exemple d&#x27;une requête POST envoyée au serveur Jenkins contenant les informations sur le résultat de l&#x27;analyse, y compris le statut</p>
<p><img decoding="async" loading="lazy" alt="image-20240208101107955" src="/assets/images/image-20240208101107955-c1fc56c3f7cc377ea6b74d276db38abf.png" width="470" height="545" class="img_ev3q"></p>
<p>Il est maintenant temps d&#x27;ajouter le stage SonarQube dans votre pipeline :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stage(&#x27;Sonarqube Analysis&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            withSonarQubeEnv(&#x27;sonar-server&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &quot;mvn sonar:sonar -Dintegration-tests.skip=true -Dmaven.test.failure.ignore=true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            timeout(time: 1, unit: &#x27;MINUTES&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                def qg = waitForQualityGate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (qg.status != &#x27;OK&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    error &quot;Pipeline aborted due to quality gate failure: ${qg.status}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La fonction <code>timeout</code> permet de définir une limite de temps pour l&#x27;exécution du bloc de code qui suit. Si le serveur SonarQube ne répond pas dans le délai spécifié, le pipeline ne reste pas bloqué dans la fonction <code>waitForQualityGate()</code> et passe à l&#x27;étape suivante. Ensuite, si le statut retourné par la fonction <code>waitForQualityGate()</code> n&#x27;est pas &quot;OK&quot;, une erreur est déclenchée pour interrompre le pipeline.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="packagez-le-projet-avec-maven">Packagez le projet avec Maven<a href="#packagez-le-projet-avec-maven" class="hash-link" aria-label="Lien direct vers Packagez le projet avec Maven" title="Lien direct vers Packagez le projet avec Maven">​</a></h3>
<p>Dans ce stage, vous allez simplement packager l&#x27;application Spring Boot en un Jar avec Maven et archiver le Jar généré :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stage(&#x27;Maven Build and Package&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sh &#x27;mvn clean package -DskipTests&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        success {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            archiveArtifacts &#x27;target/*.jar&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="générez-la-version-du-projet-à-chaque-build">Générez la version du projet à chaque build<a href="#générez-la-version-du-projet-à-chaque-build" class="hash-link" aria-label="Lien direct vers Générez la version du projet à chaque build" title="Lien direct vers Générez la version du projet à chaque build">​</a></h3>
<p>Pour mieux gérer le versioning lors de la livraison continue, nous devons générer la version du projet à chaque exécution du pipeline.</p>
<p>Petit rappel : la version correspond à :</p>
<div class="language-apl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-apl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MAJEUR.MINEUR.CORRECTIF-ENV.NumeroBuild.CommitGit-Id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>MAJEUR.MINEUR.CORRECTIF</code> : Cette partie sera récupérée à partir du fichier POM.xml.</li>
<li><code>ENV</code> est soit <code>prod</code> ou <code>dev</code>, en fonction de la branche GIT courante à partir de laquelle Jenkins récupère le code.</li>
<li><code>NumeroBuild</code> peut être obtenu avec <code>env.BUILD_NUMBER</code>.</li>
<li>L&#x27;ID du commit le plus récent sur la branche actuelle peut être obtenu avec <code>git rev-parse HEAD</code>.</li>
</ul>
<p>Pour lire le fichier pom.xml du projet, nous avons besoin de la fonction <code>readMavenPom</code> du <a href="https://www.jenkins.io/doc/pipeline/steps/pipeline-utility-steps" target="_blank" rel="noopener noreferrer">plugin</a> <code>Pipeline Utility Steps</code>. Elle retourne un objet de type <code>Model</code> du package <code>org.apache.maven.model.Model</code> (<a href="https://maven.apache.org/components/ref/3.3.9/maven-model/apidocs/org/apache/maven/model/Model.html" target="_blank" rel="noopener noreferrer">Documentation Maven Model</a>).</p>
<p>En utilisant cet objet, nous pouvons manipuler diverses propriétés du projet Maven. Voici quelques-unes des méthodes disponibles :</p>
<ul>
<li><strong>getVersion() :</strong> Retourne la version actuelle de l&#x27;artefact produit par le projet.</li>
<li><strong>setVersion(String version) :</strong> Permet de définir la version courante de l&#x27;artefact produit par le projet.</li>
<li><strong>getArtifactId() :</strong> Retourne l&#x27;identifiant de l&#x27;artefact.</li>
<li><strong>setArtifactId(String artifactId) :</strong> Permet de définir l&#x27;identifiant de l&#x27;artefact.</li>
<li><strong>getName() :</strong> Retourne le nom du projet.</li>
<li><strong>setName(String name) :</strong> Permet de définir le nom du projet.</li>
</ul>
<ol>
<li>
<p>Installez le plugin <code>Pipeline Utility Steps</code></p>
<p><img decoding="async" loading="lazy" alt="image-20240208134323703" src="data:image/png;base64,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" width="795" height="91" class="img_ev3q"></p>
</li>
<li>
<p>Dans le fichier Jenkins et après la section <code>pipeline { }</code>, ajoutez la fonction suivante qui prend en paramètre le nom de l&#x27;environnement et retourne la version :</p>
</li>
</ol>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def getEnvVersion(envName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def pom = readMavenPom file: &#x27;pom.xml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // get the current development version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    artifactVersion = &quot;${pom.version}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def gitCommit = sh(returnStdout: true, script: &#x27;git rev-parse HEAD&#x27;).trim()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def versionNumber;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (gitCommit == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        versionNumber =artifactVersion+&quot;-${envName}.&quot;+env.BUILD_NUMBER;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        versionNumber =artifactVersion+&quot;-${envName}.&quot;+env.BUILD_NUMBER+&#x27;.&#x27;+gitCommit.take(8);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print &#x27;build ${environnement} versions...&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print versionNumber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return versionNumber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conteneurisez-lapplication-et-envoyez-limage-docker-vers-nexus">Conteneurisez l&#x27;application et envoyez l&#x27;image Docker vers Nexus<a href="#conteneurisez-lapplication-et-envoyez-limage-docker-vers-nexus" class="hash-link" aria-label="Lien direct vers Conteneurisez l&#x27;application et envoyez l&#x27;image Docker vers Nexus" title="Lien direct vers Conteneurisez l&#x27;application et envoyez l&#x27;image Docker vers Nexus">​</a></h3>
<p>Dans ce stage, vous allez créer une image docker de votre application Spring Boot, la tager avec la version et l&#x27;enregistrer dans le registre docker privé de Nexus</p>
<p>Pour pouvoir se connecter au registre Nexus, ajoutez un nouveau Credentials de type Nom d&#x27;utilisateur et mot de passe.</p>
<p>Donne lui un ID, par exemple <code>nexus-credentials</code></p>
<p><img decoding="async" loading="lazy" alt="image-20240208135724443" src="/assets/images/image-20240208135724443-9990576ce927152e939dc4c38709e7eb.png" width="814" height="746" class="img_ev3q"></p>
<p>Dans le bloc <code>environnement</code>, ajoutez la variable suivante :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NEXUS_CREDENTIALS_ID = &quot;nexus-credentials&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ensuite, ajoutez le stage suivant :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stage(&#x27;Docker Build and Push to Nexus&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            envName = &quot;dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if(env.GIT_BRANCH == BRANCHE_PROD) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                envName = &quot;prod&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            envVersion  =  getEnvVersion(envName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            withCredentials([usernamePassword(credentialsId: &quot;${NEXUS_CREDENTIALS_ID}&quot;, usernameVariable: &#x27;USER&#x27;, passwordVariable: &#x27;PASSWORD&#x27;)]){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;echo $PASSWORD | docker login -u $USER --password-stdin $NEXUS_DOCKER_REGISTRY&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;docker system prune -af&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &quot;docker build -t $DOCKER_IMAGE_TAG/$DOCKER_IMAGE_NAME:$envVersion --no-cache --pull .&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &quot;docker push $DOCKER_IMAGE_TAG/$DOCKER_IMAGE_NAME:$envVersion&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La condition <code>if</code> permet de déterminer l&#x27;environnement cible en fonction de la branche GIT.</p>
<p><code>envVersion</code> stocke la version obtenue en appelant la fonction <code>getEnvVersion()</code>.</p>
<p><code>withCredentials([...]) { ... }</code> utilise les identifiants fournis pour se connecter au registre Docker.</p>
<p>Les instructions suivantes sont de simples commandes shell pour se connecter au registre, nettoyer les éléments inutilisés dans le système Docker comme les images précédemment construites, construire la nouvelle image Docker et la pousser vers le registre Nexus.</p>
<p>Finalement, pour pouvoir utiliser docker dans le pipeline jenkins, installez le plugin <code>Docker Pipeline</code></p>
<p>Ensuite, ajoutez l&#x27;utilisateur Jenkins au groupe Docker</p>
<p>Le groupe Docker est un groupe d&#x27;utilisateurs sur un système Linux qui a le droit d&#x27;interagir avec le démon Docker. Lorsqu&#x27;un utilisateur est ajouté au groupe Docker, cela lui donne la permission d&#x27;exécuter des commandes Docker sans avoir à utiliser <code>sudo</code> :</p>
<p>Dans le serveur <code>masterserver</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo usermod -aG docker jenkins</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Redémarrez Jenkins :</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo service jenkins restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="déployez-lapplication-avec-ansible">Déployez l&#x27;application avec Ansible<a href="#déployez-lapplication-avec-ansible" class="hash-link" aria-label="Lien direct vers Déployez l&#x27;application avec Ansible" title="Lien direct vers Déployez l&#x27;application avec Ansible">​</a></h3>
<p>Pour déployer l&#x27;application, il suffit de se connecter au serveur Ansible <code>nodemanager</code> et lancer le playbook <code>deploy_playbook.yml</code> que vous avez créé.</p>
<p>Vous allez donc se connecter en SSH au <code>nodemanager</code>.</p>
<p>Dans le <code>masterserver</code>, générez une paire de clés SSH :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -o -t rsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vous aurez donc la clé publique et privée :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mossaabfr@masterserver:~$ ls .ssh/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">id_rsa  id_rsa.pub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Utilisez <code>ssh-copy-id</code> pour copier la clé publique sur le <code>nodemanager</code>, puis testez que vous pouvez bien vous connecter en SSH :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mossaabfr@masterserver:~/.ssh$ ssh-copy-id -i id_rsa.pub user-ansible@192.168.1.173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;id_rsa.pub&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The authenticity of host &#x27;192.168.1.173 (192.168.1.173)&#x27; can&#x27;t be established.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ED25519 key fingerprint is SHA256:of8XJ1A+0vYWv+GUwrLlTLo+Gw3WIBmX3ejD5N32eqw.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This key is not known by any other names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user-ansible@192.168.1.173&#x27;s password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Number of key(s) added: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Now try logging into the machine, with:   &quot;ssh &#x27;user-ansible@192.168.1.173&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and check to make sure that only the key(s) you wanted were added.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mossaabfr@masterserver:~/.ssh$ ssh user-ansible@192.168.1.173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last login: Sat Jan 13 22:47:34 2024 from 192.168.1.196</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ~]$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Installez le plugin <a href="https://plugins.jenkins.io/ssh-agent" target="_blank" rel="noopener noreferrer">SSH Agent Plugin</a> pour pouvoir établir une connexion SSH au <code>nodemanager</code> dans votre pipeline.</p>
<p><img decoding="async" loading="lazy" alt="image-20240208153315843" src="data:image/png;base64,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" width="795" height="82" class="img_ev3q"></p>
<p>Dans &#x27;Admintrer Jenkins &gt; Credentials&#x27;, ajoutez un nouveau credentials de type <code>SSH Username with private key</code></p>
<p><img decoding="async" loading="lazy" alt="image-20240208154337935" src="/assets/images/image-20240208154337935-c7fd712080133e274fa6918d8abebec6.png" width="912" height="811" class="img_ev3q"></p>
<p>Donnez-lui un ID, par exemple <code>ansible-node-manager</code>, et copiez la clé privée en utilisant la commande <code>cat id_rsa</code> dans le champ &#x27;Private Key&#x27;</p>
<p>Pour tester la connexion SSH au <code>nodemanager</code> avant de modifier votre pipeline, vous pouvez créer un autre pipeline :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;ssh cnx&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sshagent(credentials: [&#x27;ansible-node-manager&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      sh &#x27;[ -d ~/.ssh ] || mkdir ~/.ssh &amp;&amp; chmod 0700 ~/.ssh&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      sh &#x27;ssh-keyscan -t rsa,dsa 192.168.1.173 &gt;&gt; ~/.ssh/known_hosts&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      sh &#x27;ssh user-ansible@192.168.1.173&#x27;      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La commande <code>ssh-keyscan</code> permet d&#x27;ajouter automatiquement le <code>fingerprint</code> au fichier <code>known_hosts</code> de l&#x27;utilisateur Jenkins afin de faciliter les connexions SSH ultérieures sans être invité à valider manuellement la clé chaque fois.</p>
<p>Exécutez le pipeline pour tester la connexion SSH :</p>
<p><img decoding="async" loading="lazy" alt="image-20240208155100533" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXoAAAD2CAIAAABXx9vQAAAgAElEQVR4nO3de3gTdb4/8M8kTZq0TbmUCAULFdq0RRGWijfAYqFQaQmK2uVwVhetN24u9139uezvsHu8FKQgIqzKrqurh9WDSAwsFYotBUFKEEGgTatWCg2QlkKvNMlkzh+TpOklvUA6kybv18PjMzOZzHwTyNvvbWYYjuMIAKDnScQuAAAECsQNAAgEcQMAAkHcAIBAAjFuKj+bf/uQaLU6NnFRTqXYhQEIHG3jxlrx7fuLpkzQDB2hVker1dHqQQmasTOeWn/kqgjF65rCVXfwRVVH37X6bJuXrZ/NcX6WYQt3WUreXbf7soWIrOe2rfv7z8IXFyBAtYwbi+mT3949Nv0v274/X93IOjayjdXlp/T/zLsgfOm6aNz0aRGOxV/2fVXW+uUDuYccnyUkZUaKPPa5Vx4dKici2dDZS5+6TbhiAgS4FnFzeu1/Lt1dzXral9d4pajgf1YvzJgwfNrq0z1ZtG64d1Zaf8fi2a++ON/yxUO5eQ38UkjKI8lyogFpbxoulJnNJYaN0wYIWk6AgOYeN0f+9uFPjqyRDn/yw69LL5SZzWXnig7t2fLC5BiFYy/98omzXtr4r6PFtY1CF9az8bNSnfWb07l7rrm/dDr3YBW/FJL8SIpM4IIBgIt73JhMVc7FB1547aHb+siJiJQRQxIf/cO2bYtvF7xw3TBem+bMm8L9+y3NL5zdrjvHL4WkzEiRC14wAHByj5vw8BDn4td/zthc3Kb2smOOOlo9f79z9dzGSdFqdbR6zg4iosbi7auXaSckOvuYRwzVpMxem1dhaXGIxrOfLJpy79BB0Wr1iKF3/nptYeNncxy9vOq7XndrnFkrcjfMnjBm6KBotTp60NAxE2ZvyK2wev4gze0p9lBenmvz+a/zfuGXHC0pIjq9+oH2zkiWiry1s1Mc5R+UoJkwd22uyUJEdHb1XY5Cxi874ty9eeOgOTscn9LyaYaj0zrjfd/tWgcQh3vcPDDrIZVzufbQqmkxiXNXbz99zdLO29qhf+OFjdsPF1c5+5jZxuqS3DfmTpy7wzXYbDnxevKDL2/7/mIjS0Rso+nbN2b89sPqtseqyls2bezs7Nziq/zB2MarxbnZs8dOW33CY+I0t6caCnIOOTZe3ZN3il/qrCVVmfdy0ti5b+SWVDtPWV2c98bsCUmrT1ooYXKSI8uqvjvu6BpqDjJijxcW8kuFJ07yC6Mmpfbt4GwAgcg9bmRT3/p4UYzUtW45l7fxhbS4UY+udvxPvkOysOEzln6054ijx8fwako4EVHN3tfW8r9FS+6Lj24pbdURzR49cqz1kSrfnzeb70UamL7ZcNZsPmt4MzmciNifNv7mz4WeCtDcnrqS86WBiIise/fzC521pCr/8dTsT0pZIrpl5uaCc83lZ0s3PrOqkMZPm+io+Z06fMBCRGQ5cPiU6+1V3xeeJyI6X/g93x4dNunBWz2fDSAwtRwIl9+5Kv/gtkWJ/Zszh9grho2zH5jy6kkLPfKJucz8TrLzlaGL8srM5jLzJ48QET381rd/ezE1cVAfufWa6UKlWX3LEH63y/l7S4jo6ifvfVHDb5HGPPme4VyZ2Xz2wOp7w1sXybB2/VGWiChk5hvZjw1VEimHPrl4ThQREV3K1Z3w9FnunTbJkQmX9u09TeQ2BN7ckmpX4dpNRxyn/PM7j0UpiZRD56ycw3+Ay1/pTtKkSeMd38lpQyERUd4BAxFFRPC1ntPfHLAS0bHvioiIqH/S5ATPZwMIUG2m+ckjJ6/aXvxzwYe/nzS0+QdqPZu98PWOh70tpty1cydoEgapY2PuHD829dmPnRPurDYbER09ctJRs4n49do3U4YqiUiZMO+j11OkLY5z/tujl/ilhp1zYx2dLGrtlnJ+44UfSzwWYeqsFEfe/FKw97zbEHgnLamKQ0cvO0/5/BDnjMGULY6ZRuU//kjy5ORx/NqV7woriI7k5DUQUezD6TFERPTtgQNEZ0+eZomIIlJnje/oqwIITB4uYlBGPbT8A0Npzurxrt6cc//e6fmHTlWfzZ06+4284upGVqrsNyAiavQDYwa22ONajWP2C40d5/ZjlMWOGNRqv5pufQJ3U7UPOfLmdO6ea4c+38M3bTobk+rKKfukTnYMzZ357jidzsuvIqLbJy+cfn8EEVHDscLTllM//EJEFDJpMtIGoC33uNG/uqygxTVEyrh5/z8jyrnGV1LaV7jhv/bWEhFFzNr281njWcPxfVufGulhZ2OxWz3p2rETnqYrh8z8oMRsLmv155PHO/g4k2c586Zw/3u531zhj9NxS6rlKf96oc0Z+dbirSkThxEREXvqu117C34homETU25NvHeslIjol+OH9/H9xNLxkx/o2tkAAot73Fh/+PCJ0YnzNxcYqxqJiBqrTmx/9+sK58vh4X2IiPqonMPllT8YnF3IZecdDaBG84VqK1HjuX//aeOBFme6847hjqVf3nvmj0evWYgsNac2P//akRa70e3j7nKcoGHni09sNlzhx+Mbq05s/8OjS77o5PO42lNs0Y4vSomoK7P7Eu5tPuXyjM0nqhynvGLYvmr6Er2zYDO1fN6UGz8+WkREIXeNu51kKcmJRERk+GwD30+cmIzJhADtCWq1bjm3e9Ws3ava7ii9XfvwYCKiYVGDiUqJiBq+XnbfkGVEKdnmjCApEUtEDQXLRscuIyKSSlv2ycTNmZmQnX2WiIgt3ZIRs8VxXKnjnS6TM//jlu1bLxMR1RxZlTrWvTApiZ19oKnah0J2bm8gKr/A9/Z0ZXbf1MzHBm7/8BIRUe2hVQ/Htzjlr5xLCZOT+m/88ApRwd695KrF9L1v7DA6+guxRUU/E2EIHMCjrt2AQtpv+sYPF0cTEVFc2owYaesdpv/64ZYjTNKYefOTW+4TPf+tRcNbvVMa8+yzrpaHo/pE41a/vyThhisIze0pIupqS2rcH/+5JK7T3ZqHw4maazG3T0riu28aGogoYXoahsAB2uUeN+mb929YlD4qqp/SGQoy1YDY+55+RX/86D8ed14jQAkvf/nBovsHKd2TQz75rYK3nx6tlhORVBl5/5Iv9y9vMxQsG7Mq5+CGR0dHKqVEJFUOn7xk25fzhrkmLw+KdPxQ5Xe+fODkgTcfHR0V5ogAqbJf1KjZqz9bO7PzjzRpRnJzKHT1OinZmJdzSg+8Onv0rarmU946evYr+rXpbod2DYe712Kc3TdEREOnPDSsC6cDCESMyE9iKHsn+d6sU/zw8ZPbit68V8zCAEBPEvRufl8sSV20+ZsivifWUvPTv1+fPu3NU46Om1seno2sAfBngtZuPpsTPX9v+y+Fp2R/+8kjuPsMgB/ziXsVh49duf0DZA2AnxM0bu7+zQuT4yKcfbEkV0XE3ffE6s8LfsiZPwZ3ogHwd2J3FQNAwPCJxhQABALEDQAIBHEDAAJB3ACAQBA3ACAQxA0ACARxAwACQdwAgEAQNwAgEMQNAAgEcQMAAkHcAIBAEDcAIBDEDQAIBHEDAAJB3ACAQBA3ACAQxA0ACARxAwACQdwAgEAQNwAgEMQNAAgkSOwCAHgZnmXkaxiGcSzg7wb8hvs/ZvzD9gWuoOGXETfgJ1z/kjmO45fxb1tcfNYwDIPaDfgVV77wC3a7nZA7ImmVMhKJxLWKvhvo9dyzhuO4pia2zS5M23dBD+OIuKAg4jiOTxxCVzH4E47j+HoNyzaJXRYgqTTYZrPxWSORSFC7gV7PvWpjt9tZluWnd8jlcrGLFtAsFgsRWa3WoCBHyCBuwH+4EgezyXyH1WolIoZhJBIJx3H4i4Fez9Vr46zdgK+w2Wwsy7Isa7fbETfgP9xqN+Ar+LjhswZxA36CcyN2WaCZe9YgbsCvIG58jd1ud8UNoVMN/AZqNz6IawlxAwA9pVX6I27Ar6B242vcq5yIGwAQCOIGAASCuAEAgSBuAEAgiBsAEAjiBgAEgrgBAIEgbgBAIIgbABAI4gYABIK4AQCBIG4AxGB8OzkqPipqsV7sgggJcQMAAkHcAIBAEDcA3qefFx8V5fiTvK603S0OjlZVfNS8PV06lKsV1vKNzt0crTPHqodjigVxA+BlxnXp8/SdbHHaM2/y2yX8ov7tdcZWr5auS4738MbSdS+43rh4np7SN+uXxBLRnnXrSvktFLswd3PqTXwO70PcAPSQ1M3lReXlRfuXxnjeQumbi8rL16cTEZWWtIob/dvZJUQUsyS3qLz1G0vjlrreyItZumVhLFFJ9uLkdXuIYpZsWajpqY92gxA3AF6mWbownYhoz7yo+Kio+Hn6drY4paalE1FMbGw7xzEaS4mIYlPT24mNFm8s5vfULNyyJIaotKSEKH3hUl8LG8QNQA9w1GI2pxMR6de9bWxnS+c0mhgiopI9esfee9a5d/q0ZXz7hWznDnx7yscgbgC8zNW56/jBx8UY22zpUs0jfeGSWCIqzZ7cohvYA0dvTuwSfe6SGCLSz/O5ST2IG4Ce1La/ths9uDFL9/MdwA5xmhhPu+rnpWeXEMUu3LI0RrN0Pd9tPM/HRqYY3LkeejXXs3ptNpvVam1qalIqVSzbJJfLxS5aQLNYLFJpsMlUrlAoFApFcHCwTCZD7QYABIK4AQCBIG4AQCCIGwAQCOIGAASCuAEAgSBuAEAgiBsAEAjiBgAEgrgBAIEgbgBAIIgbABAI4gYABIK4AQCBIG4AQCCIGwAQCOIGAASCuAEAgQSJXQAA77NYLFVVVWKXIqCpVCqlMrjVRtRuwA81NTWJXYRA1+5fAWo34Ifkcjluje6DULsB/4RHjIjI05ePuAEAgSBuAEAgiBsAEAjiBgAEgrgBAIEgbgBAIIgbABAI4gYABIK4AQCBIG4AfEDOSyNHjnP8WbJP7NL0FMQNgOh+2vQ2ZZ8pPHOm8MyZfy0ofWlJjtgl6hkMLi2BXo3jOI7j7Ha7zWazWq1NTU1KpaqhoYbjOIZhxC7dDcl5aeSeyWeyp4hdjhvHf/khIeEmU7lCoVAoFMHBwTKZDLUbAN9SWvrjiJjhjuVNGc5G1kt+UOPBDSgAfMq+TZsoVTeciKj03SWbRmSf+XQaEeXs84O4Qe0GwGeUvjtj5EuU/emCGNemH0tLiYho2pRpYpXKexA3AD6hdFPGSO3PC88UZrtyJea5L3VT9mjHjRw5zj86jxE3AOIr3ZShLX3uzJnXWldhYp778kzhmTOv0RJ/SBzEDYDo9m3aNCK77VBUjmtEfHjMCKHL1BPQVQwgttKfSmnfkpHus/umZJ95bdqI20q140byG6a9dqb3d95g3g30bn4476b3w7wbABAZ4gYABIK4AQCBIG4AQCCIGwAQCOIGAASCeTcQEPgJH5j24S38JIPuTjVA3ICfcwWN3W5H6Nw8V9BIJBL3LV2BuAH/Z7fb1+26pFSQVEoMJv/dHI6I4ziWpcbrtDRtoCt0ugJxA/7MNee4ycIxxEilxDAcIW9uBkccRyxLTRbObrd3q1WFuAE/xydOTS13XcbXbsQuUO/Hx43Fyn+13bhYBHED/o/juMuVnCyIk0gQN17AcWS3k9XW7V4wxA34P4ZhYkaqxC6FH8LIFIAD//9ehmEYhlmWHGyz2ViWZVnWbreLXbReTCKRSKVSqVQaFBTEf7etduigyoO4AX/G/xgkEklQUJBEImFZlu9uELtcvRgfMVKpVCKRSCSSdhPHE8QN+DM+XFy/Cn7UFnFzM9zn3bQKmk6/WMQN+CfXiInrJyGRSBA03uIeNG2/VU/DVYgb8Fuuvhu60Un30F0dBzriBvyTK2tQoxEYuooh4CBlxIK4gYDjfjUm2lDCQFcxBCj3yTWIG2EgbiBAsSyLlBGLp9xB3IB/QtyICHEDgYVlWX4BoSMkDIRDILLZbK5lJI4w0HcDAQpxIzzEDQQoq9WKlBFL5303FRUVQhUGwGtctwdlWdZqtRLRkCEqIoqKihK7aNBai9rN4MGDxSoHwI1xxY3NZrNarVVVVWKXCDxCYwr8U114ndhFCGhhNWFtNyJuwJ/JODlTL2Xr7VarBRdR9RyGIZlMLg2VcKGslbF42g1xA35Lxsml1fIrtkppH0YeLJeg57jHcBzX0FTD1nD9LQOoH3lKHDwjHPwWUy+9YqtUqoODFcEYpepRDMMEK4KV6uArtkqmXuppN8QN+C223i4Nx1MzhcMwjDScYes93nkecQN+y2q1yIPlYpcisMiD5Varl/puLDb7iZ+rfrxYe/laY5OV7XjnYJn0lj7KEYNUY26LkAch10BoHEforxEYwzB2z13y3Yib78uu5P1g6jRlXJqsbHllXXll3eHiy5PuiBwd3b/r5wIA/9PVuDl49tI3RZdu7BxNVjbnu/O1jdYJCQNv7AgA4Ae61Mb5vuxK26zhOI61We12O8va7CzrukrCbrdbrje2vWjim6JL35ddufkSA0Av1XncWGz2vB9MbbezNuvFX0rqa65UX7pwtfIiZ7dzHGe53lB96fwP3+ZamxrbviXvB5PFhuelAgSozuPmxM9VrfprOI5jWdv1+lrlnb+aFGatGzxqznC73W6zWZp+Om04V9t3zfoZ8e31FzVZ2RM/45IWgADVedz8eLG21RbObq++dKHoeNGdd1z/bl8BI6kpPma4ar4oCQp7auWC/3n+V4znw7Y9GgAEiM67ii9fa90sYiRM6Kj7Pl0wgIjor6OJiGbeecfhYzqT9XDuya8bFCn/2Y2jAUCA6Dxu2o5826zWn/d88sj+25cnnlqrH7j8Wfbtf5bffk+yXNH5lKquj6MDgJ/pPG6CZdJWGREkC3/q9y8m9SGiyeNnEBGNv6ty5+fni7twvmCZ1P0BQMLDs6IBxNJ53NzSR1le2eLWIQzTdCinsGDwLROryz9loxaqL+ouKRimS2Pq6nCF6xb5wmOcXKtilQQgAHUeNyMGqVrFDRFJg8InDpMZL4dNGRduLLzq/ruVSBgJSRlJ+7/koREKi8XjJRU9ig8aiRtRigEQsDqPmzG3RRwuvtyqPcUwTYePNREjqTpWTi3rCLJgeTipgoKb2h5KHiS9I6q/WNeFchxxHNntdOqUISgoSCKRuNd0fEFISMiAAQP698fVHuCfOo8beZBk0h2ROd+d7+IRGebalzuuUXs/4wdHRfYNV3avgN5WX9/EcZxEIgkKCpJKpb4TNxzHWSyW8vLyxsbGIUOGiF0cAO/r0jVTo6P71zZab/iaKd798QN95ypNmUymUCh8LW5YlrXZbFVVVSEhIf369RO7RABe1tVLNCckDFQpZd26ItwlWCb1qSvCXbUbvkkldnEc+McJSKVSIqqqqkLcgP/pxg0oRkf3T7i1r9/c78bX+m5chWFZ9vr162IXB8D7und7LXmQ5O5Y9d2xaveN/BPFLBZLY2OjUqkKDQ32agm9j79avdMHjAqPHzjzqSYegBf5XKUjwLWaGQTgTxA3ACAQxE13mQx6vd5gclvNN+Iqd4AuECxudmWqF+i8ftSi9RPcDluUlaJWR6vV0ROyjF4/lRuVqs6IiAHoLsHiJm2reZPWmwc0Zk2IVj+zq3mDbsFEXVqBucxs/kqrW5BV5M2TtRKpiTQdbxs4JoOeh/oOdJm18sjGV54Ykz4xJnViwqwnMj8+ctEmdpl6ipC1m5SsInLERIs6yK5MdUpW1gK3jcasCdGZfKVFt0A9YX170aFZebDMfHBxnHO9qMgYp50eT0Sk0WpJp+vJCk6YRhNmNLa8parJYKjTJKWnp6cnhhnbCSOAtq5+Nf/5FRuOV986KfPVxZkzBlYf/GjFQ6u/8tN7Xgrfd6NZebDMbC4zmzfFrdngbAeVrCmebjaXmbemFa/ZoCONVhur27mLiHQ7dzlDpBPx8Zpi3e4iIiKjTlfSY+V3iExMpBYtKlOFSRUZqSIiihwcWWsyIW+gU/v/uvbr+jDtn3bol8/NSJ2btfmjv4xV1h7dmH1S7JL1CDG6inV8RWaBjoxFjnpL7IoVaURE2ulaMhYVUbw2La64pIiMRcWxWq2mS4fVbtoat36iOlqtXlAcF9tjpXfx0KIC6LKyEyWNRKOS7pE5t/R7fMoYoquXKsUsVo8RPG50C9RZsQXmMnPHXTnx07W0S6fbraM0bVfqNkREpN3K15v2zqSSuPiuhdRNUGk0YUZTnYpfc6vSuFV0ADoQPSZWSVRTdbV50znTZSKlKtS1wfpTQfac36YmpE6MSU0a9fgTi/Nu6tpFUYlRu4mLjSci3e4OB6o08XElxTtLyNGS6s7Alm5BZvHiFV7tl/YgMjExrLbWbcWYr9fr9YY6zVgN0gY6l/z88gdDT6/5Q/a+i9eJrp8/vOaZj39U3b38/93j2OHsP+Y+9N9fGEPGPfXc7199cuao0Avf/9h7a9Tdu4jBC7TTtZkL1OoFpE3rOBC0M9MyM40rCrpeSXFFUtpW8+IuV4m6KzIxPbLFWnr7KwBd0HfqO29Vzpm3+YW5n/MbghPm7Vo1NcLx8ncf7z7H3pLx982LRhERUcac+RcrreIU1QuEihvdbh1ptsYTUdpWc1rL19y3uC1rN5nN7e7ThfcC9ArW89vn/m7zyeARs2Y/dlf/hrKD//v3Y3997NUBOc2JQ9RUd83m+qkqBg1QiFTYmydAY2pXpjpanblLu9W7824Aer3S7FfWf0v3Zb33Qdac9IzUjJV/+fTgynvYb/77P/5RSkREd/x66lDptd3PPrMi6+uSml4/H0eAuEnbai4zm8u2ImwAWji5438v0siMZTP7Nm+LSP7d09H2n3bv+JaISDYqc+uXL04aUn303TeeHvtwRubHhb15Sg6umQIQS6X5CtFA9cCWW4cMvYXomvmiY1Whmf7nfTtzdv9+TtKAyvyPlk5545te23mDuAEQizRISlRhutBy64Vzl4kkQS27VRWaB+dtff+dpwdRbb7+KwHL6FWIGwCxjE+dpqDizzfsbJ53Y72Ys+FvZRQyIXUqEVF1i3GooCFRA4jkCpEfL3DjBB8I91kmg+u2EipNUpKmzqA3qpKSMH8GekzQA3968b6CrMPLfpPxr3vuvX8EGQ7nHym5Yg297835D8iIiAr/+JvXf4gd/8iD90SHVJ7O+XLbWcnwxzMmil3wG4W4ISI+aygx3X1GTesn+QF4X0Ry1jfDdX9684N/H95x9BBJg9UJU1ZkLdJqHHfgvSN9yvCSbw69+24ekSxs4PCZL675r+nDZR0f1Hchboio1mis0yQlRbZ9xWTQ55vIUd9REdUa8x03l3BuMRn0RpXz8nDnRnJVlvgLHZy1JGcNKjIxPTGSmg/nXIcApIzWZm3UZrX/4uCZy9+fKWx5ehLihqjWZKLIse00mmqNtZr09EQyGfQGo0mTGEkqTVK6hohPGZOGz4i2uzlvRqFR1Rrz84mcCcTXoGqN+ceNtZEalcloDEtMby/mAPwR4qYDKo0mkogocnAkGWtrKVLl3sWjUvFb2tnNVGFSRWqcrxn5O++YKkxkMun1REQUWUekClOpTAaDCTUbCBCIGyKVKqzWaKrVqDrtFTYZ9EZVUnqiikwG/Q3cvsutseVYTY805uv1FWhMQSDAQDgRRWo05Hb/PVNHNyIOU6mIr6l0IEylcrsZRduNblSasRpVXW3vvcgXoMtQuyHiax2Un++osEQmpie2PzIVOTjSYNDriSIjO6yMqDRjNSb+eM17um109A279RxjuB0CAON6mGRFRcXgwYNv4BC96yma9fVNJ04c69u3b2hoqADPCK815uebIrs+fYfjOP6bHDlyZI8WzG9wHMc/Xt1ms1mt1qqqKrU6sqGhpi68ji1npFE+96xUv8d/7WE1YSEh4SZTuUKhUCgUwcHBMplM7MZUyye3OO8rGq3O3NX5zvw7Mj3sLKpa/j5ben2+kXCrLQCeiI0pY9aEqWsoNo5cN9DalZlpXFFQtjLemDVhaqYuze0i8rY7ExFR0fosHZHvXWvuGjAHABcRazetn9xCut067eKV8USk0Wpji4uMpFvgrLm02ZmIyJj1TMnKrbilFkDvIHZjyk1RkTHO+QSF+HhNcXEnD2/RZU4tXolbdgH0Gr49MqXdZPYQJ0VZKVlxXx3UEnn/ScAA0CN8KG7i4zXFO0uINOSo6fzO87671qwpKaap6jWOVXUmmdGqAvBtPtSYIk1snONpMEadjrRajVvfTSuOG5LyD94k7SZkDYDv86HaDcUvPrh1gVodTURxK746GE/Uk4/5BgCBYZqfL9XvMM2v+zDNz9f48DQ/AAgYiBsAEAjixrfwTQOlstfe/BrAs0CMG4ZhXP/1KXwfBMuy/fr1E7ssAN7ntZEphmF8rdu1Y3a7XSKRuHrKRefq7wwPD+/bt2/nbwDobbwTNwzDuOKmvr7JK8fsOQzD8D9sjuN8p47DcZxcLo+IiOjTp4/YZQHoEV6IG1fWBAUFNTXVWywWlmXtdjvfDXHzx795rhJKpVK5XD5q1CiZTMaPgvtO3AD4Pa/Vbvi4ISKJRGK32+12u1eO7EUSiYQvJIIGQBTeqd0QEd+SYhhGKpX6Tr3GnauOw+NXxS4UQADxWlcx/wPmO199MGt4jBuxywIQcLzWmHIt+GzW8Hx2FBzA73nzEk38kgGgA71ppgwA9GqIGwAQCOIGAASCuAEAgSBuAEAgiBsAEAjiBgAEgrgBAIEgbsBvWZgmpT1U7FIEFqU91MJ4vAUN4gb8VqO0PowNR+IIRmkPDWPDG6X1nnZovoghODi4trZWkFIBeI37g19sNpv7S4ycLtkq+kkiVDbcsUwITcz1S7YKRu5xh+a4iYiIEKJEAF7V6jlTMpnM9ZIyRHm1vppR4Do+gXAcd7W+OiQ0xNMOzXFTUVEhSJEAvMkVNyzLWq1WIhoyREVEYTVhYRRW21RrKbOEhYXJ5XKETs/hH8dYV1fXT95PJVeRtf3dWlwRfofTP5sAAABzSURBVGNP0QQQUdunaLq/qlKprl+/Xl9ff/XqVR+/NUqvxjCMTCYLDQ1VKBQd7OZLzwgH8J668DrHUjjJSS4nzz0K4CU2stWR42sPqwlruwPiBvyZjJMz9VK23m61WlC56TkMQzKZXBoq4UJZK2PxtNv/AWdlkSJZVrutAAAAAElFTkSuQmCC" width="378" height="246" class="img_ev3q"></p>
<p>Maintenant, vous allez ajouter deux étapes : une pour déployer l&#x27;application sur le <code>prodserveur</code> uniquement si la branche actuelle est <code>main</code>, et l&#x27;autre pour déployer l&#x27;application sur le <code>testserver</code> uniquement si la branche actuelle est <code>develop</code>.</p>
<p><strong>Pour l&#x27;environnent de test :</strong></p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stage(&#x27;Ansible job staging&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    when {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expression { env.GIT_BRANCH == BRANCHE_DEV }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            def targetVersion = getEnvVersion(&quot;dev&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sshagent(credentials: [&#x27;ansible-node-manager&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &quot;ssh user-ansible@192.168.1.173 &#x27;cd ansible-projects/devops-ansible-deployment &amp;&amp; ansible-playbook -i 00_inventory.yml -l staging deploy_playbook.yml --vault-password-file ~/.passvault.txt -e \&quot;docker_image_tag=${targetVersion}\&quot;&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans cette étape, après la connexion au <code>nodemanager</code>, nous nous déplaçons dans le dossier <code>ansible-projects/devops-ansible-deployment</code>, qui est l&#x27;emplacement de notre projet Ansible, et nous exécutons simplement le playbook <code>deploy_playbook.yml</code>.</p>
<p>L&#x27;option <code>-l</code> permet de spécifier le groupe d&#x27;hôtes cible. Dans cette étape, c&#x27;est le groupe <code>staging</code> qui contient le serveur <code>testserver</code>.</p>
<p>L&#x27;option <code>-e</code> permet de passer la valeur de la variable <code>docker_image_tag</code>. Par défaut dans Ansible, dans le fichier <code>all.yml</code>, nous l&#x27;avons définie sur <code>latest</code>. Dans le pipeline, il faut passer le tag de l&#x27;image Docker construite.</p>
<p><strong>Pour l&#x27;environnement de production :</strong></p>
<p>En général, effectuer un merge sur la branche principale &quot;main&quot; ou &quot;master&quot; correspond à une nouvelle version ou une release du logiciel. Dans le contexte du CI/CD, il est nécessaire de pousser un tag sur Git afin de marquer cette version spécifique. Cela permet de garder une trace claire des versions publiées et facilite le déploiement automatique ou la gestion des versions ultérieures.</p>
<p>En plus, en cas de problème ou de besoin de revenir à une version antérieure, le fait d&#x27;avoir des tags pour chaque version publiée facilite grandement le rollback. Vous pouvez simplement revenir au tag de la version précédente pour restaurer l&#x27;état du code à ce moment-là.</p>
<p>Pour pouvoir pousser le tag sur GitHub, une authentification est nécessaire. La manière la plus simple pour notre pipeline est d&#x27;établir une liaison SSH entre Jenkins et GitHub.</p>
<p>Dans Jenkins, comme pour Ansible, créez un Credentials de type <code>SSH Username with private key</code>, en lui donnant un ID tel que <code>github-credentials</code>, par exemple. Copiez ensuite la clé privée que vous avez déjà générée et utilisée pour Ansible</p>
<p><img decoding="async" loading="lazy" alt="image-20240209125229387" src="data:image/png;base64,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" width="947" height="59" class="img_ev3q"></p>
<p>Dans GitHub, ajoutez la clé publique dans &#x27;Settings &gt; SSH and GPG keys&#x27;</p>
<p><img decoding="async" loading="lazy" alt="image-20240209124621230" src="/assets/images/image-20240209124621230-2e7f8fb47bcc0d1e312f2cc70ee7ff53.png" width="1308" height="729" class="img_ev3q"></p>
<p>Finalement, dans votre pipeline ajoutez le stage nécessaire pour déployer l&#x27;application sur la production :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stage(&#x27;Ansible job production&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    when {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expression { env.GIT_BRANCH == BRANCHE_PROD }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            def targetVersion = getEnvVersion(&quot;prod&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sshagent(credentials: [&#x27;github-credentials&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &quot;git tag -f v${targetVersion}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &quot;git push origin --tags HEAD:develop&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sshagent(credentials: [&#x27;ansible-node-manager&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &quot;ssh user-ansible@192.168.1.173 &#x27;cd ansible-projects/devops-ansible-deployment &amp;&amp; ansible-playbook -i 00_inventory.yml -l production deploy_playbook.yml --vault-password-file ~/.passvault.txt -e \&quot;docker_image_tag=${targetVersion}\&quot;&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pendant cette étape, si la branche actuelle est la branche de production, nous récupérons la version, créons un tag et le poussons vers GitHub. Ensuite, nous lançons le playbook Ansible sur le groupe <code>production</code>, en spécifiant le tag de l&#x27;image Docker créée.</p>
<p>Voici le contenu du fichier Jenkins final pour notre pipeline :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BRANCHE_DEV = &#x27;origin/develop&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BRANCHE_PROD = &#x27;origin/main&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NEXUS_DOCKER_REGISTRY = &quot;http://prod.local:5003&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NEXUS_CREDENTIALS_ID = &quot;nexus-credentials&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DOCKER_IMAGE_NAME = &quot;devops-project-samples&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DOCKER_IMAGE_TAG = &quot;prod.local:5003&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Checkout&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                checkout scm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                echo &#x27;Pulling... &#x27; + env.GIT_BRANCH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Tests&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;mvn test&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Sonarqube Analysis&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    withSonarQubeEnv(&#x27;sonar-server&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sh &quot;mvn sonar:sonar -Dintegration-tests.skip=true -Dmaven.test.failure.ignore=true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    timeout(time: 1, unit: &#x27;MINUTES&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        def qg = waitForQualityGate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        if (qg.status != &#x27;OK&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            error &quot;Pipeline aborted due to quality gate failure: ${qg.status}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Maven Build and Package&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sh &#x27;mvn clean package -DskipTests&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            post {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                success {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    archiveArtifacts &#x27;target/*.jar&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Docker Build and Push to Nexus&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    envName = &quot;dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if(env.GIT_BRANCH == BRANCHE_PROD) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        envName = &quot;prod&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    envVersion  =  getEnvVersion(envName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    withCredentials([usernamePassword(credentialsId: &quot;${NEXUS_CREDENTIALS_ID}&quot;, usernameVariable: &#x27;USER&#x27;, passwordVariable: &#x27;PASSWORD&#x27;)]){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sh &#x27;echo $PASSWORD | docker login -u $USER --password-stdin $NEXUS_DOCKER_REGISTRY&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sh &#x27;docker system prune -af&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sh &quot;docker build -t $DOCKER_IMAGE_TAG/$DOCKER_IMAGE_NAME:$envVersion --no-cache --pull .&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sh &quot;docker push $DOCKER_IMAGE_TAG/$DOCKER_IMAGE_NAME:$envVersion&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Ansible job staging&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            when {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                expression { env.GIT_BRANCH == BRANCHE_DEV }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    def targetVersion = getEnvVersion(&quot;dev&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sshagent(credentials: [&#x27;ansible-node-manager&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sh &quot;ssh user-ansible@192.168.1.173 &#x27;cd ansible-projects/devops-ansible-deployment &amp;&amp; ansible-playbook -i 00_inventory.yml -l staging deploy_playbook.yml --vault-password-file ~/.passvault.txt -e \&quot;docker_image_tag=${targetVersion}\&quot;&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Ansible job production&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            when {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                expression { env.GIT_BRANCH == BRANCHE_PROD }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    def targetVersion = getEnvVersion(&quot;prod&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sshagent(credentials: [&#x27;github-credentials&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sh &quot;git tag -f v${targetVersion}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sh &quot;git push origin --tags HEAD:develop&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sshagent(credentials: [&#x27;ansible-node-manager&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sh &quot;ssh user-ansible@192.168.1.173 &#x27;cd ansible-projects/devops-ansible-deployment &amp;&amp; ansible-playbook -i 00_inventory.yml -l production deploy_playbook.yml --vault-password-file ~/.passvault.txt -e \&quot;docker_image_tag=${targetVersion}\&quot;&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def getEnvVersion(envName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def pom = readMavenPom file: &#x27;pom.xml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // get the current development version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    artifactVersion = &quot;${pom.version}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def gitCommit = sh(returnStdout: true, script: &#x27;git rev-parse HEAD&#x27;).trim()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def versionNumber;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (gitCommit == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        versionNumber =artifactVersion+&quot;-${envName}.&quot;+env.BUILD_NUMBER;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        versionNumber =artifactVersion+&quot;-${envName}.&quot;+env.BUILD_NUMBER+&#x27;.&#x27;+gitCommit.take(8);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print &#x27;build ${environnement} versions...&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print versionNumber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return versionNumber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour que le pipeline se lance automatiquement, vous devez choisir un mécanisme de déclenchement. Vous allez configurer le pipeline Jenkins pour surveiller en continu les changements sur le dépôt GitHub. Lorsqu&#x27;un changement est détecté, Jenkins démarre automatiquement le pipeline.</p>
<p>Pour ce faire, sélectionnez le projet dans Jenkins, puis accédez à Configuration. Dans la section &#x27;Déclencheurs de build&#x27;, cochez &#x27;Scrutation de l&#x27;outil de gestion de version&#x27; et saisissez <code>* * * * *</code>. Cette configuration signifie que Jenkins vérifie chaque minute s&#x27;il y a de nouvelles modifications. Vous pouvez cliquer sur le point d&#x27;interrogation pour obtenir plus d&#x27;informations.</p>
<p><img decoding="async" loading="lazy" alt="image-20240209130755937" src="/assets/images/image-20240209130755937-2c9bb4efd2f63fe335e1e9ad81d2b090.png" width="1183" height="785" class="img_ev3q"></p>
<p>Après avoir sauvegardé la modification, vous remarquerez que Jenkins lance un premier build. Cependant, étant donné que le fichier Jenkinsfile est vide pour le moment, il n&#x27;exécutera aucune action.</p>
<p><img decoding="async" loading="lazy" alt="image-20240209131924584" src="/assets/images/image-20240209131924584-101f46ffed4f0e23864f0901ae3df59f.png" width="928" height="677" class="img_ev3q"></p>
<p>Maintenant, effectuez un <code>git commit</code> et un <code>push</code> de la branche <code>develop</code>. Ensuite, modifiez la version du projet dans le fichier <code>pom.xml</code>, par exemple en la mettant à <code>1.1.1-RELEASE</code>.</p>
<p>Dans Jenkins, vous pouvez désormais constater que le pipeline a été automatiquement lancé. De plus, comme vous avez poussé la modification uniquement sur la branche <code>develop</code>, le stage <code>Ansible job production</code> ne sera pas déclenché.</p>
<p>Si vous n&#x27;avez pas autorisé l&#x27;utilisation de la méthode <code>getVersion()</code>, elle pourrait nécessiter une approbation explicite dans Jenkins. En effet, si ces méthodes ne sont pas approuvées au préalable, des problèmes tels que <code>org.jenkinsci.plugins.scriptsecurity.sandbox.RejectedAccessException</code></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Pipeline] End of Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Also:   org.jenkinsci.plugins.workflow.actions.ErrorAction$ErrorId: 7d88c948-32d7-4fa8-be0f-343fd56935b6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.jenkinsci.plugins.scriptsecurity.sandbox.RejectedAccessException: Scripts not permitted to use method org.apache.maven.model.Model getVersion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	at org.jenkinsci.plugins.scriptsecurity.sandbox.whitelists.StaticWhitelist.rejectMethod(StaticWhitelist.java:229)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour résoudre ce problème, vous pouvez autoriser l&#x27;utilisation de cette méthode dans Jenkins. Vous pouvez le faire en suivant ces étapes :</p>
<ol>
<li>Allez dans la configuration Jenkins (&#x27;Administrer Jenkins&#x27;).</li>
<li>Recherchez la section &quot;In-process Script Approval&quot;.</li>
<li>Vous devriez voir une liste d&#x27;approbations en attente. Recherchez l&#x27;approbation liée à la méthode <code>getVersion</code> de la classe <code>org.apache.maven.model.Model</code> et approuvez-la.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240210134906524" src="/assets/images/image-20240210134906524-821ecb3aa50759aae199104904ef3a49.png" width="720" height="388" class="img_ev3q"></p>
<blockquote>
<p>L&#x27;approbation de scripts dans Jenkins est une mesure de sécurité mise en place pour empêcher l&#x27;exécution involontaire ou malveillante de certaines méthodes ou classes Java dans les scripts Groovy utilisés dans Jenkins Pipelines. Cela permet de protéger l&#x27;environnement Jenkins contre l&#x27;exécution de scripts potentiellement dangereux.</p>
</blockquote>
<p>Voici le résultat du lancement du pipeline :</p>
<p><img decoding="async" loading="lazy" alt="image-20240209115936993" src="/assets/images/image-20240209115936993-e881429067e414e6bee717efd852ab41.png" width="1334" height="711" class="img_ev3q"></p>
<p>Sur le serveur <code>testserver</code>, vérifiez que l&#x27;application a été correctement déployée :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@testserver ~]# docker ps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID   IMAGE                                                                 COMMAND                  CREATED       STATUS       PORTS                    NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">519efeb67f07   prod.local:5003/devops-project-samples:1.1.1-RELEASE-dev.3.b712e91b   &quot;java -jar /opt/app/…&quot;   2 hours ago   Up 2 hours   0.0.0.0:7070-&gt;7070/tcp   springbootapp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vous pouvez également visualiser les images Docker téléchargées :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@testserver ~]# docker images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REPOSITORY                               TAG                             IMAGE ID       CREATED                  SIZE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prod.local:5003/devops-project-samples   1.1.1-RELEASE-dev.3.b712e91b    996e0754f64b   Less than a second ago   309MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prod.local:5003/devops-project-samples   0.0.1-SNAPSHOT-dev.2.79a67f5f   64091d71adc5   Less than a second ago   309MB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Maintenant, dans GitHub, créez un pull request pour merger la branche <code>develop</code> dans <code>main</code>. Cette fois-ci, Jenkins doit déployer l&#x27;application en production et pousser le tag sur GitHub.</p>
<p><img decoding="async" loading="lazy" alt="image-20240209120440444" src="/assets/images/image-20240209120440444-40f218963fda9abc3cfc10a25d587fc3.png" width="1321" height="628" class="img_ev3q"></p>
<p>Vérifiez également sur le <code>prodserver</code> que l&#x27;application a été déployée :</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@prodserver ~]# docker ps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID   IMAGE                                                                  COMMAND                  CREATED       STATUS       PORTS                    NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b881d0705103   prod.local:5003/devops-project-samples:1.1.1-RELEASE-prod.4.40e193ff   &quot;java -jar /opt/app/…&quot;   2 hours ago   Up 2 hours   0.0.0.0:7070-&gt;7070/tcp   springbootapp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@prodserver ~]# docker images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">REPOSITORY                               TAG                             IMAGE ID       CREATED                  SIZE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prod.local:5003/devops-project-samples   1.1.1-RELEASE-prod.4.40e193ff   b5ce181d1c22   Less than a second ago   309MB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sur GitHub, vous pouvez constater qu&#x27;un nouveau tag a été ajouté, faisant référence exactement à la version déployée en production.</p>
<p><img decoding="async" loading="lazy" alt="image-20240209120803945" src="/assets/images/image-20240209120803945-e9709c004d6d3a85a48d3fc36c65974f.png" width="712" height="421" class="img_ev3q"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/devops/Gérez le Versioning en livraison continue"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Gérez le Versioning en livraison continue</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/spring-framework"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">Spring Framework</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installez-jenkins" class="table-of-contents__link toc-highlight">Installez Jenkins</a></li><li><a href="#quest-ce-quun-pipeline-jenkins-" class="table-of-contents__link toc-highlight">Qu&#39;est-ce qu&#39;un pipeline Jenkins ?</a><ul><li><a href="#structure-de-base" class="table-of-contents__link toc-highlight">Structure de Base</a></li></ul></li><li><a href="#versionnez-votre-code-source" class="table-of-contents__link toc-highlight">Versionnez votre code source</a></li><li><a href="#créez-un-pipeline-jenkins" class="table-of-contents__link toc-highlight">Créez un pipeline Jenkins</a></li><li><a href="#créez-la-branche-de-développement-develop" class="table-of-contents__link toc-highlight">Créez la branche de développement (develop)</a></li><li><a href="#définissez-les-étapes-du-pipeline" class="table-of-contents__link toc-highlight">Définissez les étapes du pipeline</a><ul><li><a href="#définissez-les-variables-denvironnement" class="table-of-contents__link toc-highlight">Définissez les variables d&#39;environnement</a></li><li><a href="#récupérez-le-code-source" class="table-of-contents__link toc-highlight">Récupérez le code source</a></li><li><a href="#exécutez-les-tests-unitaires" class="table-of-contents__link toc-highlight">Exécutez les tests unitaires</a></li><li><a href="#testez-la-qualité-de-votre-code-avec-sonarqube" class="table-of-contents__link toc-highlight">Testez la qualité de votre code avec SonarQube</a></li><li><a href="#intégrez-sonarqube-avec-jenkins" class="table-of-contents__link toc-highlight">Intégrez SonarQube avec Jenkins</a></li><li><a href="#sonarqube-webhooks" class="table-of-contents__link toc-highlight">SonarQube Webhooks</a></li><li><a href="#sonarqube-scanner-pour-jenkins" class="table-of-contents__link toc-highlight">SonarQube Scanner pour Jenkins</a></li><li><a href="#packagez-le-projet-avec-maven" class="table-of-contents__link toc-highlight">Packagez le projet avec Maven</a></li><li><a href="#générez-la-version-du-projet-à-chaque-build" class="table-of-contents__link toc-highlight">Générez la version du projet à chaque build</a></li><li><a href="#conteneurisez-lapplication-et-envoyez-limage-docker-vers-nexus" class="table-of-contents__link toc-highlight">Conteneurisez l&#39;application et envoyez l&#39;image Docker vers Nexus</a></li><li><a href="#déployez-lapplication-avec-ansible" class="table-of-contents__link toc-highlight">Déployez l&#39;application avec Ansible</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/devops-cicd-pipeline">Articles</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mossaab-frifita-17ba44138" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/MossaabFrifita" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mossaab Frifita. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>