<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-devops/Utilisez Ansible pour automatiser le déploiement de votre application" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Utilisez Ansible pour automatiser le déploiement de votre application | ON APPREND SANS CESSE</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://mossaabfrifita.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://mossaabfrifita.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://mossaabfrifita.github.io/docs/devops/Utilisez Ansible pour automatiser le déploiement de votre application"><meta data-rh="true" property="og:locale" content="fr"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Utilisez Ansible pour automatiser le déploiement de votre application | ON APPREND SANS CESSE"><meta data-rh="true" name="description" content="Ansible est un outil de gestion de configuration qui permet d&#x27;automatiser des tâches avec des scripts d&#x27;automatisation."><meta data-rh="true" property="og:description" content="Ansible est un outil de gestion de configuration qui permet d&#x27;automatiser des tâches avec des scripts d&#x27;automatisation."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://mossaabfrifita.github.io/docs/devops/Utilisez Ansible pour automatiser le déploiement de votre application"><link data-rh="true" rel="alternate" href="https://mossaabfrifita.github.io/docs/devops/Utilisez Ansible pour automatiser le déploiement de votre application" hreflang="fr"><link data-rh="true" rel="alternate" href="https://mossaabfrifita.github.io/docs/devops/Utilisez Ansible pour automatiser le déploiement de votre application" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ea9770ca.css">
<script src="/assets/js/runtime~main.8d216ba4.js" defer="defer"></script>
<script src="/assets/js/main.0cd224c4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/custom-logo.jpg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/custom-logo.jpg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mossaab Frifita</b></a><a class="navbar__item navbar__link" href="/docs/category/devops-cicd-pipeline">DevOps</a><a class="navbar__item navbar__link" href="/docs/category/spring-framework">Spring</a><a class="navbar__item navbar__link" href="/docs/category/angular">Angular</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/MossaabFrifita" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/devops-cicd-pipeline">DevOps CI/CD pipeline</a><button aria-label="Réduire la catégorie &#x27;DevOps CI/CD pipeline&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Ce que vous apprendrez">Ce que vous apprendrez</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Créez votre environnement de travail">Créez votre environnement de travail</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Installez et configurez Docker">Installez et configurez Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Créez une simple application Spring Boot">Créez une simple application Spring Boot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Installation et configuration de SonarQube et JaCoCo">Installation et configuration de SonarQube et JaCoCo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Conteneurisez l&#x27;application Spring Boot avec Docker">Conteneurisez l&#x27;application Spring Boot avec Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Créez un registre docker privé et un docker hub proxy avec Nexus">Créez un registre docker privé et un docker hub proxy avec Nexus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/devops/Utilisez Ansible pour automatiser le déploiement de votre application">Utilisez Ansible pour automatiser le déploiement de votre application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Gérez le Versioning en livraison continue">Gérez le Versioning en livraison continue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devops/Construisez un pipeline CI-CD avec Jenkins">Construisez un pipeline CI-CD avec Jenkins</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/spring-framework">Spring Framework</a><button aria-label="Développer la catégorie &#x27;Spring Framework&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/angular">Angular</a><button aria-label="Développer la catégorie &#x27;Angular&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/devops-cicd-pipeline"><span itemprop="name">DevOps CI/CD pipeline</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Utilisez Ansible pour automatiser le déploiement de votre application</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><header><h1>Utilisez Ansible pour automatiser le déploiement de votre application</h1></header><p>Ansible est un outil de gestion de configuration qui permet d&#x27;automatiser des tâches avec des scripts d&#x27;automatisation.</p>
<p>L&#x27;un des principes fondamentaux de la démarche DevOps est d&#x27;éliminer les processus manuels, les tâches répétitives et les sources d&#x27;erreurs lors du déploiement d&#x27;applications, assurant ainsi une livraison continue et une intégration continue.</p>
<p>Avec l&#x27;utilisation d&#x27;Ansible, vous avez la capacité de scripter et d&#x27;automatiser le déploiement, tout en gérant automatiquement les tâches d&#x27;administration.</p>
<p>Intégré à notre pipeline CI/CD, il simplifie le déploiement automatique de notre application Spring Boot en fonction de l&#x27;environnement cible (Production ou Staging).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mode-de-fonctionnement">Mode de fonctionnement<a href="#mode-de-fonctionnement" class="hash-link" aria-label="Lien direct vers Mode de fonctionnement" title="Lien direct vers Mode de fonctionnement">​</a></h2>
<p>Ansible fonctionne en mode <code>push</code>, ce qui consiste à contrôler les serveurs cibles (<strong>nodes</strong>) depuis un poste de contrôle appelé <strong>node manager</strong>.</p>
<ul>
<li>Le node manager est une machine disposant d&#x27;Ansible installé, capable de contrôler les nodes à travers sa connexion SSH. Cela peut être n&#x27;importe quelle machine Linux, mais pas Windows.</li>
<li>Les nodes sont les machines sur lesquelles Ansible effectue les installations. Ils peuvent avoir n&#x27;importe quel système d&#x27;exploitation, tant qu&#x27;ils sont accessibles par SSH et disposent d&#x27;une version de Python installée.</li>
</ul>
<p>Ansible est un outil <code>agentless</code>, ce qui signifie qu&#x27;il n&#x27;installe pas d&#x27;agent sur les nodes ; il utilise uniquement SSH et Python.</p>
<p>Les tâches à exécuter sont rédigées dans des fichiers de configuration au format YAML.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="identifiez-votre-architecture-technique-pour-ansible">Identifiez votre architecture technique pour Ansible<a href="#identifiez-votre-architecture-technique-pour-ansible" class="hash-link" aria-label="Lien direct vers Identifiez votre architecture technique pour Ansible" title="Lien direct vers Identifiez votre architecture technique pour Ansible">​</a></h2>
<p>Votre architecture de déploiement est constituée de 3 serveurs (2 nodes et 1 node manager) :</p>
<ul>
<li><code>prodserver</code> : Il s&#x27;agit de l&#x27;environnement de Production où notre application sera déployée et utilisée par les utilisateurs finaux.</li>
<li><code>testserver</code> : Il s&#x27;agit de l&#x27;environnement de Staging où les nouvelles fonctionnalités, les mises à jour ou les correctifs sont testés avant d&#x27;être déployés en production.</li>
<li><code>nodemanager</code> : Il s&#x27;agit du serveur de contrôle sur lequel Ansible sera installé. Depuis ce serveur, les opérations de configuration et de déploiement seront lancées à distance sur les serveurs <code>prodserver</code> et <code>testserver</code>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="créez-un-simple-utilisateur">Créez un simple utilisateur<a href="#créez-un-simple-utilisateur" class="hash-link" aria-label="Lien direct vers Créez un simple utilisateur" title="Lien direct vers Créez un simple utilisateur">​</a></h2>
<p>Pour éviter de travailler en tant que <strong>root</strong> sur le node manager (ce qui n&#x27;est vraiment pas recommandé, car le compte root a des privilèges illimités), vous allez créer un utilisateur standard, par exemple <strong>user-ansible</strong>, avec les privilèges sudo :</p>
<ol>
<li>Créez l&#x27;utilisateur avec la commande : <code>adduser user-ansible</code>.</li>
<li>Définissez un mot de passe pour cet utilisateur : <code>passwd user-ansible</code>.</li>
<li>Ajoutez l&#x27;utilisateur dans le groupe wheel : <code>usermod -a -G wheel user-ansible</code>.</li>
</ol>
<p>Maintenant que l’utilisateur est créé, vous pouvez l’utiliser avec la commande suivante :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@nodemanager ~]# su - user-ansible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ~]$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Remarque : La ligne de commande commence par un <strong>#</strong> quand vous êtes en <strong>root</strong>, et par un <strong>$</strong> quand vous êtes en utilisateur standard.</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installez-ansible">Installez Ansible<a href="#installez-ansible" class="hash-link" aria-label="Lien direct vers Installez Ansible" title="Lien direct vers Installez Ansible">​</a></h2>
<p>Vous allez installer Ansible sur votre serveur Centos <code>nodemanager</code>, dans mon cas son adresse IP est : <code>192.168.1.173</code></p>
<p>Sur le <code>nodemanager</code>, lancez la commande suivante pour installer Ansible</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo yum install ansible</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Remarque : Ansible peut être installé via <strong>pip</strong> de <strong>Python</strong> dans un <strong><a href="https://www.redhat.com/sysadmin/python-venv-ansible" target="_blank" rel="noopener noreferrer">virtualenv</a></strong> ou non. L&#x27;avantage du virtualenv est de pouvoir installer plusieurs versions d&#x27;Ansible sur le même système de manière isolée, et d&#x27;activer l&#x27;environnement de travail que vous souhaitez.</p>
<p>Vérifiez la version d&#x27;Ansible installée :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ~]$ ansible --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ansible 2.9.27</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  config file = /etc/ansible/ansible.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  configured module search path = [u&#x27;/home/user-ansible/.ansible/plugins/modules&#x27;, u&#x27;/usr/share/ansible/plugins/modules&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ansible python module location = /usr/lib/python2.7/site-packages/ansible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  executable location = /bin/ansible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python version = 2.7.5 (default, Nov 14 2023, 16:14:06) [GCC 4.8.5 20150623 (Red Hat 4.8.5-44)]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="créez-votre-environnement-de-travail">Créez votre environnement de travail<a href="#créez-votre-environnement-de-travail" class="hash-link" aria-label="Lien direct vers Créez votre environnement de travail" title="Lien direct vers Créez votre environnement de travail">​</a></h2>
<p>Vous allez configurer votre environnement de développement afin de travailler à distance depuis votre machine locale. Ceci vous permettra d&#x27;utiliser un IDE tel que VS Code qui est très populaire et apprécié par de nombreux DevOps.</p>
<p>Si vous préférez, vous avez également la possibilité d&#x27;utiliser un éditeur de texte simple comme vi, vim, nano, etc., directement sur le serveur.</p>
<p>Pour une meilleure organisation de votre travail, je vous recommande de créer un dossier dédié regroupant l&#x27;ensemble de vos projets Ansible. Par exemple, sous le répertoire personnel de <strong>user-ansible</strong>, créez un dossier nommé <strong>ansible-projects</strong>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ~]$ pwd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/home/user-ansible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ~]$ mkdir ansible-projects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ~]$ cd ansible-projects/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ansible-projects]$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="développez-à-distance-avec-ssh-dans-vs-code">Développez à distance avec SSH dans VS Code<a href="#développez-à-distance-avec-ssh-dans-vs-code" class="hash-link" aria-label="Lien direct vers Développez à distance avec SSH dans VS Code" title="Lien direct vers Développez à distance avec SSH dans VS Code">​</a></h3>
<p>En utilisant la fonctionnalité SSH de VS Code, vous pouvez développer votre code sur un serveur distant plutôt que sur votre machine locale. Vous allez utiliser cette fonctionnalité pour vous connecter au dossier &quot;ansible-projects&quot; que vous avez créé sur le <code>nodemanager</code>, écrire les scripts et exécuter directement les commandes Ansible depuis votre machine locale.</p>
<ol>
<li><a href="https://code.visualstudio.com/download" target="_blank" rel="noopener noreferrer">Téléchargez</a> et installez VS Code dans votre machine local.</li>
<li>Installez l&#x27;extension &quot;Remote - SSH&quot;</li>
<li>Cliquez sur &quot;Remote Expolorer&quot;, puis sur le bouton &quot;+&quot; pour ajouter une nouvelle connexion ssh :</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240111205709313" src="/assets/images/image-20240111205709313-ed6a0a2dd7daa2a40be15eff9564793b.png" width="394" height="414" class="img_ev3q"></p>
<ol start="4">
<li>Entrez l&#x27;adresse SSH du serveur <code>nodemanager</code>, utilisez l&#x27;utilisateur que vous avez créé &quot;user-ansible&quot; :</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240111210034061" src="data:image/png;base64,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" width="606" height="87" class="img_ev3q"></p>
<ol start="5">
<li>Choisissez l&#x27;emplacement de votre fichier de configuration SSH. VS Code l&#x27;utilise pour sauvegarder les informations du serveur, vous permettant ainsi de reprendre automatiquement votre session ultérieurement.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240111210525558" src="/assets/images/image-20240111210525558-5e29b00d95fad4dab1e55c941efa086e.png" width="610" height="165" class="img_ev3q"></p>
<ol start="6">
<li>Cliquez sur la petite icône verte en bas à droite, puis sélectionnez &quot;Connect to Host&quot; et choisissez l&#x27;hôte que vous venez de configurer. Ensuite, saisissez le mot de passe de l&#x27;utilisateur &quot;user-ansible&quot;.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240111211230093" src="data:image/png;base64,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" width="609" height="139" class="img_ev3q"></p>
<ol start="7">
<li>Dans l&#x27;explorateur de fichiers dans la barre latérale, cliquez sur &quot;open folder&quot; et saisissez le chemin de votre dossier de travail : <code>/home/user-ansible/ansible-projects</code></li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240111211727770" src="/assets/images/image-20240111211727770-dbda6d73e3b13a65f72667b65cf1671f.png" width="534" height="158" class="img_ev3q"></p>
<p>Vous pouvez maintenant travailler directement sur le dossier &quot;ansible-projects&quot;, vous pouvez aussi ouvrir le terminal de votre session SSH où vous pouvez lancer les commandes Ansible !</p>
<p><img decoding="async" loading="lazy" alt="image-20240111212752044" src="/assets/images/image-20240111212752044-c5740e5bc885bb4d61622d1449e160c4.png" width="885" height="353" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ansible-inventory-linventaire-des-nodes">Ansible Inventory (l&#x27;inventaire des nodes)<a href="#ansible-inventory-linventaire-des-nodes" class="hash-link" aria-label="Lien direct vers Ansible Inventory (l&#x27;inventaire des nodes)" title="Lien direct vers Ansible Inventory (l&#x27;inventaire des nodes)">​</a></h2>
<p>Pour fonctionner, Ansible a besoin d&#x27;un fichier d&#x27;inventaire. Ce fichier contient la liste des nodes et de leurs variables, décrivant simplement votre infrastructure, c&#x27;est-à-dire les serveurs sur lesquels les tâches Ansible seront exécutées.</p>
<p>Il est possible de définir le fichier d&#x27;inventaire Ansible de trois manières différentes :</p>
<ul>
<li>Format INI statique.</li>
<li>Format YAML statique.</li>
<li>Format JSON (de manière dynamique).</li>
</ul>
<blockquote>
<p>Remarque : Les deux premières méthodes statiques (INI et YAML) sont généralement recommandées lorsque vous travaillez avec des serveurs physiques dont la configuration est relativement stable. En revanche, le script dynamique est souvent préféré pour lister les serveurs virtuels créés dans un environnement cloud, où la création, la suppression et la modification de machines virtuelles peuvent être fréquentes et dynamiques.</p>
</blockquote>
<p>Par défaut, Ansible recherche le fichier d&#x27;inventaire dans le chemin <code>/etc/ansible/hosts</code>. Ce chemin est préconfiguré dans <code>/etc/ansible/ansible.cfg</code>. Cependant, vous pouvez spécifier un emplacement différent pour votre fichier d&#x27;inventaire en utilisant l&#x27;option <code>-i</code> lors de l&#x27;exécution des commandes Ansible.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="créez-le-fichier-inventaire-ansible">Créez le fichier inventaire Ansible<a href="#créez-le-fichier-inventaire-ansible" class="hash-link" aria-label="Lien direct vers Créez le fichier inventaire Ansible" title="Lien direct vers Créez le fichier inventaire Ansible">​</a></h2>
<p>Créez un sous dossier nommé par exemple <code>devops-ansible-deployment</code> dirctement depuis VS Code ou bien avec le terminal :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ansible-projects]$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">devops-ansible-deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ansible-projects]$ cd devops-ansible-deployment/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez un fichier <code>00_inventory.ini</code>, puis ajoutez la définition de deux serveurs <code>prodserver</code> et <code>testserver</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ cat 00_inventory.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver ansible_host=192.168.1.66 ansible_user=root ansible_ssh_pass=123321</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testserver ansible_host=192.168.1.26 ansible_user=root ansible_ssh_pass=123321</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>ansible_host</code> indique l&#x27;adresse IP du serveur. Dans l’absolu, il est recommandé d&#x27;utiliser <strong>les noms de machine plutôt que les adresses IP</strong>. Les noms de machine devraient toujours être enregistrés dans un serveur DNS. Cependant, pour cette section qui se concentre sur la pratique d&#x27;Ansible, vous pouvez utiliser les adresses IP, ou bien les enregistrer dans le fichier <code>/etc/hosts</code> comme nous l&#x27;avons fait pour le serveur <code>mastererver</code>.</p>
<p><code>ansible_user</code> et <code>ansible_ssh_pass</code> permettent de définir l&#x27;utilisateur à utiliser pour se connecter en SSH ainsi que le mot de passe. Les variables de connexion ne sont pas obligatoires ; vous pouvez les passer directement en ligne de commande lors de l&#x27;exécution des commandes Ansible :</p>
<ul>
<li><code>--user UTILISATEUR_A_UTILISER</code></li>
<li><code>--ask-pass</code> ou <code>-k</code> (k minuscule) : indique à Ansible de demander le mot de passe SSH</li>
</ul>
<blockquote>
<p>Remarque : Si vous ne spécifiez pas d&#x27;utilisateur, Ansible utilise l&#x27;utilisateur courant, dans votre cas <code>user-ansible</code>. Pour le moment, nous allons utiliser <code>root</code> (nous n&#x27;avons pas d&#x27;autre choix, c&#x27;est le seul compte dont nous disposons).</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="type-dinstances-dans-linventaire-dansible">Type d&#x27;instances dans l&#x27;inventaire d&#x27;Ansible<a href="#type-dinstances-dans-linventaire-dansible" class="hash-link" aria-label="Lien direct vers Type d&#x27;instances dans l&#x27;inventaire d&#x27;Ansible" title="Lien direct vers Type d&#x27;instances dans l&#x27;inventaire d&#x27;Ansible">​</a></h2>
<p>Dans le fichier inventaire d&#x27;Ansible, vous pouvez définir deux types d&#x27;instances : les hôtes (hosts) et les groupes (groupes).</p>
<ul>
<li>Les hosts sont les machines à l&#x27;échelle individuelle tel que <code>prodserver</code>, <code>testserver</code>.</li>
<li>Les groupes vous permettent de regrouper plusieurs hôtes sous un même nom, exemple <code>dbserver</code>, <code>webserver</code>.</li>
</ul>
<p>Par exemple si vous voulez organiser vos serveurs en deux groupes <code>production</code> et <code>staging</code> :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[production]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver ansible_host=192.168.1.66 ansible_user=root ansible_ssh_pass=123321</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[staging]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testserver ansible_host=192.168.1.26 ansible_user=root ansible_ssh_pass=123321</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le but est de pouvoir cibler les tâches à exécuter avec Ansible pour un groupe ou un hôte spécifique, ou bien pour toutes les machines à travers le groupe <code>all</code>.</p>
<p>Le groupe par défaut est <code>all</code>, ce qui signifie que vous vous adressez à toutes les machines. En format INI, vous n&#x27;êtes pas obligé de spécifier explicitement ce groupe.</p>
<p>Modifiez votre fichier <code>00_inventory.ini</code> pour ajouter les deux groupes, &quot;production&quot; et &quot;staging&quot;. Cela nous permettra de cibler :</p>
<ul>
<li>Le serveur <code>prodserver</code></li>
<li>Tous les serveurs du groupe <code>production</code></li>
<li>Le serveur <code>testserver</code></li>
<li>Tous les serveurs du groupe <code>staging</code></li>
<li>Tous les serveurs avec le groupe <code>all</code></li>
</ul>
<p>Nous explorerons ces éléments en pratique par la suite.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="les-modules">Les modules<a href="#les-modules" class="hash-link" aria-label="Lien direct vers Les modules" title="Lien direct vers Les modules">​</a></h2>
<p>Un module Ansible est un programme utilisé pour exécuter une tâche ou une commande spécifique. Chaque tâche dans Ansible est associée à un module unique qui définit la fonction à accomplir. Ces modules peuvent prendre des arguments, ce qui permet une personnalisation de l&#x27;exécution de la tâche en fonction des besoins spécifiques. Vous pouvez trouver la liste des modules dans la <a href="https://docs.ansible.com/ansible/2.9/modules/list_of_all_modules.html" target="_blank" rel="noopener noreferrer">documentation officielle</a>, ou bien via les commandes <code>ansible-doc -l</code> et <code>ansible-doc &lt;module&gt;</code> pour obtenir les détails spécifiques de chaque module.</p>
<p>Les tâches peuvent être lancées à l&#x27;aide des deux commandes suivantes : <code>ansible</code> et <code>ansible-playbook</code>, que vous utiliserez par la suite.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vérifiez-la-communication-avec-les-nodes">Vérifiez la communication avec les nodes<a href="#vérifiez-la-communication-avec-les-nodes" class="hash-link" aria-label="Lien direct vers Vérifiez la communication avec les nodes" title="Lien direct vers Vérifiez la communication avec les nodes">​</a></h2>
<p>Vous allez utiliser le module <code>ping</code> pour tester l&#x27;accessibilité des deux serveurs, <code>prodserver</code> et <code>testserver</code>, que vous avez définis dans le fichier d&#x27;inventaire via Ansible.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="utilisez-ansible-en-mode-impératif-ad-hoc-avec-la-commande-ansible">Utilisez Ansible en mode impératif (ad-hoc) avec la commande Ansible<a href="#utilisez-ansible-en-mode-impératif-ad-hoc-avec-la-commande-ansible" class="hash-link" aria-label="Lien direct vers Utilisez Ansible en mode impératif (ad-hoc) avec la commande Ansible" title="Lien direct vers Utilisez Ansible en mode impératif (ad-hoc) avec la commande Ansible">​</a></h3>
<p>Ansible offre la commande <code>ansible</code> pour exécuter des commandes en mode ad-hoc (impératif). Ce mode permet d&#x27;exécuter des commandes séparées afin d&#x27;effectuer des actions spécifiques sur les serveurs cibles. Il est principalement utilisé dans des environnements de développement pour effectuer des tests ou pour se familiariser avec de nouveaux modules ou bien en production pour exécuter des tâches non répétitives.</p>
<p>La structure générale de la commande ad-hoc est la suivante :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ansible &lt;PATTERN&gt; -i &lt;INVENTORY&gt; -m &lt;MODULE_NAME&gt; -a &lt;MODULE_ARGS&gt; -b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>L&#x27;argument <code>&lt;PATTERN&gt;</code> permet de spécifier le nom du serveur ou du groupe de serveurs sur lequel la tâche sera exécutée. Exemple <code>all</code>, <code>prodserver</code>, <code>staging</code></p>
<ul>
<li><code>-i</code> ou <code>--inventory</code> : spécifie le chemin vers le fichier d&#x27;inventaire,</li>
<li><code>-m</code> ou <code>--module-name</code> : indique le nom du module Ansible,</li>
<li><code>-a</code> ou <code>--args</code> : représente l&#x27;ensemble des arguments à passer au module,</li>
<li><code>-b</code> ou <code>--become</code> : certains modules nécessitent l&#x27;élévation des privilèges (sudo) pour être exécutés.</li>
</ul>
<p>Testez le module ping sur le serveur <code>test</code> avec la commande <code>ansible testserver -m ping -i 00_inventory.ini</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible testserver -m ping -i 00_inventory.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testserver | FAILED! =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;msg&quot;: &quot;Using a SSH password instead of a key is not possible because Host Key checking is enabled and sshpass does not support this.  Please add this host&#x27;s fingerprint to your known_hosts file to manage this host.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le statut est <code>FAILED</code> ! Ansible n&#x27;arrive pas à se connecter via SSH.</p>
<p>Quand vous vous connectez la première fois en SSH avec un serveur, il peut être nécessaire d&#x27;accepter et d&#x27;enregistrer la <strong>fingerprint</strong> dans le fichier <code>known_hosts</code>. Par la suite, cette vérification sera automatiquement effectuée lors des connexions ultérieures.</p>
<p>Vous pouvez désactiver cette vérification dans la configuration d&#x27;Ansible. Cela est détaillé dans la <a href="https://docs.ansible.com/ansible/latest/inventory_guide/connection_details.html#managing-host-key-checking" target="_blank" rel="noopener noreferrer">documentation officielle</a>, mais je vous recommande de vous connecter manuellement aux serveurs <code>prodserver</code> et <code>testserver</code> pour enregistrer la <strong>fingerprint</strong> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ssh root@192.168.1.26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The authenticity of host &#x27;192.168.1.26 (192.168.1.26)&#x27; can&#x27;t be established.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ECDSA key fingerprint is SHA256:Nnd1qW32K8lOp94/sAqfDgrkqcY+9Z9KFuLSc1tbmJk.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ECDSA key fingerprint is MD5:c5:79:3b:ed:a6:04:f9:62:4d:86:a6:48:dc:78:e1:89.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Are you sure you want to continue connecting (yes/no)? yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Warning: Permanently added &#x27;192.168.1.26&#x27; (ECDSA) to the list of known hosts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@192.168.1.26&#x27;s password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last login: Fri Dec 22 03:28:03 2023 from 192.168.1.196</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@testserver ~]# exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">déconnexion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection to 192.168.1.26 closed.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Relancez la commande ansible. cette fois vous devez voir <code>SUCCESS</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible testserver -m ping -i 00_inventory.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver | SUCCESS =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ansible_facts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;changed&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ping&quot;: &quot;pong&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Testez la commande pour cibler les hôtes ou les groupes :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible prodserver -m ping -i 00_inventory.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver | SUCCESS =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ansible_facts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;changed&quot;: false, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ping&quot;: &quot;pong&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible all -m ping -i 00_inventory.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver | SUCCESS =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ansible_facts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;changed&quot;: false, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ping&quot;: &quot;pong&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testserver | SUCCESS =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ansible_facts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;changed&quot;: false, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ping&quot;: &quot;pong&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible production -m ping -i 00_inventory.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver | SUCCESS =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ansible_facts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;changed&quot;: false, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ping&quot;: &quot;pong&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="utilisez-ansible-en-mode-déclaratif-ansible-playbook">Utilisez Ansible en mode déclaratif (ansible-playbook)<a href="#utilisez-ansible-en-mode-déclaratif-ansible-playbook" class="hash-link" aria-label="Lien direct vers Utilisez Ansible en mode déclaratif (ansible-playbook)" title="Lien direct vers Utilisez Ansible en mode déclaratif (ansible-playbook)">​</a></h3>
<p>Un playbook Ansible est une séquence d&#x27;instructions ou jeux d&#x27;instruction en anglais <code>play</code> définies dans un fichier YAML. Il spécifie un ensemble de tâches à effectuer sur un groupe de serveurs ciblés. Lorsque vous exécutez un playbook Ansible, les <code>play</code> sont exécutés dans l&#x27;ordre indiqué, de haut en bas, et les tâches de chaque <code>play</code> sont également exécutées dans cet ordre. C&#x27;est un moyen puissant et déclaratif d&#x27;automatiser la gestion de configuration et le déploiement sur plusieurs serveurs.</p>
<p>Comparé au mode ad-hoc, les playbooks vous offrent la possibilité de conserver le code dans un fichier YAML et de le réutiliser à chaque fois. Par exemple, nous allons créer un playbook pour déployer notre application Spring Boot à chaque lancement de build dans la pipeline CI/CD que nous allons créer à la fin de ce cours.</p>
<p>Si vous n&#x27;êtes pas familier avec le format YAML, prenez une petite pause pour comprendre sa syntaxe sur la <a href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html#yaml-syntax" target="_blank" rel="noopener noreferrer">documentation officielle</a> d&#x27;Ansible par exemple.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="la-structure-dun-playbook">La structure d&#x27;un playbook<a href="#la-structure-dun-playbook" class="hash-link" aria-label="Lien direct vers La structure d&#x27;un playbook" title="Lien direct vers La structure d&#x27;un playbook">​</a></h3>
<p>La structure minimale pour un playbook Ansible est la suivante :</p>
<ol>
<li>Un bloc général, pouvant comporter un nom pour le playbook, les hôtes ou groupes concernés, des variables, des options, etc.</li>
<li>Ensuite, des blocs spécifiques tels que des <strong>tasks</strong>, des <strong>rôles</strong> et des <strong>handlers</strong>.</li>
</ol>
<p>Chaque ligne à l&#x27;intérieur de ces blocs est indentée de <strong>deux espaces</strong> pour indiquer la hiérarchie des éléments dans le fichier YAML.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Nom du playbook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> groupe_hotes_cibles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">become</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Option : Indique que les tâches doivent être exécutées en tant qu&#x27;utilisateur sudo (root)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">vars</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">variable1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> valeur1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">variable2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> valeur2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Tâche 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">module_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">parametre1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> valeur1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">parametre2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> valeur2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Tâche 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">autre_module</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">parametre1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> valeur1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">parametre2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> valeur2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vous allez créer un playbook pour tester la communication avec les nœuds, donc vous allez utiliser le même module &#x27;ping&#x27; que celui que vous avez utilisé avec le mode ad-hoc.</p>
<p>Dans le même dossier <code>devops-ansible-deployment</code> créez le fichier <code>my-first-playbook.yml</code></p>
<p><img decoding="async" loading="lazy" alt="image-20240112140055518" src="/assets/images/image-20240112140055518-00ff1323e3fb53026ef6ca5aef9f0f92.png" width="509" height="162" class="img_ev3q"></p>
<p>Ici, tous les groupes sont concernés. Vous avez une seule tâche, &#x27;Test de ping&#x27;, qui utilise le module <code>ping</code>.</p>
<p>Lancez le playbook avec la commande <code>ansible-playbook</code>, suivi du nom du playbook et de l&#x27;option <code>-i inventory.ini</code> pour spécifier le chemin du fichier d&#x27;inventaire :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-playbook my-first-playbook.yaml -i inventory.ini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY [Test de connectivité avec les serveurs cibles] ****************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Gathering Facts] **********************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Test de ping] *************************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY RECAP **********************************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testserver                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vous pouvez constater qu&#x27;Ansible affiche la liste des tâches exécutées avec leur état (ok, changed, unreachable, failed).</p>
<p>La tâche &#x27;Gathering Facts&#x27; est automatiquement lancée par Ansible. Elle permet de collecter plusieurs variables sur chaque nœud (adresse IP, version de l’OS, etc.). Ces variables peuvent ensuite être utilisées dans les scripts.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="utilisez-lextension-vs-code-ansible">Utilisez l&#x27;extension VS Code Ansible<a href="#utilisez-lextension-vs-code-ansible" class="hash-link" aria-label="Lien direct vers Utilisez l&#x27;extension VS Code Ansible" title="Lien direct vers Utilisez l&#x27;extension VS Code Ansible">​</a></h2>
<p>L&#x27;avantage d&#x27;utiliser une IDE comme VS Code pour écrire les playbooks à distance, au lieu d&#x27;un simple éditeur de texte, est de profiter de l&#x27;extension Ansible maintenue par <code>Red Hat</code>. Elle offre :</p>
<ul>
<li>La coloration syntaxique</li>
<li>L&#x27;auto-complétion des noms de modules et des options via le raccourci [CTRL] + [Espace]</li>
<li>La validation du code avec <code>ansible-lint</code></li>
</ul>
<p>Installez l&#x27;extension depuis &#x27;File&#x27; &gt; &#x27;Settings&#x27; &gt; &#x27;Extensions&#x27;, puis cliquer sur configurer :</p>
<p><img decoding="async" loading="lazy" alt="image-20240112214136155" src="/assets/images/image-20240112214136155-6d6c0f20661bda2fda1f5161a177cbfb.png" width="596" height="197" class="img_ev3q"></p>
<p>Étant donné que vous êtes connecté en SSH au serveur <code>nodeserver</code>, vous avez la possibilité de configurer l&#x27;extension pour le serveur distant. Ajoutez le chemin vers Ansible et Python 3. Pour connaître ces chemins, vous pouvez utiliser les commandes <code>which ansible</code> et <code>which python3</code> depuis votre terminal.</p>
<p><img decoding="async" loading="lazy" alt="image-20240112212928589" src="/assets/images/image-20240112212928589-f32aae19b530d6b191e8efa31b2d01b3.png" width="1189" height="628" class="img_ev3q"></p>
<p><code>ansible-lint</code> est un outil open source destiné à l&#x27;analyse statique des playbooks Ansible. Il vérifie la conformité de vos playbooks avec les meilleures pratiques recommandées par la communauté Ansible et identifie d&#x27;éventuelles erreurs ou problèmes potentiels. Vous pouvez également configurer son chemin ; par défaut, il est activé. Si vous débutez avec Ansible, je vous recommande de commencer par écrire des playbooks sans utiliser <code>ansible-lint</code> afin de vous familiariser avec la syntaxe et les concepts d&#x27;Ansible.</p>
<p><img decoding="async" loading="lazy" alt="image-20240112213049046" src="/assets/images/image-20240112213049046-272f8c3d90d5f9d064c63fdeb419fcff.png" width="1184" height="424" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="passez-au-format-yaml-avec-le-fichier-dinventaire">Passez au format YAML avec le fichier d&#x27;inventaire<a href="#passez-au-format-yaml-avec-le-fichier-dinventaire" class="hash-link" aria-label="Lien direct vers Passez au format YAML avec le fichier d&#x27;inventaire" title="Lien direct vers Passez au format YAML avec le fichier d&#x27;inventaire">​</a></h2>
<p>Souvent, le format YAML est préféré pour le fichier d&#x27;inventaire, car il offre une meilleure lisibilité de l&#x27;organisation de vos nœuds. De plus, tous les autres fichiers d&#x27;Ansible sont écrits en YAML. Dans mon cas, je préfère également utiliser le format YAML pour l&#x27;inventaire. Dans cette section, vous allez modifier votre fichier <code>00_inventory.ini</code> en <code>00_inventory.yaml</code>. C&#x27;est l&#x27;occasion de travailler avec les deux types de fichiers !</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">all</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">children</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">production</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">prodserver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.1.66</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_ssh_pass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123321</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">staging</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">testserver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.1.26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_ssh_pass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123321</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici la structure du fichier d&#x27;inventaire au format YAML :</p>
<p>Le groupe <code>all</code> englobe tous les hôtes. (il doit être défini explicitement avec le format YAML).</p>
<p>Ensuite, les groupes enfants (<code>children</code>) englobent les deux sous-groupes <code>production</code> et <code>staging</code>.</p>
<p>Chaque groupe définit une liste de <code>hosts</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="les-variables-en-ansible">Les variables en Ansible<a href="#les-variables-en-ansible" class="hash-link" aria-label="Lien direct vers Les variables en Ansible" title="Lien direct vers Les variables en Ansible">​</a></h2>
<p>Les variables rendent les playbooks plus flexibles et adaptables. Ansible remplace la variable par sa valeur lorsqu&#x27;une tâche est exécutée.</p>
<p>Il existe au total une vingtaine de méthodes différentes pour définir une variable dans Ansible. Elles sont traitées selon un ordre de priorité (<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#understanding-variable-precedence" target="_blank" rel="noopener noreferrer">consultez la documentation officielle sur les priorités des variables Ansible</a>).</p>
<p>Voici quelques exemples de façons de définir une variable :</p>
<ul>
<li>Dans l&#x27;inventaire avec <code>vars</code>.</li>
<li>Dans la section <code>vars</code> d&#x27;un playbook.</li>
<li>Dans les dossiers group_vars et host_vars à la racine du projet à l&#x27;aide de fichiers YAML.</li>
<li>Au niveau de la commande <code>ansible-playbook</code> avec l&#x27;argument <code>-e</code> ou <code>--extra-vars</code>.</li>
</ul>
<p>Pour comprendre et pratiquer, faisons quelques exemples.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="définissez-les-variables-dans-le-fichier-dinventaire">Définissez les variables dans le fichier d&#x27;inventaire<a href="#définissez-les-variables-dans-le-fichier-dinventaire" class="hash-link" aria-label="Lien direct vers Définissez les variables dans le fichier d&#x27;inventaire" title="Lien direct vers Définissez les variables dans le fichier d&#x27;inventaire">​</a></h3>
<p>Ajoutez dans la section <code>vars</code> une variable nommée <code>var1</code> avec la valeur &#x27;var1 from inventory&#x27; dans votre fichier <code>00_inventory.yaml</code> :</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">all</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">children</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">production</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">prodserver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.1.66</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_ssh_pass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123321</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">vars</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">var1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;var1 from inventory&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">staging</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">testserver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.1.26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_ssh_pass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123321</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">vars</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">var1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;var1 from inventory&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans votre playbook <code>my-first-playbook.yaml</code>, ajoutez une tâche qui utilise le module <code>debug</code> pour afficher la valeur de cette variable :</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Test de connectivité avec les serveurs cibles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Test de ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ping</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Valeur de la variable var1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">debug</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ var1 }}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Exécutez le playbook avec la commande <code> ansible-playbook my-first-playbook.yaml -i 00_inventory.yml</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-playbook my-first-playbook.yaml -i 00_inventory.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY [Test de connectivité avec les serveurs cibles] *****************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Gathering Facts] ***********************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Test de ping] **************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [affichage] *****************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver] =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;msg&quot;: &quot;var1 from inventory&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver] =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;msg&quot;: &quot;var1 from inventory&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY RECAP ***********************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testserver                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="définissez-les-variables-dans-le-playbook">Définissez les variables dans le playbook<a href="#définissez-les-variables-dans-le-playbook" class="hash-link" aria-label="Lien direct vers Définissez les variables dans le playbook" title="Lien direct vers Définissez les variables dans le playbook">​</a></h3>
<p>Maintenant, ajoutez la variable <code>var1</code> dans le playbook :</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Test de connectivité avec les serveurs cibles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">vars</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">var1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;var1 from playbook&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Test de ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ping</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Valeur de la variable var1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">debug</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">msg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ var1 }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Exécutez le playbook avec la même commande. Vous pouvez constater que cette fois, la valeur affichée est &#x27;var1 from playbook&#x27;, indiquant ainsi que les variables définies au niveau du playbook ont priorité sur celles définies dans l&#x27;inventaire.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TASK </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Valeur de la variable var1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token important">************************************************************************************************************************************</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ok</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prodserver</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;msg&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;var1 from playbook&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ok</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">testserver</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">&quot;msg&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;var1 from playbook&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="passez-les-variables-à-partir-de-la-ligne-de-commande">Passez les variables à partir de la ligne de commande<a href="#passez-les-variables-à-partir-de-la-ligne-de-commande" class="hash-link" aria-label="Lien direct vers Passez les variables à partir de la ligne de commande" title="Lien direct vers Passez les variables à partir de la ligne de commande">​</a></h3>
<p>L&#x27;ordre de priorité le plus élevé se situe au niveau de la commande <code>ansible-playbook</code>. Lancez la commande suivante pour effectuer le test :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ansible-playbook my-first-playbook.yaml -e &quot;var1=&#x27;var1 from cmd&#x27;&quot;  -i 00_inventory.yml </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="structurez-vos-variables-avec-les-répertoires-host_vars-et-group_vars">Structurez vos variables avec les répertoires host_vars et group_vars<a href="#structurez-vos-variables-avec-les-répertoires-host_vars-et-group_vars" class="hash-link" aria-label="Lien direct vers Structurez vos variables avec les répertoires host_vars et group_vars" title="Lien direct vers Structurez vos variables avec les répertoires host_vars et group_vars">​</a></h3>
<p>La pratique recommandée pour fournir des variables dans l&#x27;inventaire est de les définir dans des fichiers situés dans deux répertoires distincts : <code>host_vars</code> et <code>group_vars</code> :</p>
<ul>
<li>host_vars : Ce répertoire contient des fichiers YAML spécifiques à chaque hôte, par exemple <code>prodserver.yml</code> <code>testserver.yml</code></li>
<li>group_vars :  Ce répertoire contient des fichiers YAML spécifiques à chaque groupe d&#x27;hôtes, par exemple <code>all.yml</code> <code>production.yml</code> <code>staging.yml</code></li>
</ul>
<blockquote>
<p>Remarque : Le nom du fichier YAML dans les répertoires <code>host_vars</code> et <code>group_vars</code> doit correspondre au nom de l&#x27;hôte ou du groupe auquel les variables sont destinées. Cela permet à Ansible d&#x27;associer automatiquement les variables du fichier avec l&#x27;hôte ou le groupe correspondant dans l&#x27;inventaire. Si non vous pouvez créer un dossier portant le nom de l&#x27;hôte, et à l&#x27;intérieur, vous pouvez choisir le nom que vous préférez pour votre fichier YAML de variables.</p>
</blockquote>
<p>Dans les fichiers YAML, les variables se définissent de la manière suivante :</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">nom_variable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> valeur_variable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="créez-un-utilisateur-standard-et-déployer-une-clé-ssh-sur-les-nodes">Créez un utilisateur standard et déployer une clé SSH sur les nodes<a href="#créez-un-utilisateur-standard-et-déployer-une-clé-ssh-sur-les-nodes" class="hash-link" aria-label="Lien direct vers Créez un utilisateur standard et déployer une clé SSH sur les nodes" title="Lien direct vers Créez un utilisateur standard et déployer une clé SSH sur les nodes">​</a></h2>
<p>Vous allez suivre les bonnes pratiques en créant un <strong>utilisateur standard</strong> afin de ne pas travailler directement avec le compte <strong>root</strong>.</p>
<p>Pour le <code>nodemanager</code>, nous avons créé l&#x27;utilisateur <code>user-ansible</code>. Jusqu&#x27;à présent, nous avons utilisé le compte root pour nous connecter aux nœuds, mais cela était dans le but de vous expliquer les principes d&#x27;Ansible ; c&#x27;était le seul compte dont nous disposions.</p>
<p>L&#x27;objectif est de créer un utilisateur <code>user-ansible</code> sur tous les nœuds <code>testserver</code> et <code>prodserver</code>. Vous pouvez le nommer autrement, mais l&#x27;avantage de choisir le même nom de compte est de ne pas spécifier le <code>username</code> lors de la connexion SSH.</p>
<p>Cet utilisateur doit également avoir le privilège sudo.</p>
<p>De plus, pour se connecter en SSH, il est recommandé d&#x27;utiliser une paire de clés plutôt que d&#x27;utiliser un mot de passe.</p>
<p>Voici donc le chemin expliquant la connexion SSH entre le <code>nodemanager</code> et les nodes. Le même compte <code>user-ansible</code> du serveur <code>nodemanager</code> doit être créé sur les nodes :</p>
<p>![Diagramme sans nom.drawio(1)](img\Diagramme sans nom.drawio(1).png)</p>
<p><strong>Pour accomplir cette tâche vous avez besoin de :</strong></p>
<ol>
<li>Se connecter au serveur <code>prodserver</code> , créer l&#x27;utilisateur <code>user-ansible</code> et l&#x27;ajouter au groupe <code>wheel</code> pour lui donner le privilège sudo.</li>
<li>Se connecter au serveur <code>testserver</code> , créer l&#x27;utilisateur <code>user-ansible</code> et l&#x27;ajouter au groupe <code>wheel</code> pour lui donner le privilège sudo.</li>
<li>Générer une paire de clés avec <code>ssh-keygen </code></li>
<li>Copier la clé publique sur les serveurs <code>prodserver</code> et <code>testserver</code> avec la commande <code>ssh-copy-id </code> par exemple.</li>
</ol>
<p>Etant donné que nous travaillons avec Ansible, il est très pratique et utile de créer un playbook qui automatise la création d&#x27;un utilisateur sur les nodes, c&#x27;est là l&#x27;intérêt. Puisque notre code est réutilisable, lors de l&#x27;ajout d&#x27;une nouvelle node à notre infrastructure, nous pouvons simplement lancer le playbook !</p>
<p>Sous le dossier  <code>devops-ansible-deployment</code> :</p>
<ol>
<li>Créez le fichier <code>all.yml</code> sous <code>group_vars/all</code></li>
<li>Créez le fichier <code>create_ansible_user.yml</code> sous <code>playbooks</code></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 00_inventory.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── group_vars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── all.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── playbooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── create_ansible_user.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans le fichier <code>all.yml</code>, ajoutez les variables suivantes :</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">ansible_user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user-ansible&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ansible_user_group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wheel&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>La variable <code>ansible_user</code> définit le nom du compte de l&#x27;utilisateur que vous allez créer sur les nœuds.</li>
<li>La variable <code>ansible_user_group</code> définit le groupe de l&#x27;utilisateur <code>wheel</code> (pour CentOS) afin qu&#x27;il puisse exécuter des commandes avec les privilèges de root.</li>
</ul>
<p>Nous avons également besoin de définir un mot de passe pour cet utilisateur, mais il doit être chiffré. Il ne faut surtout pas le laisser en clair. Pour cela, vous allez utiliser Ansible Vault pour chiffrer les données sensibles dans le fichier <code>all.yml</code>.</p>
<blockquote>
<p>Ansible Vault est un outil d&#x27;Ansible permettant de chiffrer de manière sécurisée les données sensibles, telles que les mots de passe, afin de renforcer la sécurité et la gestion centralisée dans les configurations automatisées.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="chiffrez-les-données-sensibles-avec-ansible-vault">Chiffrez les données sensibles avec Ansible Vault<a href="#chiffrez-les-données-sensibles-avec-ansible-vault" class="hash-link" aria-label="Lien direct vers Chiffrez les données sensibles avec Ansible Vault" title="Lien direct vers Chiffrez les données sensibles avec Ansible Vault">​</a></h3>
<p>Lancez la commande <code>ansible-vault create group_vars/all/vault.yml</code> pour créer un fichier chiffré ; Ansible vous demandera de saisir un mot de passe. Ensuite, ouvrez le fichier créé pour l&#x27;éditer, et ajoutez la variable <code>ansible_user_pass</code> définissant le mot de passe de l&#x27;utilisateur, par exemple <code>123321</code>. Il est recommandé d&#x27;utiliser un mot de passe robuste, notamment en environnement professionnel, bien que pour l&#x27;exemple, j&#x27;ai choisi le simple mot de passe <code>123321</code>. Vous avez la liberté de choisir le mot de passe qui convient à votre contexte.</p>
<p>N&#x27;oubliez pas le mot de passe que vous avez choisi pour chiffrer le fichier vault.yml ; sans lui, il vous sera impossible de déchiffrer le fichier ou de lire les valeurs des variables.</p>
<p>Ansible propose plusieurs actions à passer avec la commande <code>ansible-vault</code>, parmi lesquelles :</p>
<ol>
<li><code>create</code> : permet de créer un nouveau fichier chiffré en spécifiant un mot de passe.</li>
<li><code>decrypt</code> : elle est utilisée pour déchiffrer un fichier chiffré et rendre son contenu lisible.</li>
<li><code>edit</code> : permet de modifier le contenu d&#x27;un fichier chiffré de manière sécurisée en déchiffrant temporairement et en rechiffrant automatiquement lors de l&#x27;enregistrement.</li>
<li><code>view</code> : permet de consulter le contenu d&#x27;un fichier chiffré sans nécessiter de déchiffrement explicite.</li>
<li><code>encrypt</code> : elle est utilisée pour chiffrer un fichier existant.</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-vault create group_vars/all/vault.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">New Vault password: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Confirm New Vault password: </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici le contenu du fichier <code>vault.yml</code> après le chiffrement :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ANSIBLE_VAULT;1.1;AES256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">61666561393532663537346566363566373130653265313962313063366539383565643863386532</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6566343363326339613739356339353133333036383434320a373466356231313564333361363961</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">33383938316533643835366531663532656539386166643766316465383638383539616633633733</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6435613161363037310a663832663537356362653366386165316665646338346335313362373066</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">35623465356432393837366630303663666133343334333131313239303464623530</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>Pour modifier le fichier Il est recommandé d&#x27;utiliser <code>edit</code> au lieu de <code>decrypt/encrypt</code> afin de ne pas oublier de rechiffrer le fichier après modification.</p>
</blockquote>
<p>Visualisez le contenu de votre fichier <code>vault.yml</code> avec l&#x27;action <code>view</code> de <code>ansible-vault</code> et l&#x27;option <code>--ask-vault</code> :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-vault view group_vars/all/vault.yml --ask-vault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Vault password: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ansible_user_pass: 123321</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>L&#x27;option <code>--ask-vault</code> permet de demander à l&#x27;utilisateur de fournir le mot de passe utilisé lors du chiffrement. Vous pouvez également l&#x27;utiliser avec les commandes <code>ansible</code> et <code>ansible-playbook</code>.</p>
<p>Alternativement, vous pouvez sauvegarder le mot de passe dans un fichier texte, par exemple, sous le dossier home de l&#x27;utilisateur, et indiquer à Ansible le chemin vers ce fichier avec l&#x27;option <code>--vault-password-file ~/.passvault.txt</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-vault view group_vars/all/vault.yml --vault-password-file ~/.passvault.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ansible_user_pass: 123321</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Une autre méthode consiste à fournir le chemin du fichier en utilisant la variable d&#x27;environnement <code>ANSIBLE_VAULT_PASSWORD_FILE</code> :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export ANSIBLE_VAULT_PASSWORD_FILE=~/.passvault.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>Le fichier contenant le mot de passe doit être bien sécurisé et ne pas être accessible à tout le monde.</p>
</blockquote>
<p>Exportez le chemin vers le fichier contenant le mot de passe. Cela vous sera utile par la suite pour lancer les commandes Ansible sans interaction manuelle, surtout dans le cadre de notre pipeline CI/CD.</p>
<p>Pour persister l&#x27;exportation de la variable d&#x27;environnement <code>ANSIBLE_VAULT_PASSWORD_FILE=~/.passvault.txt</code>, vous pouvez l&#x27;ajouter au fichier  <code>~/.bash_profile</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ~]$ cat .bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># .bash_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Get the aliases and functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ -f ~/.bashrc ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        . ~/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># User specific environment and startup programs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PATH=$PATH:$HOME/.local/bin:$HOME/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ANSIBLE_VAULT_PASSWORD_FILE=~/.passvault.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Maintenant, dans votre fichier <code>all.yml</code>, ajoutez la variable <code>ansible_user_pass</code>. Sa valeur sera une référence vers la variable définie dans <code>vault.yml</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ansible_user: &quot;user-ansible&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ansible_user_group: &quot;wheel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ansible_user_pass: &quot;{{ vault_ansible_user_pass }}&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>En effet, l&#x27;ajout de la référence <code>ansible_user_pass: &quot;{{ vault_ansible_user_pass }}&quot;</code> n&#x27;est pas obligatoire, mais elle vous offre une visibilité claire quant à l&#x27;utilisation de variables chiffrées. Puisque le fichier Vault est chiffré, si vous ne spécifiez pas de référence dans votre fichier <code>all.yml</code>, vous ne pouvez pas voir où cette variable est définie.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="créez-le-compte-utilisateur-avec-ansible-playbook">Créez le compte utilisateur avec Ansible Playbook<a href="#créez-le-compte-utilisateur-avec-ansible-playbook" class="hash-link" aria-label="Lien direct vers Créez le compte utilisateur avec Ansible Playbook" title="Lien direct vers Créez le compte utilisateur avec Ansible Playbook">​</a></h3>
<p>Voici le contenu du playbook <code>create_ansible_user.yml</code> qui automatise les étapes de création d&#x27;un nouvel utilisateur mentionnées au début de cette section :</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Create a new user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Create ~/.ssh directory if none exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/home/{{ ansible_user }}/.ssh&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0700&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">run_once</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">delegate_to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Generate SSH key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">openssh_keypair</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/home/{{ansible_user}}/.ssh/id_rsa&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">force</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">run_once</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">delegate_to</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Create a new user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ ansible_user }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">shell</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">groups</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ ansible_user_group }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">append</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ ansible_user_pass | password_hash(&#x27;sha512&#x27;) }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">become</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Add user to the sudoers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">copy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">dest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/etc/sudoers.d/{{ ansible_user }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ ansible_user }}  ALL=(ALL)  NOPASSWD: ALL&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">become</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deploy SSH Key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">authorized_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ ansible_user }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ lookup(&#x27;file&#x27;, &#x27;/home/{{ansible_user}}/.ssh/id_rsa.pub&#x27;) }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">become</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le playbook cible tous les hôtes avec le groupe <code>all</code> et définit 5 tâches :</p>
<ol>
<li>On utilise le module <code>file</code> pour créer le répertoire <code>~/.ssh</code>. <code>delegate_to: localhost</code> exécute cette tâche localement sur le <code>nodemanager</code>, elle doit donc être exécutée qu&#x27;une seule fois grâce à <code>run_once: yes</code>. Cela est d&#x27;autant plus important, car deux nœuds, <code>prodserver</code> et <code>testserver</code>, sont définis.</li>
<li>On génère la paire de clés SSH avec le module <code>openssh_keypair</code>. Son chemin est dans le dossier home de l&#x27;utilisateur, et on utilise la variable <code>name: &quot;{{ ansible_user }}&quot;</code> définie dans les group_vars, qui est <code>user-ansible</code>.</li>
<li>On crée l&#x27;utilisateur avec le module <code>user</code>. Le mot de passe <code>ansible_user_pass</code> est celui stocké dans le fichier <code>vault.yml</code>, et il doit être hashé avec <code>password_hash(&#x27;sha512&#x27;)</code>.</li>
<li>On utilise le module <code>copy</code> pour créer un fichier dans <code>/etc/sudoers.d/</code> autorisant l&#x27;utilisateur à utiliser sudo sans mot de passe.</li>
<li>Finalement, on utilise le module <code>authorized_key</code> pour copier la clé publique sur les nœuds. Le <code>lookup file</code> permet de chercher la clé publique générée dans le dossier home de l&#x27;utilisateur.</li>
</ol>
<blockquote>
<p>Le state <code>present</code> indique que le fichier doit exister sur le node cible. Si le fichier n&#x27;existe pas, Ansible le créera. Si le fichier existe déjà, Ansible ne fera rien, car l&#x27;état (<code>state</code>) est déjà conforme à ce qui est spécifié (<code>present</code>). L&#x27;autre état possible est <code>absent</code>. Si vous souhaitez supprimer le fichier, vous pouvez consulter la documentation de chaque module pour connaître les valeurs possibles du paramètre <code>state</code>.</p>
</blockquote>
<p>Lancez votre playbook :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-playbook -i 00_inventory.yml playbooks/create_ansible_user.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY [Create a new user] *****************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Gathering Facts] **********************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Create ~/.ssh directory if none exists] *****************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver -&gt; localhost]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [generate SSH key] *********************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver -&gt; localhost]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [create a new user] ********************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [add user to the sudoers] **************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Deploy SSH Key] ***********************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY RECAP **********************************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testserver                 : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vous pouvez constater que le compte utilisateur a été créé avec succès !</p>
<p>Testez alors la connexion SSH aux deux serveurs <code>prodserver</code> et <code>testserver</code> depuis le terminal du serveur <code>nodemanager</code>. Vous devriez vous connecter sans spécifier le mot de passe :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ~]$ ssh 192.168.1.26</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last login: Mon Jan  8 17:51:18 2024 from 192.168.1.173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@testserver ~]$ exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">déconnexion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection to 192.168.1.26 closed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ~]$ ssh 192.168.1.66</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last login: Mon Jan  8 17:51:57 2024 from 192.168.1.173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@prodserver ~]$ exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">déconnexion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection to 192.168.1.66 closed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager ~]$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Maintenant, dans votre fichier <code>00_inventory.yml</code>, vous pouvez supprimer les paramètres <code>ansible_user</code> et <code>ansible_ssh_pass</code>. Vous n&#x27;en aurez plus besoin dorénavant, Ansible utilisera la paire de clés SSH pour se connecter aux nodes, ainsi que l&#x27;utilisateur <code>user-ansible</code>.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">all</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">children</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">production</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">prodserver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.1.66</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">staging</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">testserver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ansible_host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.1.26</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installez-docker-sur-les-nodes-avec-ansible-playbook">Installez docker sur les nodes avec Ansible Playbook<a href="#installez-docker-sur-les-nodes-avec-ansible-playbook" class="hash-link" aria-label="Lien direct vers Installez docker sur les nodes avec Ansible Playbook" title="Lien direct vers Installez docker sur les nodes avec Ansible Playbook">​</a></h2>
<p>Notre application Spring Boot est conteneurisée avec Docker. Ainsi, pour le déploiement, nous avons besoin de Docker installé sur les nodes <code>prodserver</code> et <code>testserver</code>.</p>
<p>Vous allez également utiliser un playbook pour installer Docker sur les nodes. Créez un playbook <code>docker_install.yml</code> sous le dossier <code>playbooks/</code></p>
<p>Voici son contenu :</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install docker Engine on CentOS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">become</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Remove docker if installed from CentOS repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">yum</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">logrotate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">logrotate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> removed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install yum utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">yum</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> yum</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mapper</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">persistent</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> lvm2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> latest      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Add Docker repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">get_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//download.docker.com/linux/centos/docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ce.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">dest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/yum.repos.d/docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ce.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install Docker Engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">yum</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ce</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> containerd.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">buildx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">compose</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Start Docker service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> started</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Add user {{ ansible_user }} to docker group&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ ansible_user }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">groups</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">append</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans ce playbook, j&#x27;ai simplement traduit les étapes d&#x27;installation de Docker Engine sur CentOS, telles qu&#x27;indiquées dans <a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener noreferrer">la documentation officielle</a> de Docker, en tant que tâches Ansible.</p>
<p>La dernière tâche, <code>Add user {{ ansible_user }} to docker group</code>, permet d&#x27;ajouter l&#x27;utilisateur <code>user-ansible</code> que nous avons créé au groupe Docker. Cela lui permettra d&#x27;interagir avec le moteur Docker sans avoir besoin des privilèges <code>sudo</code>.</p>
<p>Lancez le playbook :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-playbook -i 00_inventory.yml playbooks/docker-install.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY [Install docker Engine on CentOS] ******************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Gathering Facts] **********************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Remove docker if installed from CentOS repo] ******************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver] =&gt; (item=[u&#x27;docker&#x27;, u&#x27;docker-client&#x27;, u&#x27;docker-client-latest&#x27;, u&#x27;docker-common&#x27;, u&#x27;docker-latest&#x27;, u&#x27;docker-latest-logrotate&#x27;, u&#x27;docker-logrotate&#x27;, u&#x27;docker-engine&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver] =&gt; (item=[u&#x27;docker&#x27;, u&#x27;docker-client&#x27;, u&#x27;docker-client-latest&#x27;, u&#x27;docker-common&#x27;, u&#x27;docker-latest&#x27;, u&#x27;docker-latest-logrotate&#x27;, u&#x27;docker-logrotate&#x27;, u&#x27;docker-engine&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Install yum utils] ********************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver] =&gt; (item=[u&#x27;yum-utils&#x27;, u&#x27;device-mapper-persistent-data&#x27;, u&#x27;lvm2&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver] =&gt; (item=[u&#x27;yum-utils&#x27;, u&#x27;device-mapper-persistent-data&#x27;, u&#x27;lvm2&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Add Docker repo] **********************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Install Docker Engine] ****************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver] =&gt; (item=[u&#x27;docker-ce&#x27;, u&#x27;docker-ce-cli&#x27;, u&#x27;containerd.io&#x27;, u&#x27;docker-buildx-plugin&#x27;, u&#x27;docker-compose-plugin&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver] =&gt; (item=[u&#x27;docker-ce&#x27;, u&#x27;docker-ce-cli&#x27;, u&#x27;containerd.io&#x27;, u&#x27;docker-buildx-plugin&#x27;, u&#x27;docker-compose-plugin&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Start Docker service] *****************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Add user user-ansible to docker group] ************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY RECAP **********************************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver                 : ok=7    changed=5    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testserver                 : ok=7    changed=5    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sur les nodes, vous pouvez vérifier que Docker a bien été installé :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@prodserver ~]$ docker --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Docker version 24.0.7, build afdd53b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@testserver ~]$ docker --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Docker version 24.0.7, build afdd53b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configurez-docker-pour-le-déploiement">Configurez docker pour le déploiement<a href="#configurez-docker-pour-le-déploiement" class="hash-link" aria-label="Lien direct vers Configurez docker pour le déploiement" title="Lien direct vers Configurez docker pour le déploiement">​</a></h2>
<p>Pour déployer l&#x27;application Spring Boot, nous récupérerons l&#x27;image Docker publiée sur le registre privé (Nexus3). Dans cette étape, nous utiliserons la version <code>latest</code> comme version par défaut. Ensuite, dans notre pipeline CI/CD, nous aborderons l&#x27;automatisation de la gestion des versions.</p>
<p>Cependant, rappelez-vous que le registre privé n&#x27;est accessible que via HTTP. Il est donc nécessaire de configurer Docker sur chaque serveur pour autoriser la communication avec les registres non sécurisés. Nous avons déjà effectué cette configuration manuellement pour Docker sur le <code>masterserver</code>. À présent, vous allez tirer parti d&#x27;Ansible pour automatiser cette tâche !</p>
<p>Petit rappel : pour autoriser la communication avec les registres non sécurisés, il suffit de les ajouter au fichier <code>daemon.json</code> sous <code>/etc/docker</code>.</p>
<p>Avec Ansible, pour copier le fichier sur les nœuds, vous pouvez utiliser le module <code>copy</code> ou <code>template</code>. Nous opterons pour l&#x27;utilisation du module <code>template</code>.</p>
<blockquote>
<p>L&#x27;utilisation de templates au lieu du module <code>copy</code> dans Ansible offre une flexibilité à l&#x27;aide du moteur de templates Jinja2.</p>
<p>Jinja2 se présente comme un système de templates puissant, applicable non seulement directement dans vos playbooks grâce aux filtres, mais aussi pour la génération dynamique de fichiers par exemple (le remplacement dynamique des variables).</p>
<p>Consultez la documentation officielle sur <a href="https://docs.ansible.com/ansible/2.9/user_guide/playbooks_templating.html" target="_blank" rel="noopener noreferrer">les templates Jinja avec Ansible</a> pour en savoir plus</p>
</blockquote>
<p>Créez le fichier <code>daemon.json.j2</code> sous le dossier playbooks &gt; templates :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 00_inventory.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── group_vars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── all.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── vault.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── playbooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── create_ansible_user.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── docker_install.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── templates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── daemon.json.j2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici son contenu :</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ cat playbooks/templates/daemon.json.j2 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;insecure-registries&quot;: [&quot;http://prod.local:5002&quot;, &quot;http://prod.local:5003&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans le dossier playbooks, créez un le playbook <code>docker_config.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Configure Docker daemon.json for insecure registries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">become</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Create daemon.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">src</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> templates/daemon.json.j2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">dest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/docker/daemon.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">notify</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restart Docker Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> add domaine to /etc/hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">lineinfile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">line</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;192.168.1.137 prod.local&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handlers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restart Docker Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">systemd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> restarted</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le module <code>template</code> prend en compte la source, qui est le fichier que vous venez de créer, ainsi que la destination vers laquelle il sera copié. Il est ensuite nécessaire de redémarrer Docker pour qu&#x27;il prenne en compte ces modifications. <code>notify</code> permet de déclencher le <code>handler</code> &#x27;Restart Docker Service&#x27;, qui utilise tout simplement le module <code>systemd</code> pour redémarrer le service Docker.</p>
<p>Vous pouvez également profiter de ce playbook de configuration pour ajouter le nom de domaine local <code>prod.local</code> qui pointe vers le <code>masterserver</code> où nous allons installer Nexus.</p>
<p>Il ne vous reste plus qu&#x27;à tester. Exécutez alors le playbook :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-playbook -i 00_inventory.yml playbooks/docker_config.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY [Configure Docker daemon.json for insecure registries] *********************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Gathering Facts] **********************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Create daemon.json] *******************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [add domaine to /etc/hosts] ************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUNNING HANDLER [Restart Docker Service] ****************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY RECAP **********************************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver                 : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testserver                 : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vous pouvez vérifier sur les nodes que le fichier a été bien ajouté :</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@testserver ~]$ cat /etc/docker/daemon.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;insecure-registries&quot;: [&quot;http://prod.local:5002&quot;, &quot;http://prod.local:5003&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour le nom de domaine également, vous pouvez effectuer un ping pour vérifier que tout fonctionne comme prévu.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@testserver ~]$ cat /etc/hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1   localhost testserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::1         localhost testserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.1.137 prod.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@testserver ~]$ ping prod.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PING prod.local (192.168.1.137) 56(84) bytes of data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from prod.local (192.168.1.137): icmp_seq=1 ttl=64 time=0.345 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from prod.local (192.168.1.137): icmp_seq=2 ttl=64 time=0.584 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from prod.local (192.168.1.137): icmp_seq=3 ttl=64 time=0.963 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--- prod.local ping statistics ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 packets transmitted, 3 received, 0% packet loss, time 2041ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rtt min/avg/max/mdev = 0.345/0.630/0.963/0.256 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="déployez-votre-application">Déployez votre application<a href="#déployez-votre-application" class="hash-link" aria-label="Lien direct vers Déployez votre application" title="Lien direct vers Déployez votre application">​</a></h2>
<p>La dernière étape dans cette section consiste à automatiser le déploiement de votre application avec Ansible.</p>
<p>Vous aurez besoin de vous connecter au registre Docker privé. L&#x27;identifiant et le mot de passe de l&#x27;utilisateur doivent être enregistrés dans un endroit sécurisé. Effectuez ensuite une modification (<code>edit</code>) du fichier <code>vault.yml</code> pour ajouter <code>nexus_registry_username</code> et <code>nexus_registry_password</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-vault edit group_vars/all/vault.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-vault view group_vars/all/vault.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ansible_user_pass: 123321</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nexus_registry_username: admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nexus_registry_password: 123321</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Utilisez le même compte que celui que vous avez utilisé dans la section Nexus. Dans mon cas, j&#x27;utilise toujours le compte &quot;admin&quot; pour la démo. Cependant, en entreprise, il est recommandé de créer un compte utilisateur dédié et de gérer les autorisations en conséquence.</p>
<p>Dans votre fichier <code>all.yml</code>ajouter les variables suivantes :</p>
<ol>
<li>nexus_registry_username</li>
<li>nexus_registry_password</li>
<li>nexus_registry_url</li>
<li>docker_image_name</li>
<li>docker_image_tag</li>
<li>docker_container_name</li>
<li>docker_container_port</li>
</ol>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">ansible_user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user-ansible&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ansible_user_group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wheel&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ansible_user_pass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ vault_ansible_user_pass }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">nexus_registry_username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ vault_nexus_registry_username }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">nexus_registry_password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ vault_nexus_registry_password }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">nexus_registry_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;prod.local:5003&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">docker_image_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;devops-project-samples&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">docker_image_tag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;latest&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">docker_container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;springbootapp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">docker_container_port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;7070&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans la section précédente, nous avons construit l&#x27;image <code>devops-project-samples</code> en version <code>latest</code>. Dans notre pipeline CI/CD, nous pourrons redéfinir <code>docker_image_tag</code> pour spécifier la version de l&#x27;image Docker créée lors du processus de build.</p>
<p><strong>Les étapes nécessaires pour déployer l&#x27;application :</strong></p>
<p>Avec un playbook Ansible, vous allez automatiser les étapes suivantes :</p>
<ol>
<li>Arrêter le conteneur s&#x27;il existe et le supprimer.</li>
<li>Supprimer l&#x27;ancienne image Docker.</li>
<li>S&#x27;authentifier au registre privé.</li>
<li>Récupérer la nouvelle image Docker.</li>
<li>Démarrer le conteneur.</li>
</ol>
<p>Créez alors le fichier <code>deploy_playbook.yml</code>à la racine de votre fichier :</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> deploy app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stop and remove existing container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">docker_container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ docker_container_name }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> absent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ignore_errors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes  </span><span class="token comment" style="color:#999988;font-style:italic"># Ignore if the container does not exist</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Prune unused Docker images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker image prune </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Log in to Nexus registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">docker_login</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">registry_url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ nexus_registry_url }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ nexus_registry_username }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ nexus_registry_password }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">reauthorize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pull the image from Nexus registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">docker_image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ nexus_registry_url }}/{{ docker_image_name }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pull</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">tag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ docker_image_tag }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Start the new container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">docker_container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ docker_container_name }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ nexus_registry_url }}/{{ docker_image_name }}:{{ docker_image_tag }}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{{ docker_container_port }}:7070&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">state</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> started</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ensuite, lancez l&#x27;exécution du playbook :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@nodemanager devops-ansible-deployment]$ ansible-playbook -i 00_inventory.yml deploy_playbook.yml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY [Manage Docker image from a private Nexus registry] ************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Gathering Facts] **********************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Stop and remove existing container] ***************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Prune unused Docker images] ***********************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Log in to Nexus registry] *************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARNING]: The value ******** (type int) in a string field was converted to u&#x27;********&#x27; (type string). If this does not look like what you expect, quote the entire value to ensure it does not change.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Pull the image from Nexus registry] ***************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TASK [Start the new container] **************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [prodserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">changed: [testserver]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PLAY RECAP **********************************************************************************************************************************************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prodserver                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">testserver                 : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Il est temps de vérifier  que notre application est déployée, faites un <code>docker ps</code> sur les nodes pour vérifier que le conteneur est en train d&#x27;exécution</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@testserver ~]$ docker ps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID   IMAGE                                           COMMAND                  CREATED         STATUS         PORTS                    NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2324c87eb469   prod.local:5003/devops-project-samples:latest   &quot;java -jar /opt/app/…&quot;   4 minutes ago   Up 4 minutes   0.0.0.0:7070-&gt;7070/tcp   springbootapp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vous pouvez donc accéder à l&#x27;application avec l&#x27;adresse IP du node et le port <code>7070</code>. Voici la réponse du <code>testserver</code> :</p>
<p><img decoding="async" loading="lazy" alt="image-20240114173746864" src="/assets/images/image-20240114173746864-e7ac4b975193f8006a767f741274c1de.png" width="519" height="190" class="img_ev3q"></p>
<p>Sur le <code>prodserver</code> :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[user-ansible@prodserver ~]$ docker ps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID   IMAGE                                           COMMAND                  CREATED         STATUS         PORTS                    NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a7775d71725e   prod.local:5003/devops-project-samples:latest   &quot;java -jar /opt/app/…&quot;   5 minutes ago   Up 5 minutes   0.0.0.0:7070-&gt;7070/tcp   springbootapp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="image-20240114173649623" src="/assets/images/image-20240114173649623-bcba92667e41070079573c3b245934fa.png" width="516" height="188" class="img_ev3q"></p>
<p><strong>C&#x27;est tout bon !</strong> Notre application est déployée sur les deux serveurs. Si vous relancez le playbook, elle sera donc redéployée !</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/devops/Créez un registre docker privé et un docker hub proxy avec Nexus"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Créez un registre docker privé et un docker hub proxy avec Nexus</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/devops/Gérez le Versioning en livraison continue"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">Gérez le Versioning en livraison continue</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mode-de-fonctionnement" class="table-of-contents__link toc-highlight">Mode de fonctionnement</a></li><li><a href="#identifiez-votre-architecture-technique-pour-ansible" class="table-of-contents__link toc-highlight">Identifiez votre architecture technique pour Ansible</a></li><li><a href="#créez-un-simple-utilisateur" class="table-of-contents__link toc-highlight">Créez un simple utilisateur</a></li><li><a href="#installez-ansible" class="table-of-contents__link toc-highlight">Installez Ansible</a></li><li><a href="#créez-votre-environnement-de-travail" class="table-of-contents__link toc-highlight">Créez votre environnement de travail</a><ul><li><a href="#développez-à-distance-avec-ssh-dans-vs-code" class="table-of-contents__link toc-highlight">Développez à distance avec SSH dans VS Code</a></li></ul></li><li><a href="#ansible-inventory-linventaire-des-nodes" class="table-of-contents__link toc-highlight">Ansible Inventory (l&#39;inventaire des nodes)</a></li><li><a href="#créez-le-fichier-inventaire-ansible" class="table-of-contents__link toc-highlight">Créez le fichier inventaire Ansible</a></li><li><a href="#type-dinstances-dans-linventaire-dansible" class="table-of-contents__link toc-highlight">Type d&#39;instances dans l&#39;inventaire d&#39;Ansible</a></li><li><a href="#les-modules" class="table-of-contents__link toc-highlight">Les modules</a></li><li><a href="#vérifiez-la-communication-avec-les-nodes" class="table-of-contents__link toc-highlight">Vérifiez la communication avec les nodes</a><ul><li><a href="#utilisez-ansible-en-mode-impératif-ad-hoc-avec-la-commande-ansible" class="table-of-contents__link toc-highlight">Utilisez Ansible en mode impératif (ad-hoc) avec la commande Ansible</a></li><li><a href="#utilisez-ansible-en-mode-déclaratif-ansible-playbook" class="table-of-contents__link toc-highlight">Utilisez Ansible en mode déclaratif (ansible-playbook)</a></li><li><a href="#la-structure-dun-playbook" class="table-of-contents__link toc-highlight">La structure d&#39;un playbook</a></li></ul></li><li><a href="#utilisez-lextension-vs-code-ansible" class="table-of-contents__link toc-highlight">Utilisez l&#39;extension VS Code Ansible</a></li><li><a href="#passez-au-format-yaml-avec-le-fichier-dinventaire" class="table-of-contents__link toc-highlight">Passez au format YAML avec le fichier d&#39;inventaire</a></li><li><a href="#les-variables-en-ansible" class="table-of-contents__link toc-highlight">Les variables en Ansible</a><ul><li><a href="#définissez-les-variables-dans-le-fichier-dinventaire" class="table-of-contents__link toc-highlight">Définissez les variables dans le fichier d&#39;inventaire</a></li><li><a href="#définissez-les-variables-dans-le-playbook" class="table-of-contents__link toc-highlight">Définissez les variables dans le playbook</a></li><li><a href="#passez-les-variables-à-partir-de-la-ligne-de-commande" class="table-of-contents__link toc-highlight">Passez les variables à partir de la ligne de commande</a></li><li><a href="#structurez-vos-variables-avec-les-répertoires-host_vars-et-group_vars" class="table-of-contents__link toc-highlight">Structurez vos variables avec les répertoires host_vars et group_vars</a></li></ul></li><li><a href="#créez-un-utilisateur-standard-et-déployer-une-clé-ssh-sur-les-nodes" class="table-of-contents__link toc-highlight">Créez un utilisateur standard et déployer une clé SSH sur les nodes</a><ul><li><a href="#chiffrez-les-données-sensibles-avec-ansible-vault" class="table-of-contents__link toc-highlight">Chiffrez les données sensibles avec Ansible Vault</a></li><li><a href="#créez-le-compte-utilisateur-avec-ansible-playbook" class="table-of-contents__link toc-highlight">Créez le compte utilisateur avec Ansible Playbook</a></li></ul></li><li><a href="#installez-docker-sur-les-nodes-avec-ansible-playbook" class="table-of-contents__link toc-highlight">Installez docker sur les nodes avec Ansible Playbook</a></li><li><a href="#configurez-docker-pour-le-déploiement" class="table-of-contents__link toc-highlight">Configurez docker pour le déploiement</a></li><li><a href="#déployez-votre-application" class="table-of-contents__link toc-highlight">Déployez votre application</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/devops-cicd-pipeline">Articles</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mossaab-frifita-17ba44138" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/MossaabFrifita" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mossaab Frifita. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>