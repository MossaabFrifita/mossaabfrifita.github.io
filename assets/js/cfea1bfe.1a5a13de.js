"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[2781],{3893:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=r(5893),t=r(1151);const i={sidebar_position:1,tags:["Angular16","JWT","RefreshToken","Authentification","Autorisation","HttpOnlyCookies","RoleBasedAccessControl"]},o="Angular 16 : Mettre en place l'authentification et l'autorisation bas\xe9e sur les r\xf4les",a={id:"Angular/angular",title:"Angular 16 : Mettre en place l'authentification et l'autorisation bas\xe9e sur les r\xf4les",description:"L'authentification et l'autorisation sont des \xe9l\xe9ments essentiels de toute application web moderne. Dans l'article pr\xe9c\xe9dent, nous avons explor\xe9 comment impl\xe9menter un syst\xe8me d'authentification robuste en utilisant JWT (JSON Web Tokens) avec Spring Boot et Spring Security. Nous avons ainsi cr\xe9\xe9 une API REST s\xe9curis\xe9e. Le code source est disponible sur Github.",source:"@site/docs/Angular/angular.md",sourceDirName:"Angular",slug:"/Angular/",permalink:"/docs/Angular/",draft:!1,unlisted:!1,tags:[{label:"Angular16",permalink:"/docs/tags/angular-16"},{label:"JWT",permalink:"/docs/tags/jwt"},{label:"RefreshToken",permalink:"/docs/tags/refresh-token"},{label:"Authentification",permalink:"/docs/tags/authentification"},{label:"Autorisation",permalink:"/docs/tags/autorisation"},{label:"HttpOnlyCookies",permalink:"/docs/tags/http-only-cookies"},{label:"RoleBasedAccessControl",permalink:"/docs/tags/role-based-access-control"}],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,tags:["Angular16","JWT","RefreshToken","Authentification","Autorisation","HttpOnlyCookies","RoleBasedAccessControl"]},sidebar:"tutorialSidebar",previous:{title:"Angular",permalink:"/docs/category/angular"}},l={},c=[{value:"Quel est le meilleur endroit pour stocker les tokens C\xf4t\xe9 Client ?",id:"quel-est-le-meilleur-endroit-pour-stocker-les-tokens-c\xf4t\xe9-client-",level:2},{value:"L&#39;Avantage du Cookie HTTP Only avec Secure=true et SameSite=Strict",id:"lavantage-du-cookie-http-only-avec-securetrue-et-samesitestrict",level:2},{value:"<strong>Modification de l&#39;API Spring Boot pour Int\xe9grer la Gestion de Cookies en Session HTTP Only</strong>",id:"modification-de-lapi-spring-boot-pour-int\xe9grer-la-gestion-de-cookies-en-session-http-only",level:2},{value:"Modification du JwtService et du refreshTokenService",id:"modification-du-jwtservice-et-du-refreshtokenservice",level:3},{value:"<strong>G\xe9n\xe9ration d&#39;un Cookie JWT S\xe9curis\xe9</strong>",id:"g\xe9n\xe9ration-dun-cookie-jwt-s\xe9curis\xe9",level:4},{value:"<strong>R\xe9cup\xe9ration du JWT \xe0 partir des Cookies</strong>",id:"r\xe9cup\xe9ration-du-jwt-\xe0-partir-des-cookies",level:4},{value:"<strong>Suppression du Cookie JWT</strong>",id:"suppression-du-cookie-jwt",level:4},{value:"Int\xe9gration de la r\xe9cup\xe9ration du Cookie JWT dans le Filtre JwtAuthenticationFilter",id:"int\xe9gration-de-la-r\xe9cup\xe9ration-du-cookie-jwt-dans-le-filtre-jwtauthenticationfilter",level:3},{value:"Modification du contr\xf4leur AuthenticationController",id:"modification-du-contr\xf4leur-authenticationcontroller",level:3},{value:"Impl\xe9mentation de l&#39;Authentification et de l&#39;Autorisation dans Angular 16",id:"impl\xe9mentation-de-lauthentification-et-de-lautorisation-dans-angular-16",level:2},{value:"Cr\xe9ation du projet Angular",id:"cr\xe9ation-du-projet-angular",level:3},{value:"Pr\xe9requis :",id:"pr\xe9requis-",level:4},{value:"Cr\xe9ation des mod\xe8les User et Role",id:"cr\xe9ation-des-mod\xe8les-user-et-role",level:3},{value:"Cr\xe9ation du service Storage",id:"cr\xe9ation-du-service-storage",level:3},{value:"Comprendre le m\xe9canisme d&#39;authentification avec des cookies HTTP-only",id:"comprendre-le-m\xe9canisme-dauthentification-avec-des-cookies-http-only",level:3},{value:"Cr\xe9ation du service Authentification",id:"cr\xe9ation-du-service-authentification",level:3},{value:"Module de routage d&#39;application",id:"module-de-routage-dapplication",level:3},{value:"Garde d&#39;authentification",id:"garde-dauthentification",level:3},{value:"Cr\xe9ation de la page login",id:"cr\xe9ation-de-la-page-login",level:3},{value:"Cr\xe9ation d&#39;une barre de navigation dynamique",id:"cr\xe9ation-dune-barre-de-navigation-dynamique",level:3},{value:"Impl\xe9mentation de la m\xe9thode logout dans le service authService",id:"impl\xe9mentation-de-la-m\xe9thode-logout-dans-le-service-authservice",level:3},{value:"Cr\xe9ation du service User",id:"cr\xe9ation-du-service-user",level:3},{value:"Cr\xe9ation de la page Home",id:"cr\xe9ation-de-la-page-home",level:3},{value:"Cr\xe9ation de la page Admin",id:"cr\xe9ation-de-la-page-admin",level:3},{value:"Impl\xe9mentation de la m\xe9thode refreshToken dans le service authService",id:"impl\xe9mentation-de-la-m\xe9thode-refreshtoken-dans-le-service-authservice",level:3},{value:"Gestion des Erreurs avec les Intercepteurs HTTP Angular",id:"gestion-des-erreurs-avec-les-intercepteurs-http-angular",level:3},{value:"Cr\xe9ation du composant access-denied",id:"cr\xe9ation-du-composant-access-denied",level:3},{value:"Mise en place de l&#39;auto-login",id:"mise-en-place-de-lauto-login",level:3},{value:"D\xe9monstration",id:"d\xe9monstration",level:2},{value:"Code source de l&#39;application",id:"code-source-de-lapplication",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"angular-16--mettre-en-place-lauthentification-et-lautorisation-bas\xe9e-sur-les-r\xf4les",children:"Angular 16 : Mettre en place l'authentification et l'autorisation bas\xe9e sur les r\xf4les"}),"\n",(0,s.jsxs)(n.p,{children:["L'authentification et l'autorisation sont des \xe9l\xe9ments essentiels de toute application web moderne. Dans ",(0,s.jsx)(n.a,{href:"https://www.linkedin.com/pulse/spring-security-authentification-autorisation-avec-jwt-frifita",children:"l'article"})," pr\xe9c\xe9dent, nous avons explor\xe9 comment impl\xe9menter un syst\xe8me d'authentification robuste en utilisant JWT (JSON Web Tokens) avec Spring Boot et Spring Security. Nous avons ainsi cr\xe9\xe9 une API REST s\xe9curis\xe9e. Le code source est disponible sur Github."]}),"\n",(0,s.jsx)(n.p,{children:"Dans ce nouvel article, nous allons aller plus loin en montrant comment mettre en pratique cette authentification et autorisation bas\xe9e sur les r\xf4les du c\xf4t\xe9 client en utilisant Angular, l'un des frameworks JavaScript les plus populaires. En outre, nous allons introduire une am\xe9lioration cruciale : l'envoi du jeton JWT sous forme de cookie HTTP Only."}),"\n",(0,s.jsx)(n.h2,{id:"quel-est-le-meilleur-endroit-pour-stocker-les-tokens-c\xf4t\xe9-client-",children:"Quel est le meilleur endroit pour stocker les tokens C\xf4t\xe9 Client ?"}),"\n",(0,s.jsx)(n.p,{children:"Apr\xe8s une authentification r\xe9ussie de l'utilisateur, notre API Spring Boot renvoie une r\xe9ponse HTTP au format JSON."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n    "id": 1,\r\n    "email": "user@gmail.com",\r\n    "roles": [\r\n        "READ_PRIVILEGE",\r\n        "WRITE_PRIVILEGE",\r\n        "ROLE_USER"\r\n    ],\r\n    "access_token": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyQGdtYWlsLmNvbSIsImlhdCI6MTY5NzExMjg0OSwiZXhwIjoxNjk3MTEzNzQ5fQ.B0yFwrgLoDsVOmfN6Gyr5zLlDq4Wnjha0jchwkqySjE",\r\n    "refresh_token": "NDBmMTUzM2UtODJlYi00NzQxLWIzN2ItODFhNWE0MzllMGM2",\r\n    "token_type": "BEARER"\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Le client a la responsabilit\xe9 de stocker les informations de l'utilisateur, notamment l'",(0,s.jsx)(n.code,{children:"access_token"})," et le ",(0,s.jsx)(n.code,{children:"refresh_token"}),", dans un endroit s\xe9curis\xe9."]}),"\n",(0,s.jsx)(n.p,{children:"Il est courant que les d\xe9veloppeurs choisissent de sauvegarder ces jetons soit dans le stockage local (localStorage) soit dans des cookies, de mani\xe8re \xe0 les transmettre au backend pour authentifier l'utilisateur lors de futures requ\xeates."}),"\n",(0,s.jsx)(n.p,{children:"Cependant, il est essentiel de prendre en compte les vuln\xe9rabilit\xe9s potentielles associ\xe9es \xe0 ces choix :"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Le localStorage est vuln\xe9rable aux attaques XSS"})}),"\n",(0,s.jsx)(n.p,{children:"En cas d'injection de code malveillant dans votre application, un attaquant pourrait potentiellement acc\xe9der aux donn\xe9es stock\xe9es dans le localStorage, y compris les tokens."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Comment cela est-il possible ?"})}),"\n",(0,s.jsx)(n.p,{children:"Sans entrer dans les d\xe9tails des m\xe9thodes sp\xe9cifiques d'injection de code malveillant, il est important de comprendre que les attaques XSS (Cross-Site Scripting) surviennent lorsque des acteurs malveillants r\xe9ussissent \xe0 introduire du code JavaScript nuisible dans une application web. Un exemple concret de cette vuln\xe9rabilit\xe9 r\xe9side dans l'utilisation fr\xe9quente de biblioth\xe8ques JavaScript tierces pour des fonctionnalit\xe9s courantes, telles que l'affichage d'alertes. Par exemple :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<script src="https://cdn-malveillant.com/monalerte.js"><\/script>\n'})}),"\n",(0,s.jsx)(n.p,{children:"Ces biblioth\xe8ques sont souvent import\xe9es en ligne, et si elles sont compromises par des pirates, leur code source peut \xeatre modifi\xe9. En cons\xe9quence, votre application devient vuln\xe9rable, car les attaquants peuvent lire et extraire les informations sensibles stock\xe9es dans le localStorage. La s\xe9curit\xe9 de vos utilisateurs est ainsi s\xe9rieusement compromise."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Les cookies traditionnels sont vuln\xe9rables \xe0 la fois aux attaques XSS (Cross-Site Scripting) et aux attaques CSRF (Cross-Site Request Forgery)"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Comment cela est possible ?"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Attaques XSS :"})," Les cookies sont accessibles par JavaScript."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Attaques CSRF :"})," Les cookies, y compris les cookies de session, sont g\xe9n\xe9ralement inclus automatiquement dans chaque requ\xeate HTTP. L'attaque se produit lorsque des demandes effectu\xe9es par l'interm\xe9diaire d'un site malveillant forcent des utilisateurs authentifi\xe9s sur d'autres sites Web \xe0 soumettre une demande au site malveillant, obtenant ainsi l'acc\xe8s \xe0 leurs informations d'identification."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Quelle est la solution ?"})}),"\n",(0,s.jsx)(n.p,{children:"Il faut savoir que les mesures de s\xe9curit\xe9 change d'une application \xe0 l'autre et qu'il n'existe pas la bonne et la mauvaise approche mais vraiment ca d\xe9pend des exigences de s\xe9curit\xe9 de votre application. Selon mon exp\xe9rience je ne vous conseille pas de stocker les informations sensibles de vos utilisateurs dans le localStorage mais plut\xf4t dans des cookies HTTP only  !"}),"\n",(0,s.jsx)(n.h2,{id:"lavantage-du-cookie-http-only-avec-securetrue-et-samesitestrict",children:"L'Avantage du Cookie HTTP Only avec Secure=true et SameSite=Strict"}),"\n",(0,s.jsxs)(n.p,{children:["Maintenant que nous comprenons les vuln\xe9rabilit\xe9s associ\xe9es au stockage de tokens dans le localStorage ou dans des cookies traditionnels, il est temps d'explorer pourquoi le choix des cookies HTTP Only avec les param\xe8tres ",(0,s.jsx)(n.code,{children:"Secure=true"})," et ",(0,s.jsx)(n.code,{children:"SameSite=Strict"})," est une approche plus s\xe9curis\xe9e pour stocker nos ",(0,s.jsx)(n.code,{children:"access_token"})," et ",(0,s.jsx)(n.code,{children:"refresh_token"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Les cookies HTTP Only ne sont pas accessibles via JavaScript c\xf4t\xe9 client."}),"\n",(0,s.jsxs)(n.p,{children:["En d\xe9finissant ",(0,s.jsx)(n.code,{children:"Secure=true"}),", les cookies ne seront transmis que via HTTPS."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"SameSite"})," propose 3 politiques diff\xe9rentes, qui seront d\xe9finies par les valeurs suivantes (sensibles \xe0 la casse) : ",(0,s.jsx)(n.code,{children:"None"}),", ",(0,s.jsx)(n.code,{children:"Strict"})," et ",(0,s.jsx)(n.code,{children:"Lax"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Dans notre cas, avec ",(0,s.jsx)(n.code,{children:"access_token"})," et ",(0,s.jsx)(n.code,{children:"refresh_token"}),", nous opterons pour l'attribut ",(0,s.jsx)(n.code,{children:"SameSite=Strict"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["L'attribut ",(0,s.jsx)(n.code,{children:"SameSite=Strict"})," limite le risque d'attaques CSRF : les cookies ne seront pas inclus dans la requ\xeate vers un site tiers."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Exemple :"}),' Un utilisateur est sur "monsite.com" et clique sur un lien redirigeant vers "exemple.com". Si les cookies sont d\xe9finis comme ',(0,s.jsx)(n.code,{children:'SameSite="Strict"'}),', les cookies ne seront pas inclus dans la requ\xeate vers "exemple.com", assurant ainsi une protection maximale contre les attaques CSRF et limitant les risques d\'attaque XSS.']}),"\n",(0,s.jsxs)(n.p,{children:["Cependant, cela peut entra\xeener des limitations dans certaines situations, car certains sc\xe9narios, tels que le partage de liens vers des ressources, peuvent ne pas fonctionner comme pr\xe9vu. je vous laisse explorer les autres options sur ce ",(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/fr/docs/Web/HTTP/Headers/Set-Cookie",children:"lien"})," pour trouver la configuration qui convient le mieux \xe0 vos besoins sp\xe9cifiques."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Remarques :"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Il est important d'adapter les mesures de s\xe9curit\xe9 en fonction des besoins sp\xe9cifiques de votre application et des exigences en mati\xe8re de s\xe9curit\xe9."}),"\n",(0,s.jsx)(n.li,{children:"Ces options ne doivent pas constituer votre unique d\xe9fense contre les attaques."}),"\n",(0,s.jsx)(n.li,{children:"Ne stockez pas les tokens dans le localStorage \xe0 moins que vous puissiez garantir une s\xe9curit\xe9 maximale contre les attaques XSS !"}),"\n",(0,s.jsx)(n.li,{children:"Gardez \xe0 l'esprit que les cookies sont limit\xe9s \xe0 4 ko, donc assurez-vous que votre JWT n'exc\xe8de pas cette taille si vous voulez utiliser des cookies HTTP only pour g\xe9rer l'authentification."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"modification-de-lapi-spring-boot-pour-int\xe9grer-la-gestion-de-cookies-en-session-http-only",children:(0,s.jsx)(n.strong,{children:"Modification de l'API Spring Boot pour Int\xe9grer la Gestion de Cookies en Session HTTP Only"})}),"\n",(0,s.jsxs)(n.p,{children:["Dans cette section, nous allons apporter des modifications dans l'API REST que nous avons d\xe9velopp\xe9e dans ",(0,s.jsx)(n.a,{href:"https://www.linkedin.com/pulse/spring-security-authentification-autorisation-avec-jwt-frifita",children:"l'article"})," pr\xe9c\xe9dent pour int\xe9grer la gestion des tokens  ",(0,s.jsx)(n.code,{children:"access_token"})," et  ",(0,s.jsx)(n.code,{children:"refresh_token"})," en utilisant des cookies HTTP Only."]}),"\n",(0,s.jsx)(n.p,{children:"Vous pouvez passer directement \xe0 la section d\xe9di\xe9e \xe0 Angular si vous le souhaitez. Le code source complet de l'API est disponible sur GitHub."}),"\n",(0,s.jsx)(n.h3,{id:"modification-du-jwtservice-et-du-refreshtokenservice",children:"Modification du JwtService et du refreshTokenService"}),"\n",(0,s.jsx)(n.p,{children:"Nous allons ajouter les trois m\xe9thodes suivantes :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"package fr.mossaab.security.service;   \r\n\t...\r\n   ResponseCookie generateJwtCookie(String jwt);\r\n   String getJwtFromCookies(HttpServletRequest request);\r\n   ResponseCookie getCleanJwtCookie();\n"})}),"\n",(0,s.jsx)(n.h4,{id:"g\xe9n\xe9ration-dun-cookie-jwt-s\xe9curis\xe9",children:(0,s.jsx)(n.strong,{children:"G\xe9n\xe9ration d'un Cookie JWT S\xe9curis\xe9"})}),"\n",(0,s.jsxs)(n.p,{children:["La m\xe9thode ",(0,s.jsx)(n.code,{children:"generateJwtCookie"})," permet d'encapsuler le jwt dans un cookie HTTP only :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'public ResponseCookie generateJwtCookie(String jwt) {\r\n    return ResponseCookie.from(jwtCookieName, jwt)\r\n            .path("/")\r\n            .maxAge(24 * 60 * 60) // 24 hours in s\r\n            .httpOnly(true) \r\n            .secure(true)\r\n            .sameSite("Strict") \r\n            .build();\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Explorons les d\xe9tails de cette m\xe9thode"})}),"\n",(0,s.jsxs)(n.p,{children:["Cette m\xe9thode est responsable de la g\xe9n\xe9ration d'un cookie s\xe9curis\xe9 pour stocker le jeton JWT c\xf4t\xe9 client qui sera envoy\xe9 dans le Header de la r\xe9ponse HTTP, elle cr\xe9e un objet de type ",(0,s.jsx)(n.code,{children:"org.springframework.http.ResponseCookie"})," avec la configuration suivante :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"path"}),' : Sp\xe9cifie le chemin pour lequel le cookie est valide.  En d\xe9finissant le path sur "/", le cookie est accessible depuis n\'importe quelle URL de notre application']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"maxAge"})," : Dur\xe9e de validit\xe9 du cookie en secondes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"httpOnly"})," : Marquer le cookie comme http-only"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"secure"})," : Le cookie est envoy\xe9 uniquement via HTTPS"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"sameSite"})," : Sp\xe9cifie la politique SameSite"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"r\xe9cup\xe9ration-du-jwt-\xe0-partir-des-cookies",children:(0,s.jsx)(n.strong,{children:"R\xe9cup\xe9ration du JWT \xe0 partir des Cookies"})}),"\n",(0,s.jsxs)(n.p,{children:["La m\xe9thode ",(0,s.jsx)(n.code,{children:"getJwtFromCookies"})," permet d'extraire le JWT inclut dans la requ\xeate HTTP :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"public String getJwtFromCookies(HttpServletRequest request) {\r\n    Cookie cookie = WebUtils.getCookie(request, jwtCookieName);\r\n    if (cookie != null) {\r\n        return cookie.getValue();\r\n    } else {\r\n        return null;\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"suppression-du-cookie-jwt",children:(0,s.jsx)(n.strong,{children:"Suppression du Cookie JWT"})}),"\n",(0,s.jsx)(n.p,{children:"Pour d\xe9connecter l'utilisateur, il suffit de renvoyer au client le cookie jwt vide."}),"\n",(0,s.jsxs)(n.p,{children:["La m\xe9thode ",(0,s.jsx)(n.code,{children:"getCleanJwtCookie"})," permet de le cr\xe9er tout simplement :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Override\r\npublic ResponseCookie getCleanJwtCookie() {\r\n    return ResponseCookie.from(jwtCookieName, "")\r\n            .path("/")\r\n            .build();\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["En suivant le m\xeame principe que pour le ",(0,s.jsx)(n.code,{children:"JwtService"}),", le ",(0,s.jsx)(n.code,{children:"RefreshTokenService"})," doit \xe9galement \xeatre modifi\xe9 pour int\xe9grer les m\xeames m\xe9thodes :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'package fr.mossaab.security.service.impl;\r\n\t...\r\n   @Override\r\n    public ResponseCookie generateRefreshTokenCookie(String token) {\r\n        return ResponseCookie.from(refreshTokenName, token)\r\n                .path("/")\r\n                .maxAge(refreshExpiration/1000) // 15 days in s\r\n                .httpOnly(true)\r\n            \t.secure(true)\r\n                .sameSite("Strict")\r\n                .build();\r\n    }\r\n    @Override\r\n    public String getRefreshTokenFromCookies(HttpServletRequest request) {\r\n        Cookie cookie = WebUtils.getCookie(request, refreshTokenName);\r\n        if (cookie != null) {\r\n            return cookie.getValue();\r\n        } else {\r\n            return "";\r\n        }\r\n    }\r\n    @Override\r\n    public void deleteByToken(String token) {\r\n        refreshTokenRepository.findByToken(token).ifPresent(refreshTokenRepository::delete);\r\n    }\r\n\r\n    @Override\r\n    public ResponseCookie getCleanRefreshTokenCookie() {\r\n        return ResponseCookie.from(refreshTokenName, "")\r\n                .path("/")\r\n                .build();\r\n    }\n'})}),"\n",(0,s.jsx)(n.h3,{id:"int\xe9gration-de-la-r\xe9cup\xe9ration-du-cookie-jwt-dans-le-filtre-jwtauthenticationfilter",children:"Int\xe9gration de la r\xe9cup\xe9ration du Cookie JWT dans le Filtre JwtAuthenticationFilter"}),"\n",(0,s.jsxs)(n.p,{children:["Le filtre ",(0,s.jsx)(n.code,{children:"JwtAuthenticationFilter"}),' permet d\'extraire le JWT du header "Authorization". Dans cette section, nous allons enrichir ce filtre en lui permettant de r\xe9cup\xe9rer \xe9galement le JWT depuis les cookies.']}),"\n",(0,s.jsx)(n.p,{children:"Voici ce qu'il faut modifier :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'    ...\r\n       \r\n    @Override\r\n    protected void doFilterInternal(\r\n           @NonNull HttpServletRequest request,\r\n           @NonNull HttpServletResponse response,\r\n           @NonNull FilterChain filterChain\r\n    ) throws ServletException, IOException {\r\n\r\n        // try to get JWT in cookie or in Authorization Header\r\n        String jwt = jwtService.getJwtFromCookies(request);\r\n        final String authHeader = request.getHeader("Authorization");\r\n\r\n        if((jwt == null &&\r\n            (authHeader ==  null || !authHeader.startsWith("Bearer "))) || request.getRequestURI().contains("/auth")){\r\n            filterChain.doFilter(request, response);\r\n            return;\r\n        }\r\n\r\n        // If the JWT is not in the cookies but in the "Authorization" header\r\n        if (jwt == null && authHeader.startsWith("Bearer ")) {\r\n            jwt = authHeader.substring(7); // after "Bearer "\r\n        }\r\n        final String userEmail =jwtService.extractUserName(jwt);\r\n        \r\n        ...\r\n            \r\n    }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Lorsque le filtre intercepte la requ\xeate, il essaie de r\xe9cup\xe9rer le JWT, soit en utilisant la m\xe9thode que nous avons ajout\xe9e au service JwtService avec l'appel ",(0,s.jsx)(n.code,{children:"getJwtFromCookies(request)"}),' pour obtenir le JWT \xe0 partir des cookies, soit du Header "Authorization", comme nous l\'avons pr\xe9c\xe9demment fait.']}),"\n",(0,s.jsx)(n.h3,{id:"modification-du-contr\xf4leur-authenticationcontroller",children:"Modification du contr\xf4leur AuthenticationController"}),"\n",(0,s.jsxs)(n.p,{children:["Apr\xe8s une authentification r\xe9ussie de l'utilisateur, notre API renvoie une r\xe9ponse JSON qui contient les tokens ",(0,s.jsx)(n.code,{children:"access_token"})," et ",(0,s.jsx)(n.code,{children:"refresh_token"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Cependant, ce qui nous manque ici, c'est la possibilit\xe9 d'envoyer les tokens sous forme de cookies"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'    @PostMapping("/authenticate")\r\n    public ResponseEntity<AuthenticationResponse> authenticate(@RequestBody AuthenticationRequest request) {\r\n        AuthenticationResponse authenticationResponse = authenticationService.authenticate(request);\r\n       \r\n        ResponseCookie jwtCookie = jwtService\r\n            .generateJwtCookie(authenticationResponse.getAccessToken());\r\n        ResponseCookie refreshTokenCookie = refreshTokenService\r\n            .generateRefreshTokenCookie(authenticationResponse.getRefreshToken());\r\n        \r\n        return ResponseEntity.ok()\r\n                .header(HttpHeaders.SET_COOKIE,jwtCookie.toString())\r\n                .header(HttpHeaders.SET_COOKIE,refreshTokenCookie.toString())\r\n                .body(authenticationResponse);\r\n    }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Les cookies ",(0,s.jsx)(n.code,{children:"JwtCookie"})," et ",(0,s.jsx)(n.code,{children:"refreshTokenCookie"})," sont g\xe9n\xe9r\xe9s \xe0 partir de la r\xe9ponse ",(0,s.jsx)(n.code,{children:"authenticationResponse"})," et inclus dans la r\xe9ponse HTTP."]}),"\n",(0,s.jsxs)(n.p,{children:["Maintenant il faut avoir la possibilit\xe9 de rafraichir le ",(0,s.jsx)(n.code,{children:"access_token"})," quand il expire."]}),"\n",(0,s.jsxs)(n.p,{children:["Pour maintenir ce que nous avons fait dans ",(0,s.jsx)(n.a,{href:"https://www.linkedin.com/pulse/spring-security-authentification-autorisation-avec-jwt-frifita",children:"l'article"})," pr\xe9c\xe9dent, j'ai ajout\xe9 un nouveau end-point : ",(0,s.jsx)(n.code,{children:"/refresh-token-cookie"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'    @PostMapping("/refresh-token-cookie")\r\n    public ResponseEntity<Void> refreshTokenCookie(HttpServletRequest request) {\r\n        String refreshToken = refreshTokenService.getRefreshTokenFromCookies(request);\r\n        \r\n        RefreshTokenResponse refreshTokenResponse = refreshTokenService\r\n                .generateNewToken(new RefreshTokenRequest(refreshToken));\r\n        \r\n        ResponseCookie NewJwtCookie = jwtService.generateJwtCookie(refreshTokenResponse.getAccessToken());\r\n        return ResponseEntity.ok()\r\n                .header(HttpHeaders.SET_COOKIE, NewJwtCookie.toString())\r\n                .build();\r\n    }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Lorsque le client envoie une requ\xeate \xe0 cet endpoint, notre m\xe9thode tente de r\xe9cup\xe9rer le ",(0,s.jsx)(n.code,{children:"refresh_token"})," \xe0 partir des cookies de la requ\xeate. Ensuite, elle g\xe9n\xe8re un nouveau cookie ",(0,s.jsx)(n.code,{children:"NewJwtCookie"})," contenant le nouveau jeton d'acc\xe8s \xe0 partir du ",(0,s.jsx)(n.code,{children:"refresh_token"}),". Enfin, la m\xe9thode renvoie une r\xe9ponse HTTP 200 (OK) au client, avec le nouveau cookie inclus dans l'en-t\xeate de la r\xe9ponse."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Remarque : la m\xe9thode ",(0,s.jsx)(n.code,{children:"generateNewToken"})," peut g\xe9n\xe9rer des exceptions si le ",(0,s.jsx)(n.code,{children:"refresh_token"})," n'est pas valide (comme expliqu\xe9 dans l'article pr\xe9c\xe9dent). Dans un tel cas, elle renvoie une r\xe9ponse HTTP 403 (forbidden)"]})}),"\n",(0,s.jsx)(n.h2,{id:"impl\xe9mentation-de-lauthentification-et-de-lautorisation-dans-angular-16",children:"Impl\xe9mentation de l'Authentification et de l'Autorisation dans Angular 16"}),"\n",(0,s.jsx)(n.p,{children:"L'application Angular que nous allons construire est un exemple minimal mais complet. Notre objectif est de mettre en place un syst\xe8me d'authentification bas\xe9 sur les JWT et les cookies HTTP-Only, tout en abordant l'autorisation bas\xe9e sur les r\xf4les."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Les end-points que nous allons utiliser sont :"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["POST ",(0,s.jsx)(n.code,{children:"api/v1/auth/authenticate"})," pour authentifier les utilisateurs"]}),"\n",(0,s.jsxs)(n.li,{children:["POST ",(0,s.jsx)(n.code,{children:"api/v1/auth/logout"})," pour d\xe9connecter les utilisateurs"]}),"\n",(0,s.jsxs)(n.li,{children:["POST ",(0,s.jsx)(n.code,{children:"api/v1/auth/refresh-token-cookie"})," pour rafraichir le JWT"]}),"\n",(0,s.jsxs)(n.li,{children:["POST ",(0,s.jsx)(n.code,{children:"api/v1/user/resource"})," qui renvoie un message avec  un code HTTP 200 si l'utilisateur est authentifi\xe9, poss\xe8de le r\xf4le USER ou ADMIN avec le droit d'\xe9criture (",(0,s.jsx)(n.code,{children:"WRITE_PRIVILEGE"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["GET ",(0,s.jsx)(n.code,{children:"api/v1/admin/resource"})," elle renvoie un message avec HTTP 200 si l'utilisateur est authentifi\xe9, poss\xe8de le r\xf4le ADMIN avec le droit de lecture (",(0,s.jsx)(n.code,{children:"READ_PRIVILEGE"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Les fonctionnalit\xe9s \xe0 d\xe9velopper sont :"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cr\xe9ation d'une page login"}),"\n",(0,s.jsx)(n.li,{children:"Cr\xe9ation d'une page Home accessible aux utilisateurs avec le r\xf4le ADMIN ou USER"}),"\n",(0,s.jsx)(n.li,{children:"Cr\xe9ation d'une page Admin accessible uniquement aux utilisateurs avec le r\xf4le ADMIN"}),"\n",(0,s.jsx)(n.li,{children:"Auto-Login permet aux utilisateurs authentifi\xe9s de rester connect\xe9s sans avoir \xe0 saisir \xe0 chaque fois leurs informations d'identification"}),"\n",(0,s.jsx)(n.li,{children:"Auto-Logout permet la d\xe9connexion automatique pour am\xe9liorer la s\xe9curit\xe9 de la session utilisateur"}),"\n",(0,s.jsx)(n.li,{children:"Cr\xe9ation d'une barre de navigation dynamique qui s'affiche en fonction des r\xf4les des utilisateurs. La barre de navigation offrira des liens sp\xe9cifiques en fonction du r\xf4le de l'utilisateur"}),"\n",(0,s.jsx)(n.li,{children:"Rafra\xeechissement Automatique du JWT : Cette fonctionnalit\xe9 garantira que les utilisateurs restent connect\xe9s de mani\xe8re transparente en actualisant automatiquement leur JWT."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-du-projet-angular",children:"Cr\xe9ation du projet Angular"}),"\n",(0,s.jsx)(n.h4,{id:"pr\xe9requis-",children:"Pr\xe9requis :"}),"\n",(0,s.jsxs)(n.p,{children:["Node.js et npm : Assurez-vous que Node.js est install\xe9 sur votre syst\xe8me, car il est n\xe9cessaire pour ex\xe9cuter Angular CLI. Vous pouvez t\xe9l\xe9charger Node.js \xe0 partir du site officiel : ",(0,s.jsx)(n.a,{href:"https://nodejs.org/",children:"https://nodejs.org/"}),"."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Angular CLI : ",(0,s.jsx)(n.code,{children:"npm install -g @angular/cli"})]}),"\n",(0,s.jsxs)(n.li,{children:["Cr\xe9ation d'un nouveau projet Angular : ",(0,s.jsx)(n.code,{children:"ng new [nom_projet]"})]}),"\n",(0,s.jsxs)(n.li,{children:["Installation de Bootstrap : ",(0,s.jsx)(n.code,{children:"npm install bootstrap --save"})]}),"\n",(0,s.jsxs)(n.li,{children:["Int\xe9gration de Bootstrap dans le projet Angular en modifiant le fichier ",(0,s.jsx)(n.code,{children:"angular.json"})," :"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"styles": [\r\n  "src/styles.scss",\r\n  "node_modules/bootstrap/dist/css/bootstrap.min.css"\r\n],\r\n"scripts":[\r\n"node_modules/bootstrap/dist/js/bootstrap.bundle.js"\r\n]\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:[(0,s.jsx)(n.strong,{children:"Remarque :"})," Les \xe9tapes de configuration de Bootstrap dans ce tutoriel sont fournies \xe0 titre indicatif. Vous \xeates libre de choisir d'autres frameworks ou biblioth\xe8ques CSS, ou de personnaliser davantage la configuration en fonction de vos pr\xe9f\xe9rences et des exigences de votre projet. Le but est de vous montrer le processus de configuration de base, et vous pouvez l'adapter en cons\xe9quence."]})}),"\n",(0,s.jsx)(n.p,{children:"G\xe9n\xe9rez les composants et les services suivants :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"ng g s _services/auth\r\nng g s _services/storage\r\nng g s _services/user\r\n\r\nng g interceptor _helpers/http\r\nng g g _helpers/auth\r\n\r\nng g i _models/user.model\r\nng g i _models/role.model\r\n\r\nng g c login\r\nng g c header\r\nng g c admin\r\nng g c home\r\nng g c errors/access-denied\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Ajoutez le ",(0,s.jsx)(n.code,{children:"router-outlet"})," dans le composant principale de l'application ",(0,s.jsx)(n.code,{children:"app.component.html"})," qui servira de conteneur pour afficher le contenu des composants associ\xe9s aux diff\xe9rentes routes lorsque la navigation se produit"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"<router-outlet></router-outlet>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Voici la structure de notre application Angular :"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:r(4567).Z+"",width:"349",height:"887"})}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-des-mod\xe8les-user-et-role",children:"Cr\xe9ation des mod\xe8les User et Role"}),"\n",(0,s.jsxs)(n.p,{children:["Pour mieux structurer les donn\xe9es manipul\xe9es par notre application, cr\xe9ez les interfaces ",(0,s.jsx)(n.code,{children:"User"})," et ",(0,s.jsx)(n.code,{children:"Role"})," sous le r\xe9pertoire ",(0,s.jsx)(n.code,{children:"_models"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import {Role} from "./role.model";\r\n\r\nexport interface User {\r\n  id: number,\r\n  email: string,\r\n  role: Role\r\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export interface Role {\r\n  name: string,\r\n  permissions: string[]\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Comme vous pouvez le constater, un utilisateur poss\xe8de un r\xf4le, tandis qu'un r\xf4le se caract\xe9rise par un nom et un tableau de cha\xeenes repr\xe9sentant les autorisations."}),"\n",(0,s.jsxs)(n.p,{children:["Les ",(0,s.jsx)(n.code,{children:"access_token"})," et ",(0,s.jsx)(n.code,{children:"refresh_token"})," ne sont pas d\xe9finis dans les propri\xe9t\xe9s de l'utilisateur, car ils seront stock\xe9s dans les cookies HTTP-only. En revanche, les autres propri\xe9t\xe9s seront stock\xe9es dans le localStorage du navigateur puisque ils ne contiennent pas de donn\xe9es sensibles."]}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-du-service-storage",children:"Cr\xe9ation du service Storage"}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez le service ",(0,s.jsx)(n.code,{children:"StorageService"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ng g s _services/storage\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"StorageService"}),"  g\xe8re le stockage, la r\xe9cup\xe9ration et la supression des informations de l'utilisateur authentifi\xe9 (",(0,s.jsx)(n.code,{children:"User"}),") dans le localStorage du navigateur. Cela permet de maintenir la persistance des donn\xe9es de l'utilisateur entre les sessions de navigation."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@angular/core';\r\nimport {User} from \"../_models/user.model\";\r\n\r\nconst USER_KEY = 'authenticated-user';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StorageService {\r\n  constructor() { }\r\n\r\n  saveUser(user : User){\r\n    window.localStorage.removeItem(USER_KEY);\r\n    window.localStorage.setItem(USER_KEY, JSON.stringify(user));\r\n  }\r\n  getSavedUser() : User | null {\r\n    const user = window.localStorage.getItem(USER_KEY);\r\n    if (user) {\r\n      return JSON.parse(user);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  clean(): void {\r\n    window.localStorage.clear();\r\n  }\r\n}\r\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Le ",(0,s.jsx)(n.code,{children:"localStorage"})," est facilement manipul\xe9 \xe0 l'aide des m\xe9thodes ",(0,s.jsx)(n.code,{children:"setItem"}),", ",(0,s.jsx)(n.code,{children:"getItem"})," et ",(0,s.jsx)(n.code,{children:"removeItem"}),", qui fonctionnent avec un couple cl\xe9-valeur."]}),"\n",(0,s.jsxs)(n.p,{children:["L'objet User est enregistr\xe9 au format JSON en utilisant ",(0,s.jsx)(n.code,{children:"JSON.stringify(user)"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"comprendre-le-m\xe9canisme-dauthentification-avec-des-cookies-http-only",children:"Comprendre le m\xe9canisme d'authentification avec des cookies HTTP-only"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231016173244505",src:r(2425).Z+"",width:"731",height:"311"})}),"\n",(0,s.jsxs)(n.p,{children:["Lorsque l'utilisateur s'authentifie, le service ",(0,s.jsx)(n.code,{children:"AuthService"})," prend en charge l'appel \xe0 notre API pour effectuer l'authentification. En cas de succ\xe8s, le serveur renvoie une r\xe9ponse avec le code HTTP 200 contenant les informations de l'utilisateur. Le r\xf4le du ",(0,s.jsx)(n.code,{children:"AuthService"})," est ensuite de d\xe9l\xe9guer la persistance de ces informations (ID, email, r\xf4les) au ",(0,s.jsx)(n.code,{children:"StorageService"}),", qui les stocke dans le ",(0,s.jsx)(n.code,{children:"localStorage"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Le serveur, quant \xe0 lui, transmet le ",(0,s.jsx)(n.code,{children:"access_token"})," et le ",(0,s.jsx)(n.code,{children:"refresh_token"})," via des cookies HTTP-only. Le client doit ainsi conserver ces cookies et les inclure dans les futures demandes adress\xe9es au serveur. Cette d\xe9marche garantit la continuit\xe9 de l'authentification de l'utilisateur lors de ses interactions ult\xe9rieures."]}),"\n",(0,s.jsx)(n.p,{children:"Ce qu'il est essentiel de retenir de tout cela :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Les informations (ID, email, r\xf4les) sont stock\xe9es dans le ",(0,s.jsx)(n.code,{children:"localStorage"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Les tokens (access_token, refresh_token) sont conserv\xe9s dans des cookies HTTP-only."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-du-service-authentification",children:"Cr\xe9ation du service Authentification"}),"\n",(0,s.jsxs)(n.p,{children:["L'objectif principal du service ",(0,s.jsx)(n.code,{children:"AuthService"})," est de g\xe9rer l'authentification de l'utilisateur et de fournir un moyen d'acc\xe9der aux informations de l'utilisateur authentifi\xe9 dans toute l'application."]}),"\n",(0,s.jsxs)(n.p,{children:["Pour atteindre cet objectif, nous utiliserons les observables de ",(0,s.jsx)(n.code,{children:"RxJS"}),", une biblioth\xe8que JavaScript populaire utilis\xe9e par Angular pour la programmation r\xe9active avec ses observables. Le principe de base d'un observable est assez simple :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Un Observable est un objet qui \xe9met des valeurs du m\xeame type au fil du temps."}),"\n",(0,s.jsx)(n.li,{children:"Il peut \xe9galement \xe9mettre une erreur \xe0 tout moment, apr\xe8s quoi il est consid\xe9r\xe9 comme termin\xe9 et ne produira plus de valeurs."}),"\n",(0,s.jsxs)(n.li,{children:["Nous observons un Observable et r\xe9agissons \xe0 ses \xe9missions en utilisant sa m\xe9thode ",(0,s.jsx)(n.code,{children:"subscribe()"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"C'est pr\xe9cis\xe9ment l'int\xe9r\xeat de cette approche ! Nous allons cr\xe9er un Observable qui sera utilis\xe9 pour stocker l'objet User et avertir les autres composants lorsque l'utilisateur se connecte et se d\xe9connecte de l'application."}),"\n",(0,s.jsxs)(n.p,{children:["En Angular, un service d\xe9cor\xe9 avec ",(0,s.jsx)(n.code,{children:"@Injectable({ providedIn: 'root' })"})," est un singleton, ce qui signifie qu'il sera cr\xe9\xe9 une seule fois pour toute l'application et sera disponible pour \xeatre inject\xe9 dans tous les composants. Cela nous permet de centraliser la gestion de l'\xe9tat de l'utilisateur dans le service d'authentification, assurant ainsi sa coh\xe9rence et sa mise \xe0 jour partout dans l'application."]}),"\n",(0,s.jsxs)(n.p,{children:["Pour extraire (ID, email, r\xf4les) de la r\xe9ponse cr\xe9er l'interface ",(0,s.jsx)(n.code,{children:"AuthResponseData"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export interface AuthResponseData {\r\n  id : number,\r\n  email : string,\r\n  roles : string[],\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Les autres attributs seront ignor\xe9s automatiquement."}),"\n",(0,s.jsxs)(n.p,{children:["Injectez le ",(0,s.jsx)(n.code,{children:"HttpClient"})," et le ",(0,s.jsx)(n.code,{children:"StorageService"})," dans le constructeur du service. Le service ",(0,s.jsx)(n.code,{children:"AuthService"})," d\xe9pend du ",(0,s.jsx)(n.code,{children:"HttpClient"})," pour effectuer des requ\xeates HTTP vers l'API d'authentification."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"constructor(\r\n  private http: HttpClient,\r\n  private storageService: StorageService\r\n) { }\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Assurez-vous d'importer le module ",(0,s.jsx)(n.code,{children:"HttpClientModule"})," dans votre application. Vous pouvez le faire dans le fichier ",(0,s.jsx)(n.code,{children:"app.module.ts"})," de votre application."]})}),"\n",(0,s.jsxs)(n.p,{children:["Comme nous l'avons d\xe9j\xe0 expliqu\xe9, le ",(0,s.jsx)(n.code,{children:"AuthService"})," doit stocker l'utilisateur actuellement authentifi\xe9 dans un Observable, et dans ce cas, nous choisissons d'utiliser un ",(0,s.jsx)(n.code,{children:"BehaviorSubject"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Le ",(0,s.jsx)(n.code,{children:"BehaviorSubject"})," est un type d'Observable qui conserve la derni\xe8re valeur \xe9mise, ce qui en fait une excellente option pour stocker l'\xe9tat de l'utilisateur connect\xe9. De plus, il peut \xeatre initialis\xe9 avec une valeur par d\xe9faut, comme ",(0,s.jsx)(n.code,{children:"null"}),", garantissant ainsi qu'une valeur initiale est toujours disponible, m\xeame avant l'authentification de l'utilisateur."]}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez l'objet ",(0,s.jsx)(n.code,{children:"BehaviorSubject"})," ",(0,s.jsx)(n.code,{children:"AuthenticatedUser$"})," et initialisez-le \xe0 ",(0,s.jsx)(n.code,{children:"null"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"AuthenticatedUser$  = new BehaviorSubject<User | null>(null);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"AuthenticatedUser$"})," commence avec une valeur nulle, ce qui signifie qu'au d\xe9part, aucun utilisateur n'est authentifi\xe9."]}),"\n",(0,s.jsxs)(n.p,{children:["Ensuite, il est n\xe9cessaire de cr\xe9er une m\xe9thode ",(0,s.jsx)(n.code,{children:"login"})," qui est au c\u0153ur du processus d'authentification :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@angular/core';\r\nimport {HttpClient} from \"@angular/common/http\";\r\nimport {BehaviorSubject, catchError, tap, throwError} from \"rxjs\";\r\nimport {User} from \"../_models/user.model\";\r\nimport {StorageService} from \"./storage.service\";\r\n\r\n\r\nexport interface AuthResponseData {\r\n  id : number,\r\n  email : string,\r\n  roles : string[],\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n\r\n  AuthenticatedUser$  = new BehaviorSubject<User | null>(null);\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private storageService: StorageService\r\n  ) { }\r\n\r\n  login(email : string, password: string) {\r\n    return this.http.request<AuthResponseData>('post','http://localhost:8086/api/v1/auth/authenticate',\r\n      {\r\n        body : {email, password},\r\n        withCredentials : true\r\n      }).pipe(\r\n        catchError(err => {\r\n          let errorMessage = 'An unknown error occurred!';\r\n          if(err.error.message === 'Bad credentials') {\r\n            errorMessage = 'The email address or password you entered is invalid'\r\n          }\r\n            return throwError(() =>  new Error(errorMessage))\r\n        }),\r\n        tap(\r\n          user => {\r\n            const extractedUser : User = {\r\n              email: user.email,\r\n              id: user.id,\r\n              role : {\r\n                name : user.roles.find(role => role.includes('ROLE')) || '',\r\n                permissions : user.roles.filter(permission => !permission.includes('ROLE'))\r\n              }\r\n            }\r\n            this.storageService.saveUser(extractedUser);\r\n            this.AuthenticatedUser$.next(extractedUser);\r\n          }\r\n        )\r\n    );\r\n  }\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["la m\xe9thode login utilise la m\xe9thode ",(0,s.jsx)(n.code,{children:"http.request"})," du service ",(0,s.jsx)(n.code,{children:"HttpClient"})," d'Angular pour envoyer une requete HTTP post au serveur. Elle renvoie un Observable de type ",(0,s.jsx)(n.code,{children:"HttpResponse"})," ce qui nous permet d'utiliser les op\xe9rateurs RxJS tels que ",(0,s.jsx)(n.code,{children:"pipe"}),", ",(0,s.jsx)(n.code,{children:"map"}),", ",(0,s.jsx)(n.code,{children:"catchError"}),", et ",(0,s.jsx)(n.code,{children:"tap"})," pour effectuer des op\xe9rations sur l'Observable renvoy\xe9 par ",(0,s.jsx)(n.code,{children:"http.request"})," et traiter la r\xe9ponse de la requ\xeate HTTP."]}),"\n",(0,s.jsxs)(n.p,{children:["Les informations d'identification de l'utilisateur (email et password) sont transmises dans le ",(0,s.jsx)(n.code,{children:"body"})," de la requ\xeate HTTP."]}),"\n",(0,s.jsxs)(n.p,{children:["L'option ",(0,s.jsx)(n.code,{children:"withCredentials: true"})," est d\xe9finie pour permettre le partage de cookies avec le serveur. En raison des politiques de s\xe9curit\xe9 relatives aux cookies dans les navigateurs, ils ne sont pas automatiquement inclus lorsque les domaines (et les ports) sont diff\xe9rents. En sp\xe9cifiant cette option, vous autorisez explicitement le partage de cookies entre l'application Angular et l'API."]}),"\n",(0,s.jsxs)(n.p,{children:["La m\xe9thode ",(0,s.jsx)(n.code,{children:"pipe"})," est utilis\xe9e pour cha\xeener des op\xe9rations sur l'Observable."]}),"\n",(0,s.jsxs)(n.p,{children:["L'op\xe9rateur ",(0,s.jsx)(n.code,{children:"catchError"})," est utilis\xe9 pour intercepter et g\xe9rer les erreurs renvoy\xe9es par l'API. Il est fortement recommand\xe9 de g\xe9rer les erreurs au niveau des services, car cela repr\xe9sente une bonne pratique de d\xe9veloppement. Cette approche permet de centraliser la gestion des erreurs pour un service donn\xe9, assurant ainsi la coh\xe9rence de la gestion des erreurs dans toute l'application."]}),"\n",(0,s.jsxs)(n.p,{children:["Le type de l'erreur renvoy\xe9 est ",(0,s.jsx)(n.code,{children:"HttpErrorResponse"})," qui est un objet JSON, voici son contenu sur le console :"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231016221545010",src:r(9831).Z+"",width:"651",height:"336"})}),"\n",(0,s.jsx)(n.p,{children:"Nous pouvons donc acc\xe8der aux informations associ\xe9es pour mieux comprendre et g\xe9rer l'erreur."}),"\n",(0,s.jsxs)(n.p,{children:["Dans notre cas, nous utilisons une condition ",(0,s.jsx)(n.code,{children:"if (err.error.message === 'Bad credentials')"})," pour identifier le type d'erreur. L'objet \"error\" que vous voyez est un objet que nous avons cr\xe9\xe9 dans notre API pour \xeatre renvoy\xe9 en cas d'erreur."]}),"\n",(0,s.jsxs)(n.p,{children:["Pour obtenir plus de d\xe9tails sur les r\xe9ponses possibles de l'end-point ",(0,s.jsx)(n.code,{children:"/api/v1/auth/authenticate"}),", je vous encourage \xe0 consulter la documentation de l'API via l'URL ",(0,s.jsx)(n.code,{children:"/swagger-ui/index.html"}),". Cela vous permettra d'explorer les diff\xe9rentes r\xe9ponses possibles et de comprendre la structure des objets d'erreur renvoy\xe9s par l'API."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231016225628911",src:r(2255).Z+"",width:"534",height:"303"})}),"\n",(0,s.jsx)(n.p,{children:"C'est pourquoi chaque API peut renvoyer un objet d'erreur diff\xe9rent en fonction de sa logique m\xe9tier et de sa structure de donn\xe9es. Il est essentiel de consulter la documentation de l'API pour comprendre le type de r\xe9ponse d'erreur attendu."}),"\n",(0,s.jsxs)(n.p,{children:["Si tout se passe bien, la m\xe9thode ",(0,s.jsx)(n.code,{children:"pipe"})," continue avec l'op\xe9ration ",(0,s.jsx)(n.code,{children:"tap"}),". Cette op\xe9ration est utilis\xe9e pour effectuer des actions sur les donn\xe9es de la r\xe9ponse HTTP."]}),"\n",(0,s.jsxs)(n.p,{children:["Dans notre cas, elle extrait les informations de l'utilisateur depuis la r\xe9ponse de la requ\xeate, les donn\xe9es que nous attendons sont de type ",(0,s.jsx)(n.code,{children:"AuthResponseData"}),"  ce qui facilite leur traitement et du coup la cr\xe9ation d'un objet User."]}),"\n",(0,s.jsxs)(n.p,{children:["Cet objet utilisateur est ensuite sauvegard\xe9 dans le localStorage pour assurer la persistance des donn\xe9es entre les sessions, et il est ensuite \xe9mis dans l'observable ",(0,s.jsx)(n.code,{children:"AuthenticatedUser$"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Nous explorerons ensuite la mani\xe8re de souscrire \xe0 cet observable pour rester au courant des modifications de l'\xe9tat de l'utilisateur connect\xe9, nous permettant ainsi d'adapter nos actions en cons\xe9quence."}),"\n",(0,s.jsx)(n.h3,{id:"module-de-routage-dapplication",children:"Module de routage d'application"}),"\n",(0,s.jsxs)(n.p,{children:["Le module de routage d'application (",(0,s.jsx)(n.code,{children:"AppRoutingModule"}),") est un \xe9l\xe9ment essentiel d'Angular qui permet de g\xe9rer la navigation et de d\xe9finir quel composant s'affiche lorsque diff\xe9rentes URL sont acc\xe9d\xe9es. Dans notre application, il est utilis\xe9 pour diriger les utilisateurs vers la page de connexion (",(0,s.jsx)(n.strong,{children:"login"}),"), la page d'accueil (",(0,s.jsx)(n.strong,{children:"home"}),"), la page d'administration (",(0,s.jsx)(n.strong,{children:"admin"}),"), ou encore la page d'acc\xe8s refus\xe9 (",(0,s.jsx)(n.strong,{children:"forbidden"}),"), en fonction de leur statut d'authentification et de leurs r\xf4les."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport {LoginComponent} from \"./login/login.component\";\r\nimport {HomeComponent} from \"./home/home.component\";\r\nimport {authGuard} from \"./_helpers/auth.guard\";\r\nimport {AccessDeniedComponent} from \"./errors/access-denied/access-denied.component\";\r\nimport {AdminComponent} from \"./admin/admin.component\";\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    redirectTo:'/home',\r\n    pathMatch: 'full'\r\n  },\r\n  {\r\n    path: 'login',\r\n    component:LoginComponent\r\n  },\r\n  {\r\n    path: 'home',\r\n    component: HomeComponent ,\r\n    canActivate: [authGuard],\r\n    data: {roles: ['ROLE_ADMIN','ROLE_USER']}\r\n  },\r\n  {\r\n    path: 'admin',\r\n    component: AdminComponent,\r\n    canActivate: [authGuard],\r\n    data: {roles: ['ROLE_ADMIN']}\r\n  },\r\n  {\r\n    path: 'forbidden',\r\n    component: AccessDeniedComponent\r\n  },\r\n  {\r\n    path: '**',\r\n    redirectTo: '/home'\r\n  }\r\n\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forRoot(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class AppRoutingModule { }\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Pour prot\xe9ger les routes, nous utilisons le syst\xe8me de ",(0,s.jsx)(n.code,{children:"guards"})," d'Angular avec l'utilisation de ",(0,s.jsx)(n.code,{children:"canActivate: [authGuard]"}),". L'",(0,s.jsx)(n.code,{children:"authGuard"})," est un guard que nous impl\xe9menterons dans la section suivante, et il permet d'autoriser l'acc\xe8s uniquement aux utilisateurs authentifi\xe9s ayant le r\xf4le requis par la route."]}),"\n",(0,s.jsxs)(n.p,{children:["La propri\xe9t\xe9 ",(0,s.jsx)(n.code,{children:"data"})," est un objet qui contient une cl\xe9 ",(0,s.jsx)(n.code,{children:"roles"}),", laquelle a pour valeur un tableau de r\xf4les. Elle est utilis\xe9e pour sp\xe9cifier les r\xf4les requis afin d'acc\xe9der \xe0 une route particuli\xe8re."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"En r\xe9sum\xe9 :"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["La route ",(0,s.jsx)(n.code,{children:"home"})," est accessible uniquement aux utilisateurs authentifi\xe9s qui ont le r\xf4le ",(0,s.jsx)(n.code,{children:"ROLE_ADMIN"})," ou ",(0,s.jsx)(n.code,{children:"ROLE_USER"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Lorsqu'aucune URL n'est fournie (",(0,s.jsx)(n.code,{children:"path: ''"}),"), l'utilisateur est redirig\xe9 vers ",(0,s.jsx)(n.code,{children:"/home"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["La route ",(0,s.jsx)(n.code,{children:"admin"})," est accessible uniquement aux utilisateurs authentifi\xe9s qui ont le r\xf4le ",(0,s.jsx)(n.code,{children:"ROLE_ADMIN"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["La route ",(0,s.jsx)(n.code,{children:"login"})," est accessible \xe0 tout le monde."]}),"\n",(0,s.jsxs)(n.li,{children:["La route ",(0,s.jsx)(n.code,{children:"forbidden"})," permet d'afficher un composant qui affiche un message d'acc\xe8s non autoris\xe9 en cas d'erreur HTTP 403."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"garde-dauthentification",children:"Garde d'authentification"}),"\n",(0,s.jsxs)(n.p,{children:["Le guard ",(0,s.jsx)(n.code,{children:"authGuard"})," est un composant essentiel de notre application Angular qui joue un r\xf4le cl\xe9 dans la s\xe9curit\xe9 des routes. Il est utilis\xe9 pour restreindre l'acc\xe8s aux diff\xe9rentes parties de l'application en fonction de l'\xe9tat de l'utilisateur connect\xe9 et des r\xf4les associ\xe9s. Le code du ",(0,s.jsx)(n.code,{children:"authGuard"})," est le suivant :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import {CanActivateFn, Router} from '@angular/router';\r\nimport {inject} from \"@angular/core\";\r\nimport {AuthService} from \"../_services/auth.service\";\r\nimport {map, take} from \"rxjs\";\r\n\r\nexport const authGuard: CanActivateFn = (\r\n  route,\r\n  state\r\n) => {\r\n  const router = inject(Router);\r\n  const authService = inject(AuthService);\r\n\r\n  return authService.AuthenticatedUser$.pipe(\r\n    take(1), // take the first one and then unsubscribe automatically\r\n    map(user => {\r\n      // check if route is restricted by role\r\n      const { roles } = route.data;\r\n      if(user && user.role && roles.includes(user.role.name)) {\r\n       return true;\r\n      }\r\n      if(user) {\r\n       return  router.createUrlTree(['/forbidden']);\r\n      }\r\n      return  router.createUrlTree(['/login']);\r\n    })\r\n  )\r\n};\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:[(0,s.jsx)(n.strong,{children:"Remarque"})," : Nous utilisons les gardes de route fonctionnels introduits dans la version 14.2 d'Angular, qui sont bas\xe9s sur des fonctions plut\xf4t que sur des classes. Avant cette version, la seule mani\xe8re de cr\xe9er des gardes de route \xe9tait bas\xe9e sur des classes qui impl\xe9mentaient l'interface ",(0,s.jsx)(n.code,{children:"CanActivate"}),", maintenant ",(0,s.jsx)(n.code,{children:"deprecated"})," dans la version actuelle 16. Cependant, le principe reste le m\xeame : la route est activ\xe9e si la fonction ",(0,s.jsx)(n.code,{children:"CanActivateFn"})," retourne vrai."]})}),"\n",(0,s.jsxs)(n.p,{children:["Pour v\xe9rifier si un utilisateur est actuellement authentifi\xe9, nous observons l'",(0,s.jsx)(n.code,{children:"AuthenticatedUser$"})," fourni par le service ",(0,s.jsx)(n.code,{children:"AuthService"}),". Il est important de noter que ",(0,s.jsx)(n.code,{children:"AuthenticatedUser$"})," est un ",(0,s.jsx)(n.code,{children:"BehaviorSubject"})," qui renvoie la valeur ",(0,s.jsx)(n.code,{children:"null"})," par d\xe9faut."]}),"\n",(0,s.jsxs)(n.p,{children:["L'utilisation de l'op\xe9rateur ",(0,s.jsx)(n.code,{children:"take(1)"})," garantit que nous observons uniquement la premi\xe8re valeur \xe9mise par l'observable, puis nous nous d\xe9sabonnons automatiquement. Cela est suffisant car nous n'avons besoin que de la premi\xe8re valeur pour prendre une d\xe9cision concernant l'acc\xe8s \xe0 la route."]}),"\n",(0,s.jsxs)(n.p,{children:["Ensuite, nous utilisons l'op\xe9rateur ",(0,s.jsx)(n.code,{children:"map"})," de RxJS pour transformer l'objet ",(0,s.jsx)(n.code,{children:"User"})," en une d\xe9cision (vrai ou faux) :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Si l'utilisateur est authentifi\xe9 et a le r\xf4le requis, l'acc\xe8s est autoris\xe9 (",(0,s.jsx)(n.code,{children:"return true"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Si l'utilisateur est authentifi\xe9 mais n'a pas le r\xf4le requis, il est redirig\xe9 vers la page d'acc\xe8s refus\xe9 (",(0,s.jsx)(n.code,{children:"/forbidden"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Si l'utilisateur n'est pas authentifi\xe9, il est redirig\xe9 vers la page de connexion (",(0,s.jsx)(n.code,{children:"/login"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-de-la-page-login",children:"Cr\xe9ation de la page login"}),"\n",(0,s.jsx)(n.p,{children:"Le composant login g\xe8re le formulaire de connexion, la validation des donn\xe9es d'identification et l'authentification des utilisateurs, assurant ainsi un acc\xe8s s\xe9curis\xe9 \xe0 l'application."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"login.component.ts"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import {Component, OnDestroy, OnInit} from '@angular/core';\r\nimport {NgForm} from \"@angular/forms\";\r\nimport {AuthService} from \"../_services/auth.service\";\r\nimport {Router} from \"@angular/router\";\r\nimport {Subscription} from \"rxjs\";\r\n\r\n@Component({\r\n  selector: 'app-login',\r\n  templateUrl: './login.component.html',\r\n  styleUrls: ['./login.component.scss']\r\n})\r\nexport class LoginComponent implements OnInit,OnDestroy {\r\n\r\n  errorMessage! : string;\r\n  AuthUserSub! : Subscription;\r\n\r\n  constructor(private authService : AuthService, private router : Router) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.AuthUserSub = this.authService.AuthenticatedUser$.subscribe({\r\n      next : user => {\r\n        if(user) {\r\n          this.router.navigate(['home']);\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  onSubmitLogin(formLogin: NgForm) {\r\n    if(!formLogin.valid){\r\n      return;\r\n    }\r\n    const email = formLogin.value.email;\r\n    const password = formLogin.value.password;\r\n\r\n    this.authService.login(email, password).subscribe({\r\n      next : userData => {\r\n        this.router.navigate(['home']);\r\n      },\r\n      error : err => {\r\n        this.errorMessage = err;\r\n        console.log(err);\r\n      }\r\n\r\n    })\r\n  }\r\n  ngOnDestroy() {\r\n    this.AuthUserSub.unsubscribe();\r\n  }\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Lorsque la page login est initialis\xe9e (",(0,s.jsx)(n.code,{children:"ngOnInit"}),"), un abonnement (",(0,s.jsx)(n.code,{children:"subscribe"}),") est cr\xe9\xe9 \xe0 l'observable ",(0,s.jsx)(n.code,{children:"AuthenticatedUser$"})," du service d'authentification (",(0,s.jsx)(n.code,{children:"AuthService"}),")."]}),"\n",(0,s.jsx)(n.p,{children:"Le but est de v\xe9rifier si un utilisateur est d\xe9j\xe0 connect\xe9 et qu'il acc\xe8de \xe0 la page login, il est imm\xe9diatement redirig\xe9 vers la page d'accueil (home) sans avoir besoin de se reconnecter. Cela am\xe9liore l'exp\xe9rience utilisateur en \xe9vitant une double authentification inutile."}),"\n",(0,s.jsxs)(n.p,{children:["Il est important de d\xe9sabonner d'un observable que vous avez cr\xe9\xe9 dans vos composants Angular lorsque vous avez fini de les utiliser dans ",(0,s.jsx)(n.code,{children:"ngOnDestroy()"}),". Contrairement \xe0 ",(0,s.jsx)(n.code,{children:"HttpClient"}),", Angular ne g\xe8re pas automatiquement le d\xe9sabonnement de vos observables personnalis\xe9s."]}),"\n",(0,s.jsxs)(n.p,{children:["La m\xe9thode ",(0,s.jsx)(n.code,{children:"onSubmitLogin"})," est appel\xe9e lorsque l'utilisateur soumet le formulaire de connexion. Dans notre exemple, nous utilisons l'approche ",(0,s.jsx)(n.code,{children:"Template Driven Form"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Cette m\xe9thode s'abonne \xe0 l'observable retourn\xe9 par ",(0,s.jsx)(n.code,{children:"this.authService.login"}),",  auquel elle transmet le login et le password. Lorsque la requ\xeate d'authentification r\xe9ussit, la fonction ",(0,s.jsx)(n.code,{children:"next"})," est d\xe9clench\xe9e, et l'utilisateur est redirig\xe9 vers la page d'accueil (",(0,s.jsx)(n.code,{children:"this.router.navigate(['home'])"}),"), indiquant que l'authentification a r\xe9ussi."]}),"\n",(0,s.jsxs)(n.p,{children:["En cas d'erreur lors de la requ\xeate d'authentification, la fonction ",(0,s.jsx)(n.code,{children:"error"})," est d\xe9clench\xe9e. L'erreur (",(0,s.jsx)(n.code,{children:"err"}),") est captur\xe9e et stock\xe9e dans la variable ",(0,s.jsx)(n.code,{children:"errorMessage"}),", qui sera affich\xe9e dans le template pour informer l'utilisateur de l'\xe9chec de l'authentification."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Remarque : ",(0,s.jsx)(n.code,{children:"errorMessage"})," contient le message d'erreur personnalis\xe9 que nous avons d\xe9fini dans ",(0,s.jsx)(n.code,{children:"auhService"}),"  dans le bloc ",(0,s.jsx)(n.code,{children:"catchError"})," de la m\xe9thode login"]})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"login.component.html"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<div class="container mt-5">\r\n  <div class="row justify-content-center">\r\n    <div class="col-md-6">\r\n      <div class="card">\r\n        <div class="card-body">\r\n          <h4 class="card-title">Login</h4>\r\n          <div class="alert alert-danger" *ngIf="errorMessage">\r\n            <p>{{errorMessage}}</p>\r\n          </div>\r\n          <form #formLogin="ngForm" (ngSubmit)="onSubmitLogin(formLogin)">\r\n            <div class="mb-3">\r\n              <label for="email" class="form-label">Email</label>\r\n              <input\r\n                type="email"\r\n                class="form-control"\r\n                id="email"\r\n                placeholder="Email Address"\r\n                ngModel\r\n                #email="ngModel"\r\n                name="email"\r\n                required\r\n                email>\r\n              <div *ngIf="email.errors && formLogin.submitted" class="text-danger">\r\n                Email is required!\r\n              </div>\r\n            </div>\r\n            <div class="mb-3">\r\n              <label for="password" class="form-label">Password</label>\r\n              <input\r\n                type="password"\r\n                class="form-control"\r\n                id="password"\r\n                placeholder="Password"\r\n                ngModel\r\n                #password="ngModel"\r\n                name="password"\r\n                required\r\n                minlength="6">\r\n                <div *ngIf="password.errors && formLogin.submitted" class="text-danger">\r\n                  <div *ngIf="password.errors[\'required\']">Password is required</div>\r\n                  <div *ngIf="password.errors[\'minlength\']" >\r\n                    Password must be at least 6 characters\r\n                  </div>\r\n                </div>\r\n            </div>\r\n            <button  type="submit" class="btn btn-primary">Login</button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\n'})}),"\n",(0,s.jsx)(n.p,{children:"Le mod\xe8le de la page login est constitu\xe9 d'un formulaire HTML simple avec deux champs (email et mot de passe) comprenant des r\xe8gles de validation. Pour impl\xe9menter cette logique, nous avons opt\xe9 pour l'approche des \"Template Driven Forms\" d'Angular."}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-dune-barre-de-navigation-dynamique",children:"Cr\xe9ation d'une barre de navigation dynamique"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"header.component.html"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<nav class="navbar navbar-expand-lg navbar-light bg-light">\r\n  <div class="container-fluid">\r\n    <a class="navbar-brand">Angular JWT Auth</a>\r\n    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-\t\tcontrols="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">\r\n      <span class="navbar-toggler-icon"></span>\r\n    </button>\r\n    <div class="collapse navbar-collapse" id="navbarSupportedContent">\r\n      <ul class="navbar-nav me-auto mb-2 mb-lg-0">\r\n        <li class="nav-item" >\r\n          <a class="nav-link" aria-current="page"  routerLink="/home" routerLinkActive="active">Home</a>\r\n        </li>\r\n        <li class="nav-item" *ngIf="showAdminBoard">\r\n          <a class="nav-link" routerLink="/admin" routerLinkActive="active" >Admin Board</a>\r\n        </li>\r\n      </ul>\r\n      <form class="d-flex">\r\n        <button class="btn btn-outline-danger" type="submit" (click)="handleLogout()">logout</button>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</nav>\n'})}),"\n",(0,s.jsxs)(n.p,{children:['Notre barre de navigation est un simple menu de navigation Bootstrap qui permet de passer d\'une page \xe0 l\'autre, "Home" et "Admin". \xc9tant donn\xe9 que la page "Admin" est uniquement accessible aux utilisateurs ayant le r\xf4le admin, la visibilit\xe9 de l\'onglet "Admin" d\xe9pend du r\xf4le de l\'utilisateur gr\xe2ce \xe0 l\'utilisation de ',(0,s.jsx)(n.code,{children:'*ngIf="showAdminBoard"'}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Nous avons aussi un bouton de d\xe9connexion qui d\xe9clenche la fonction ",(0,s.jsx)(n.code,{children:"handleLogout()"})," lorsqu'il est cliqu\xe9."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"header.component.ts"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import {Component, OnDestroy, OnInit} from '@angular/core';\r\nimport {AuthService} from \"../_services/auth.service\";\r\nimport {Subscription} from \"rxjs\";\r\n\r\n@Component({\r\n  selector: 'app-header',\r\n  templateUrl: './header.component.html',\r\n  styleUrls: ['./header.component.scss']\r\n})\r\nexport class HeaderComponent implements OnInit, OnDestroy{\r\n  constructor(private authService : AuthService) {\r\n  }\r\n  showAdminBoard = false;\r\n  AuthUserSub! : Subscription;\r\n  ngOnInit(): void {\r\n   this.AuthUserSub = this.authService.AuthenticatedUser$.subscribe({\r\n      next : user => {\r\n        if(user) {\r\n          this.showAdminBoard = user.role.name === 'ROLE_ADMIN';\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  handleLogout() {\r\n    this.authService.logout();\r\n  }\r\n  ngOnDestroy(): void {\r\n    this.AuthUserSub.unsubscribe();\r\n  }\r\n\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["La variable ",(0,s.jsx)(n.code,{children:"showAdminBoard"})," est initialement d\xe9finie sur \"false\". Lors de l'initialisation du composant, nous r\xe9cup\xe9rons simplement l'utilisateur actuellement authentifi\xe9 pour v\xe9rifier s'il poss\xe8de le r\xf4le d'administrateur (ROLE_ADMIN). En fonction de cette v\xe9rification, nous mettons \xe0 jour la variable ",(0,s.jsx)(n.code,{children:"showAdminBoard"}),". Cette variable est utilis\xe9e dans le template pour refl\xe9ter dynamiquement les changements : elle permet d'afficher ou de masquer l'onglet \"Admin\" en fonction du r\xf4le de l'utilisateur connect\xe9."]}),"\n",(0,s.jsxs)(n.p,{children:["La m\xe9thode ",(0,s.jsx)(n.code,{children:"handleLogout()"})," appelle la m\xe9thode ",(0,s.jsx)(n.code,{children:"logout()"})," du service ",(0,s.jsx)(n.code,{children:"authService"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"impl\xe9mentation-de-la-m\xe9thode-logout-dans-le-service-authservice",children:"Impl\xe9mentation de la m\xe9thode logout dans le service authService"}),"\n",(0,s.jsxs)(n.p,{children:["Ajoutez la m\xe9thode ",(0,s.jsx)(n.code,{children:"logout"})," dans le service ",(0,s.jsx)(n.code,{children:"authService"}),". Elle fait appel \xe0 l'endpoint ",(0,s.jsx)(n.code,{children:"logout"})," de l'API, qui renvoie les cookies ",(0,s.jsx)(n.code,{children:"access_token"})," et ",(0,s.jsx)(n.code,{children:"refresh_token"})," vides."]}),"\n",(0,s.jsx)(n.p,{children:"Si la requ\xeate est r\xe9ussie :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Les donn\xe9es d'utilisateur stock\xe9es dans ",(0,s.jsx)(n.code,{children:"localStorage"})," sont effac\xe9es."]}),"\n",(0,s.jsxs)(n.li,{children:["L'observable ",(0,s.jsx)(n.code,{children:"AuthenticatedUser$"})," est mis \xe0 jour avec la valeur ",(0,s.jsx)(n.code,{children:"null"}),", indiquant que l'utilisateur est d\xe9connect\xe9."]}),"\n",(0,s.jsxs)(n.li,{children:["L'utilisateur est redirig\xe9 vers la page de connexion (",(0,s.jsx)(n.code,{children:"/login"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:" logout(){\r\n    this.http.request('post','http://localhost:8086/api/v1/auth/logout',{\r\n      withCredentials: true\r\n    }).subscribe({\r\n      next: () => {\r\n        this.storageService.clean();\r\n        this.AuthenticatedUser$.next(null);\r\n        this.router.navigate(['/login']);\r\n      }\r\n    })\r\n  }\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-du-service-user",children:"Cr\xe9ation du service User"}),"\n",(0,s.jsxs)(n.p,{children:["Dans l'API et dans notre ",(0,s.jsx)(n.code,{children:"AuthorizationController"}),", nous avons deux end-points qui affichent un message en fonction des permissions et du r\xf4le de l'utilisateur."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231017165513726",src:r(2998).Z+"",width:"924",height:"112"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231017165642243",src:r(3505).Z+"",width:"926",height:"113"})}),"\n",(0,s.jsxs)(n.p,{children:["Le service ",(0,s.jsx)(n.code,{children:"userService"})," permet de les invoquer :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@angular/core';\r\nimport {HttpClient} from \"@angular/common/http\";\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UserService {\r\n\r\n  constructor(private http : HttpClient) { }\r\n\r\n\r\n  getUserPublicContent() {\r\n  return  this.http.request('post','http://localhost:8086/api/v1/user/resource', {\r\n      withCredentials: true,\r\n      responseType : \"text\"\r\n    })\r\n  }\r\n\r\n  getAdminPublicContent() {\r\n    return  this.http.request('get','http://localhost:8086/api/v1/admin/resource', {\r\n      withCredentials: true,\r\n      responseType : \"text\"\r\n    })\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-de-la-page-home",children:"Cr\xe9ation de la page Home"}),"\n",(0,s.jsxs)(n.p,{children:["Le composant ",(0,s.jsx)(n.code,{children:"HomeComponent"})," est responsable de l'affichage de la page d'accueil de l'application. Il interagit avec le service ",(0,s.jsx)(n.code,{children:"UserService"})," pour r\xe9cup\xe9rer le message renvoy\xe9 par ",(0,s.jsx)(n.code,{children:" getUserPublicContent()"}),"  et avec  ",(0,s.jsx)(n.code,{children:"AuthService"}),", pour r\xe9cup\xe9rer les informations de l'utilisateur connect\xe9."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"home.component.ts"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import {Component, OnDestroy, OnInit} from '@angular/core';\r\nimport {UserService} from \"../_services/user.service\";\r\nimport {AuthService} from \"../_services/auth.service\";\r\nimport {User} from \"../_models/user.model\";\r\nimport {Subscription} from \"rxjs\";\r\n\r\n@Component({\r\n  selector: 'app-home',\r\n  templateUrl: './home.component.html',\r\n  styleUrls: ['./home.component.scss']\r\n})\r\nexport class HomeComponent implements OnInit, OnDestroy {\r\n\r\n  pubContent : string = '';\r\n  user! : User;\r\n  AuthUserSub! : Subscription;\r\n  constructor(\r\n    private userService : UserService,\r\n    private authService : AuthService\r\n  ) {\r\n  }\r\n  ngOnInit(): void {\r\n    this.AuthUserSub = this.authService.AuthenticatedUser$.subscribe({\r\n      next : user => {\r\n        if(user) this.user = user;\r\n      }\r\n    })\r\n\r\n    this.userService.getUserPublicContent().subscribe({\r\n      next : data => {\r\n        this.pubContent = data;\r\n      },\r\n      error : err => console.log(err)\r\n    })\r\n  }\r\n  ngOnDestroy() {\r\n    this.AuthUserSub.unsubscribe();\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"home.component.html"})}),"\n",(0,s.jsxs)(n.p,{children:["Il sert principalement \xe0 afficher la barre de navigation (",(0,s.jsx)(n.code,{children:"<app-header></app-header>"}),", qui inclut le composant ",(0,s.jsx)(n.code,{children:"HeaderComponent"}),"), ainsi que les informations r\xe9cup\xe9r\xe9es."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<app-header></app-header>\r\n<div class="container">\r\n  <div class="row m-5">\r\n    <div class="col">\r\n      <div class="card">\r\n        <div class="card-header">\r\n          Connected user information :\r\n        </div>\r\n        <div class="card-body">\r\n          <div *ngIf="user">\r\n            <p>ID: {{user.id}}</p>\r\n            <p>Email: {{user.email}}</p>\r\n            <p>Role: {{user.role.name}} </p>\r\n            <strong>Permissions:</strong>\r\n            <ul>\r\n              <li *ngFor="let p of user.role.permissions">\r\n                {{ p }}\r\n              </li>\r\n            </ul>\r\n          </div>\r\n          Message :<p>{{pubContent}}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-de-la-page-admin",children:"Cr\xe9ation de la page Admin"}),"\n",(0,s.jsxs)(n.p,{children:["La page admin, accessible uniquement par l'utilisateur disposant du r\xf4le admin, permet d'afficher le message renvoy\xe9 par la m\xe9thode ",(0,s.jsx)(n.code,{children:"getAdminPublicContent()"})," du service ",(0,s.jsx)(n.code,{children:"userService"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"admin.components.ts"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import {Component, OnInit} from '@angular/core';\r\nimport {UserService} from \"../_services/user.service\";\r\n\r\n@Component({\r\n  selector: 'app-admin',\r\n  templateUrl: './admin.component.html',\r\n  styleUrls: ['./admin.component.scss']\r\n})\r\nexport class AdminComponent implements OnInit{\r\n  adminPubContent!: string;\r\n  constructor(private userService : UserService) {\r\n  }\r\n  ngOnInit(): void {\r\n    this.userService.getAdminPublicContent().subscribe({\r\n      next : data => {\r\n        this.adminPubContent = data;\r\n      },\r\n      error : err => console.log(err)\r\n    })\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"admin.components.html"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<app-header></app-header>\r\n<div class="container mt-5">\r\n  <div class="row justify-content-center">\r\n    <div class="col-md-6">\r\n      <div class="card">\r\n        <div class="card-header">Admin Dashboard</div>\r\n        <div class="card-body">\r\n          <p *ngIf="adminPubContent">{{adminPubContent}}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"impl\xe9mentation-de-la-m\xe9thode-refreshtoken-dans-le-service-authservice",children:"Impl\xe9mentation de la m\xe9thode refreshToken dans le service authService"}),"\n",(0,s.jsxs)(n.p,{children:["Ajoutez la m\xe9thode refreshToken au service ",(0,s.jsx)(n.code,{children:"authService"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"  refreshToken(){\r\n    return this.http.request('post', 'http://localhost:8086/api/v1/auth/refresh-token-cookie', {\r\n      withCredentials: true\r\n    })\r\n  }\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Pour demander un nouveau ",(0,s.jsx)(n.code,{children:"access_token"}),", nous pouvons simplement envoyer une requ\xeate vers l'endpoint ",(0,s.jsx)(n.code,{children:"api/v1/auth/refresh-token-cookie"})," avec l'option ",(0,s.jsx)(n.code,{children:"withCredentials: true"}),". L'API va recevoir les cookies HTTP-only ",(0,s.jsx)(n.code,{children:"access_token"})," et ",(0,s.jsx)(n.code,{children:"refresh_token"}),", et en fonction de la validit\xe9 du ",(0,s.jsx)(n.code,{children:"refresh_token"}),", l'API va renvoyer soit un nouveau ",(0,s.jsx)(n.code,{children:"access_token"})," avec un code HTTP 200, soit une erreur avec un code HTTP 403."]}),"\n",(0,s.jsx)(n.p,{children:"Et si nous recevons une erreur 403, dans ce cas, il est n\xe9cessaire de d\xe9connecter l'utilisateur. Pour ce faire, nous utilisons les intercepteurs HTTP."}),"\n",(0,s.jsx)(n.h3,{id:"gestion-des-erreurs-avec-les-intercepteurs-http-angular",children:"Gestion des Erreurs avec les Intercepteurs HTTP Angular"}),"\n",(0,s.jsx)(n.p,{children:"L'intercepteur joue un r\xf4le essentiel dans la gestion de l'authentification et de la s\xe9curit\xe9 au sein de notre application Angular. Il est responsable de l'interception de toutes les requ\xeates HTTP sortantes."}),"\n",(0,s.jsx)(n.p,{children:"Notre objectif principal est de g\xe9rer les requ\xeates en fonction du contexte de l'utilisateur authentifi\xe9. Lorsqu'un utilisateur est authentifi\xe9, l'intercepteur est configur\xe9 pour r\xe9agir de la mani\xe8re suivante en cas d'erreur HTTP :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Pour une erreur ",(0,s.jsx)(n.strong,{children:"403 (acc\xe8s refus\xe9)"})," : Cela signifie que l'utilisateur n'a pas l'autorisation d'acc\xe9der \xe0 une ressource particuli\xe8re. Par exemple, si un utilisateur avec le r\xf4le \"user\" tente d'acc\xe9der directement \xe0 la page admin en saisissant l'URL \"/admin,\" l'intercepteur emp\xeache l'acc\xe8s."]}),"\n",(0,s.jsxs)(n.li,{children:["Pour une erreur ",(0,s.jsx)(n.strong,{children:"401 (non autoris\xe9)"})," : Cela indique que le token  ",(0,s.jsx)(n.code,{children:"access_token"})," a expir\xe9, ce qui signifie que l'utilisateur n'a plus acc\xe8s. Dans ce cas, l'intercepteur tente de rafra\xeechir le token en appelant la m\xe9thode ",(0,s.jsx)(n.code,{children:"refreshToken()"})," du service ",(0,s.jsx)(n.code,{children:"AuthService"}),".","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Si le rafra\xeechissement r\xe9ussit, la requ\xeate est renvoy\xe9e avec le nouveau ",(0,s.jsx)(n.code,{children:"access_token"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Si le rafra\xeechissement \xe9choue, par exemple avec une erreur 403 (acc\xe8s refus\xe9), l'utilisateur est d\xe9connect\xe9 car le ",(0,s.jsx)(n.code,{children:"refresh_token"})," est invalide."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Enfin, pour toutes les autres erreurs inattendues, elles sont renvoy\xe9es au service appelant afin d'\xeatre trait\xe9es ult\xe9rieurement."}),"\n",(0,s.jsx)(n.p,{children:"Voici le code de l'intercepteur :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Injectable } from '@angular/core';\r\nimport {\r\n  HttpRequest,\r\n  HttpHandler,\r\n  HttpEvent, HttpErrorResponse,\r\n} from '@angular/common/http';\r\nimport {catchError, concatMap, Observable, switchMap, take, throwError} from 'rxjs';\r\nimport {AuthService} from \"../_services/auth.service\";\r\nimport {Router} from \"@angular/router\";\r\n\r\n@Injectable()\r\nexport class HttpInterceptor implements HttpInterceptor {\r\n\r\n  constructor(private authService: AuthService, private router: Router) {\r\n  }\r\n\r\n  intercept(request: HttpRequest<unknown>, next: HttpHandler): Observable<HttpEvent<unknown>> {\r\n    return this.authService.AuthenticatedUser$.pipe(\r\n      take(1),\r\n      switchMap(user => {\r\n        if (!user) {\r\n          return next.handle(request);\r\n        }\r\n        return next.handle(request).pipe(\r\n          catchError(err => {\r\n            if (err instanceof HttpErrorResponse) {\r\n              switch (err.status) {\r\n                case 403:\r\n                  this.router.navigate(['forbidden']);\r\n                  break;\r\n                case 401: // handle 401 unauthorized error : try to refresh JWT\r\n                  return this.authService.refreshToken().pipe(\r\n                    concatMap(() => next.handle(request)),\r\n                    catchError(err => {\r\n                      if (err.status === 403) {\r\n                        this.authService.logout();\r\n                      }\r\n                      return throwError(() => err);\r\n                    })\r\n                  )\r\n              }\r\n            }\r\n            return throwError(() => err);\r\n          })\r\n        );\r\n      })\r\n    );\r\n  }\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"next.handle(request)"})," est un observable qui repr\xe9sente une requ\xeate HTTP asynchrone, et ",(0,s.jsx)(n.code,{children:"this.authService.refreshToken()"})," est \xe9galement un observable, utilis\xe9 pour effectuer un rafra\xeechissement asynchrone de l'",(0,s.jsx)(n.code,{children:"access_token"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Il est donc essentiel de g\xe9rer les op\xe9rations asynchrones de mani\xe8re contr\xf4l\xe9e."}),"\n",(0,s.jsxs)(n.p,{children:["Le choix d'utiliser l'op\xe9rateur ",(0,s.jsx)(n.code,{children:"switchMap"})," \xe9tait pertinent en raison de l'observable ",(0,s.jsx)(n.code,{children:"this.authService.AuthenticatedUser$"}),", qui n'\xe9met qu'une seule valeur gr\xe2ce \xe0 ",(0,s.jsx)(n.code,{children:"take(1)"}),". Avec ",(0,s.jsx)(n.code,{children:"switchMap"}),", toute nouvelle valeur \xe9mise par cet observable annule automatiquement les requ\xeates HTTP en cours, garantissant ainsi un changement instantan\xe9 lorsque l'\xe9tat d'authentification de l'utilisateur change."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"concatMap"})," est utilis\xe9 pour maintenir l'ordre des requ\xeates, assurant que les requ\xeates HTTP sont g\xe9r\xe9es de mani\xe8re s\xe9quentielle. Cela garantit que ",(0,s.jsx)(n.code,{children:"next.handle(request)"})," ne sera ex\xe9cut\xe9 qu'une fois que ",(0,s.jsx)(n.code,{children:"this.authService.refreshToken()"})," est termin\xe9."]}),"\n",(0,s.jsxs)(n.p,{children:["Enfin d\xe9clarez l'intercepteur dans ",(0,s.jsx)(n.code,{children:"app.module.ts"})," pour qu'il soit utilis\xe9 par l'application :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"  providers: [{provide : HTTP_INTERCEPTORS, useClass : HttpInterceptor, multi: true}]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["L'option ",(0,s.jsx)(n.code,{children:"multi: true"})," permet d'ajouter cet intercepteur \xe0 la liste d'intercepteurs HTTP, car il peut y en avoir plusieurs. Si elle est d\xe9finie sur ",(0,s.jsx)(n.code,{children:"false"}),", cela remplacerait tous les intercepteurs existants au lieu d'en ajouter un de plus."]}),"\n",(0,s.jsx)(n.h3,{id:"cr\xe9ation-du-composant-access-denied",children:"Cr\xe9ation du composant access-denied"}),"\n",(0,s.jsxs)(n.p,{children:["Le composant ",(0,s.jsx)(n.code,{children:"access-denied"})," affiche simplement un message d'erreur avec un bouton permettant de rediriger l'utilisateur vers la page Home."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<div class="d-flex align-items-center justify-content-center vh-100">\r\n  <div class="text-center">\r\n    <h1 class="display-1 fw-bold">403</h1>\r\n    <p class="fs-3"> <span class="text-danger">Oops!</span> Access Denied.</p>\r\n    <p class="lead">\r\n      The page you\'re trying to access is restricted.\r\n    </p>\r\n    <a href routerLink="/home" class="btn btn-primary">Go Home</a>\r\n  </div>\r\n</div>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"mise-en-place-de-lauto-login",children:"Mise en place de l'auto-login"}),"\n",(0,s.jsx)(n.p,{children:"L'auto-login, ou \"authentification automatique,\" est en effet un m\xe9canisme qui permet \xe0 un utilisateur d'\xeatre reconnect\xe9 automatiquement \xe0 une application sans avoir \xe0 saisir manuellement ses identifiants (comme son email et son mot de passe) \xe0 chaque visite ult\xe9rieure. Ce m\xe9canisme am\xe9liore l'exp\xe9rience utilisateur en rendant le processus d'authentification plus transparent et pratique."}),"\n",(0,s.jsxs)(n.p,{children:["Techniquement, dans notre application Angular, si l'utilisateur quitte son navigateur ou son onglet sans se d\xe9connecter et qu'il revient ult\xe9rieurement, nous pouvons le reconnecter automatiquement en utilisant les informations stock\xe9es dans le ",(0,s.jsx)(n.code,{children:"localStorage"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Ajoutez la m\xe9thode ",(0,s.jsx)(n.code,{children:"autoLogin()"})," dans le service ",(0,s.jsx)(n.code,{children:"authService"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"  autoLogin() {\r\n    const userData = this.storageService.getSavedUser();\r\n    if (!userData) {\r\n      return;\r\n    }\r\n    this.AuthenticatedUser$.next(userData);\r\n  }\n"})}),"\n",(0,s.jsxs)(n.p,{children:["La m\xe9thode ",(0,s.jsx)(n.code,{children:"autoLogin()"})," restaure automatiquement l'\xe9tat d'authentification de l'utilisateur en utilisant l'objet User pr\xe9alablement sauvegard\xe9 dans le ",(0,s.jsx)(n.code,{children:"localStorage"})," et l'\xe9met dans ",(0,s.jsx)(n.code,{children:"AuthenticatedUser$"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Elle doit \xeatre appel\xe9e au d\xe9marrage de l'application, de pr\xe9f\xe9rence dans le composant racine ",(0,s.jsx)(n.code,{children:"AppComponent"}),". Cela garantit que l'\xe9tat d'authentification de l'utilisateur est restaur\xe9 d\xe8s le chargement de l'application :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import {Component, OnInit} from '@angular/core';\r\nimport {AuthService} from \"./_services/auth.service\";\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.scss']\r\n})\r\nexport class AppComponent implements OnInit{\r\n  title = 'angular-auth';\r\n\r\n  constructor(private authService : AuthService) {}\r\n    \r\n  ngOnInit() {\r\n    this.authService.autoLogin();\r\n  }\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Veuillez noter que si l'",(0,s.jsx)(n.code,{children:"access_token"})," expire, l'intercepteur tentera automatiquement de demander un nouveau. Si cette tentative \xe9choue, l'utilisateur sera redirig\xe9 vers la page login o\xf9 il devra se reconnecter. Cette situation peut \xeatre consid\xe9r\xe9e comme une forme d'auto-login, car l'utilisateur est redirig\xe9 vers la page login pour obtenir un nouveau ",(0,s.jsx)(n.code,{children:"access_token"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"d\xe9monstration",children:"D\xe9monstration"}),"\n",(0,s.jsx)(n.p,{children:"\xc9chec de la connexion"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018144534277",src:r(7575).Z+"",width:"360",height:"326"})}),"\n",(0,s.jsx)(n.p,{children:"Exemple d'authentification r\xe9ussie avec un utilisateur ayant le r\xf4le USER, la page home s'affiche par d\xe9faut."}),"\n",(0,s.jsx)(n.p,{children:"La barre de navigation n'affiche que l'onglet Home."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018144918466",src:r(1781).Z+"",width:"861",height:"371"})}),"\n",(0,s.jsx)(n.p,{children:"Deux requ\xeates sont envoy\xe9es \xe0 l'API avec un code HTTP 200 : la premi\xe8re est pour l'authentification, la deuxi\xe8me est pour r\xe9cup\xe9rer le message \xe0 partir de l'end-point s\xe9curis\xe9."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018145039994",src:r(5729).Z+"",width:"801",height:"298"})}),"\n",(0,s.jsx)(n.p,{children:"Dans la r\xe9ponse de la requ\xeate d'authentification, nous pouvons constater que nous avons bien re\xe7u les cookies envoy\xe9s par l'API."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018145415340",src:r(7052).Z+"",width:"1118",height:"589"})}),"\n",(0,s.jsxs)(n.p,{children:["Dans la requ\xeate demandant l'acc\xe8s \xe0 l'end-point s\xe9curis\xe9, nous pouvons clairement voir que notre application Angular a inclus les cookies contenant les ",(0,s.jsx)(n.code,{children:"access_token"})," et ",(0,s.jsx)(n.code,{children:"refresh_token"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018145633521",src:r(6196).Z+"",width:"1120",height:"587"})}),"\n",(0,s.jsx)(n.p,{children:"Nous pouvons \xe9galement observer que les cookies sont stock\xe9s dans le navigateur avec les options HttpOnly, Secure et SameSite strict."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018145839650",src:r(2371).Z+"",width:"1118",height:"402"})}),"\n",(0,s.jsxs)(n.p,{children:["Les informations de l'utilisateur authentifi\xe9 sont \xe9galement bien enregistr\xe9es dans le ",(0,s.jsx)(n.code,{children:"localStorage"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018145946686",src:r(1619).Z+"",width:"1113",height:"341"})}),"\n",(0,s.jsxs)(n.p,{children:["Si l'",(0,s.jsx)(n.code,{children:"access_token"})," a expir\xe9 et que l'utilisateur a interagi avec l'application (dans ce cas, en actualisant la page Home), nous pouvons constater que la requ\xeate visant \xe0 r\xe9cup\xe9rer le message depuis l'end-point s\xe9curis\xe9 a \xe9chou\xe9 avec un code HTTP 401. \xc0 ce moment, l'intercepteur a envoy\xe9 une deuxi\xe8me requ\xeate pour actualiser l'",(0,s.jsx)(n.code,{children:"access_token"}),", et la r\xe9ponse \xe9tait accompagn\xe9e d'un code HTTP 200. La navigation se poursuit sans demander \xe0 l'utilisateur de se reconnecter."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018160146964",src:r(9526).Z+"",width:"1111",height:"523"})}),"\n",(0,s.jsxs)(n.p,{children:["Si le ",(0,s.jsx)(n.code,{children:"refresh_token"})," n'est plus valide, nous pouvons voir que la r\xe9ponse de la requ\xeate de rafra\xeechissement arrive avec le code HTTP 403. Dans ce cas, l'utilisateur est d\xe9connect\xe9 automatiquement et redirig\xe9 vers la page login."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018161030539",src:r(8562).Z+"",width:"1115",height:"476"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Remarque"})," : Pour \xe9viter d'attendre l'expiration de l'",(0,s.jsx)(n.code,{children:"access_token"}),", du ",(0,s.jsx)(n.code,{children:"refresh_token"}),", vous pouvez simplement les supprimer. Cela vous permettra de simuler les tests que nous avons effectu\xe9s \xe0 chaque \xe9tape."]}),"\n",(0,s.jsxs)(n.p,{children:["Si l'utilisateur tente d'acc\xe9der \xe0 la page admin en tapant directement l'URL ",(0,s.jsx)(n.code,{children:"/admin"})," :"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018160322594",src:r(6127).Z+"",width:"770",height:"369"})}),"\n",(0,s.jsx)(n.p,{children:"Exemple d'authentification r\xe9ussie avec un utilisateur ayant le r\xf4le ADMIN."}),"\n",(0,s.jsxs)(n.p,{children:["Cette fois, nous pouvons constater qu'un nouvel onglet ",(0,s.jsx)(n.code,{children:"Admin Board"})," s'affiche dans la barre de navigation."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018161314142",src:r(6908).Z+"",width:"856",height:"437"})}),"\n",(0,s.jsx)(n.p,{children:"Voici le contenu de la page de connexion, qui affiche simplement le message r\xe9cup\xe9r\xe9 depuis l'end-point s\xe9curis\xe9."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20231018161403580",src:r(3081).Z+"",width:"860",height:"439"})}),"\n",(0,s.jsx)(n.h2,{id:"code-source-de-lapplication",children:"Code source de l'application"}),"\n",(0,s.jsxs)(n.p,{children:["Voici le lien vers le code source de l'application : ",(0,s.jsx)(n.a,{href:"https://github.com/MossaabFrifita/angular-16-jwt-authentication-authorization",children:"https://github.com/MossaabFrifita/angular-16-jwt-authentication-authorization"})]}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(n.p,{children:"La gestion de l'authentification est un \xe9l\xe9ment essentiel de toute application web s\xe9curis\xe9e, et gr\xe2ce aux connaissances acquises dans cet article, vous serez en mesure de d\xe9velopper des applications Angular plus s\xfbres et plus fiables. Bonne mise en \u0153uvre de l'authentification dans vos projets !"})]})}function u(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},4567:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/angular-project-structure-57cf1b1cf1e9909973843ed4c1423932.PNG"},2425:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231016173244505-f975500a66a89a0144b03abeb6637310.png"},9831:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231016221545010-2dedf2e6727ea02c49e05317bf7be676.png"},2255:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231016225628911-686b2341e5f7ac4a524f4174b1ef1797.png"},2998:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231017165513726-ae3c025c2b8f7a4d8f19814c5c8349db.png"},3505:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231017165642243-51776736923fe25e94df292ffb320071.png"},7575:(e,n,r)=>{r.d(n,{Z:()=>s});const s="data:image/png;base64,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"},1781:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231018144918466-c17f0f64298abac90b69fd0ff8de0ead.png"},5729:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231018145039994-6823707cefe8d00cbf663356c51686e6.png"},7052:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231018145415340-07d225531fcbc5de69433fbd754761f1.png"},6196:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231018145633521-2d1af888d6c9ffb4b3b963e37e7298ab.png"},2371:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231018145839650-984e4816e658b230698a2cbff5d484f1.png"},1619:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231018145946686-c6c95eaca28d350efbd1df05e9a36341.png"},9526:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231018160146964-25bc61fcb97bb30a8d44578da0b9bb6a.png"},6127:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231018160322594-ebb11d6ea374b1d27f84090dad48313f.png"},8562:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231018161030539-cb56cf0f5510e880753cee59d8f9e2b9.png"},6908:(e,n,r)=>{r.d(n,{Z:()=>s});const s=r.p+"assets/images/image-20231018161314142-8dadeb0447b5b5e8fb10d975a97a4b95.png"},3081:(e,n,r)=>{r.d(n,{Z:()=>s});const s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA1wAAAG3CAIAAAAvm8P7AAAgAElEQVR4nO3df3CV9Z0v8E/8AXS3vf4KkopVTDBbmepFnC52ixEGsfS6c80YF4EdobFxhE5/7LgrRS9s4GIBYddeW0e8Y64UnNXIEid2tldaZAIpXs12+VHtxb0piaikDSbWut22JCvk/nF+5CTnBBIEDjav12SYk+c8z/f5PM85Gd7n+/0+zyk4evRoT09PZBjSr8ddDgDAqVZQUDCY5cf4taBfKBzM4+xfj01eBAD48AZKfoNZuU/+y/W44MiRI+mlOVPgMaJhziUAAORLdnDMHQGzFvaGwmOnQNEQAOBMdsJxMPEgGQqzw98xHoSZhQAAZ4bBzCbMToTZD87J2Upn57tZy9LRMGPRoBKgmAgAcLIcf1phZkrMTIb9VissvCjz13Miqy8w8e8FF154YpUCAHCG64mzPzjaZ8lZOUeHAQAYVs7q97toCAAwDCVDYebAsVwIADDc9O8pBABgGDorcncT6iwEABhGctySxvAxAMAgHX3v1//x5sFB3qjvNDi78KJzPnXJCWx4zmBuSQ0AQD89XV3v/d1jR9//txGlJXHWEL6V+JT64BeHjhx657yvVo34k/FD2jDZU9gvDgqHAADH1nnf8k/cceuoz0/OdyH9ffB223urH7lg8V8NqcvQLWkAAIbst8+/8LEpf3oGJsKIOOdTY89beNe/bXhmSFv1hkJ3sQYAGKTDTbv+aMa0fFcxoBGf+fSRXx4a0iZuSQMAMGRHf/PvZ11wXr6rOKazhhbzem9Jk0lfIQDAsNInQho4BgAYngwfAwDg6mMAANKh8ESz4CurR44YtfKVk1hQf02rRo1c1fRhWmirnZ1ooa129shZtW39nhqxuqnfklm1be21c0eMGtn/Z/VAdbTVzh45Yvaz7SdUX3vt3BPeFgDg5Phww8dNDcsqysuXN3yo0HbajJ1aXlFfvzMjfh18oz5i2bZX+iypuG3a2KLZT3cf7uo+3PXW9ypiWWPicffiAW5FdGjnc1FRXv/89kFe+X3o2VmnMEnv//785/f3+f3Rl98/VTs7pmMG+kPPzhpUFE5n+uN4ZXU6vs+tHdol+ANqr53b91MEAAza+4/dcujVfBcxFDlC4eB7DZu2VS/7xnfKK6o/Iqmw6IrPRH3LgfTvTduqyyvK42cHDmUsic+MGzO0Ztsbno/ytfcuq3uuQYDI0LRtz7LqPd/+kJ2gY2fXdt0/uBuDLt/R1X24q3vHZ+Z9Q88rAH/YXl138LGfntwmP0xP4SsNy5dPm1w07dbyZY9k9s28snrkiNVNvSOwfUZdm1alRmNXNTWtSnXqJDZJr9ReOzfXWG1b7ex0b1BvT1ti20RH0XG6lCZPXx69/ZqvNCwvL//GbeW9Ya79jZ/FsunXD+00tG2vj9umjb1+WnX9lzb09v81rewzsJ7qHWyvnTvi8nn1sbxsVN8R56aVyUP7QxlKfqXhZ7dVzr8tBt2BerJMnr48M/oDAINx4qHw0LMPL6ueNjlizJTMXJW0rOzrsbb7cFf3mxvLl5WlslrTqlFle77XmhiNndZQVj20Pe58ozy5beOy5WWZqXFZWcO0ru7Dx+1SmjxtWex5I1Fq24G9ce0Vk6eWV9QfOJhYsr2+rnzcpUMqKpo2zItbp47pnzgHUjT76e43N5ZHdePhru7aO4oSS+vnXdYwvftwV/fhxuX1875+qoYsf/Xyd+bdOX/enfPn3fn95Ajz/u/P+/7+/d+fP+/O+fO+vz/ef/nRO+fPu3N+74hzaknvJoPT1LD31qljxk4tj8z3RnqQd1VDatGhZ2fNfvaVxEeI2c+2pz82JF/fttrZiU8ObbWz59Y2PTtr1MgRo0YeY1S3vfaRPd+bn0z26aidMabcO9CczN9ttbPn1tauTH2oSH9uWbl9KAcMAAM51Pk3txyccsvBKbdkdO/99FBiyZR1nT/461/84NBAa2YOQycfv7ru4Ff+KZ5+4OCUv+5856RVecKhsL3h+fpkp1r2XL2I8o3fmT02ImLMHfemclh77SPV6eUR1y9uXD6kXY654/70ttOqY++B3j2Wb6wc3AjjuHGpUg/tfK6+etrkKJp2a3lyWmFyQuGQinqlYXl5+ZSiiETiPNGR9OrG5ITFyZXfyzqZQ1a3fH4q/M2ft7wusfBXL3/nr37y2f/x1IaNT23YWB3//Tsv/yrxxD+u+L8TNmx86jsLD6yYtyHmPrVh46ML4rEd+yPi/ZcfTSxJbDL4WNhe+8ie8ilFEUXTbo3U4bTXzi3bu/GtxEeCA/Pq02vXz3s41nYf7mqcOO+yUdumJcJx3+7nxHHN+3Z853BX95sbI7NTNqX6xpEjRo287EufuTfxPmlaOeLGaEzMB33z1ucuT3bcXr+4K/nRYuK89U2plg9M7z7cdf/kttrZ6c8t09/4Ut1gDxgABnCo82/u6p725KU7f3Dpzh98Ih74xQ8ORRzq/JsHjtyfWPhnR1b968Br5nLNwksf+/OYu/LSnX9fePFJK/SsE7zuuG17fd3yackgVjTt1v6XWUwcV5TxW6Ir7sCBun7Lhyzd8XNj3zw56GbTpfaG2jHjrk1MK2zaVl1+69ShTShsaljWmyOvn1bd97KVQSsvGXcCWw2oonrDxqdSP9UViYW/6oiF8z93YeKX8TcujJ/8v0Rv4F8svXV8RJw3elxU/JfPXRgR543+VGK1jo5//snjf5UOlwc6fjW4ApJD6hERY6akR5APHIiNjyQ7R6+v3FieXj31UWHcuIryZCffpVeUZ7UaFcnNx0y5rTxjJmhKck7h4ekNo+bWHor2N362fMcDyS7DMXfcuyzVj3so2d1Y1tttXJH6VHHwjUh/bplc+b2KwR0vAAyo/UgsPP+WZL447/aF0fCT30X7kVf+/I+TC//zJ+7/9MBrnj7nnNhmh3Y+Vx/19SP7jP82tM2efZxutiEPzmZ4ZfXIsmXVjYe7ro+IppUjvn1CrYyZclv5vDcOxLgDdeXj1kZExORpy+oebmibGj+LidOHllmbtlVHXVw+cl7GsoamB64fXLflR8JfLN34X8cPcZtDO5+rr6uv7z0t5eVts2fHgb0nubYBTJ62rK7hQEzNXduzsy5vufdw16aI9tq5X+//7IE9EZWnvkQAhrd33j5y/afOzXcV/Qw0fHzs7sP2hufr0zdqSfzs6HuZRS69Q7cJhw7syXgqc80DB7KH7ZoallVsfPOBIV4FEsn7zvQaO25iVDeszOzhGzeuor5+w/qMvs9BeqVheXlqimT6FjbViettx5X06eo60FI/QCOny4WjY92G1JDx/h3r4rN/ctyv8R49+k//8X8P+YY27Q3PR+ZpSY72jp1aHunx2lfWzztlJ6SpYVnFFeOi6IrPVN+YutYnPQX2QEt9sl+2bXt91ttszJTbemtsWm/4GIAPrejsWPfr1EDw+5vXxbTP/tHFnx0R636TnCn4098kh49zrRlx7uWf/o+difmFPz389CkstDcUDmEcuWn9l7Ly0yAusyiadmt5ffp/3Lbab/TGgqIrPhPpOWRNK8uWZW996RW9l7M0rbpx0NMRm7ZV951xeP206li2PPPWM0XTbi2vX15dXz20THjo2YeX9Z+D2DuSPmbctbH84dqBCs4x+nmKXfi5r//tuPRYcPzt11NDycdw3ue+Wj1u3VeT0xMHeb/DjLHjhDFTbitf3tAURbPXbtxblpgA0DBuY47x4Q8nMadwxKiy2PH07DERkx9463s/K0vMN7j8+dsSnygmz98Y8y4bNXLEqPvemJg9Ojx29iMb9yTb2XaF4WMAPrQxhX+38uxVdyUuH/lNrLzkljERYwoXLTzylcQ1Jf/n7OTwcc41449umXfu0w8k1oy5qVav+bNzT/aFJgXd3d0R0dPTkwiFiQfvvffriwoLB9omOX+/f6fdK6tHlkVj9+LJ6Qf9lkckBu8SWbBi45vfeOPyR6548+nZY1KrJbLgssa3xj1y2YFvdC+enLhgOXZ03T85c9vqxh1R9u2St2rvKOrXfob22rmXfakuojqr1KZVo8qql2Vu0lY7u3hebHwrfTlwZiPJSvprr517Wf2tWZu01c4ufq68ddPssdG0MjX3sbrxzZKHL2+5N1VJ8mDLN75Ve0f0bWeAZgGAM0nH1xaP/u7qk9LU+4/dcnjKD8Zcc1Ia63XsCnvi7H5LTiQUnizJ2V0nMCIMAJBXJy0UvvNPv7jt7T/eufC4k7qGaqih8AQvNDkJ2mq/Ma9+WeOmvBUAAJAn7z92y2+SEwQ/Peq5vz/pifAEnNZQ2Dv+GxFR/r3W7uNdrQwA8AfovK/84Lyv5LuIvk5rKBxzx6bDd5zOHQIAMCgf5ruPAQCGqbM+8fGj7w31rm2n19GjQ1pdKAQAGLJRk6/73daGfFcxoO6f/evZnxza17QJhQAAQ/bHt37x9zv/+fBLx7xHc5588Hbb++ue/E/z5wxpq3zekgYA4KOrp6vrvb977Oj7/zaitCTOKsh3OUkf/OLQkUPvnPfVqhF/cqzvqT2z7lMIAPBRd/S9X//Hmwdj8N8Md4qdXXjROZ+65LirnUn3KQQA+Og764LzR15wfr6rOAnMKQQAQCgEAEAoBAAghEIAAEIoBAAgjnH18cgR557OOgAAOG0Od/f/Ejw9hQAACIUAAAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAACEUAgAQAiFAABExDn5LgDOLO3t7f/+7/9+1lk+L8EfvqNHj3784x8vKirKdyFwRhAKoddbb711/vnnX3DBBfkuBDhNurq63nrrrcsuuyzfhUD+6Q6BpPb29gsvvHDkyJH5LgQ4fUaOHHnhhRe2t7fnuxDIP6EQkn7729+ee+65+a4CON3OPffc3/72t/muAvJPKAQAQCiElIKCgnyXAOSHP38IoRAAgBAKAQAIoRAAgBAKAQAIoRAAgBAK4US9uubqa9fsHuDJ3Q9f9fCrg2vka3WHjrvau3ULr73q6tTPwvrOQVfZWf+1e+rf7bdw78MDV37iXl1z9cN7T3qrAJwuQiGckN0vtlTe2fLEEPJZLtcseu27FWMGs+aUB1/c8/pre15/bc+Pv7DtBvELgJNNKIQTsXf7Gzf/5fybY9uO4/fznWSF5d/98Yo31mX1/wHAhyEUwgl49Uc/n37jmItu/EL86OV0OEsP8n6t7q3kos76r91T/2pi+T3178buhxNDwKnR29SQ66H6exbW763/WnLz4wXNws9Njx/+uDOiM7nJtVel+w5Tu8gYZW5LFtZn3PnVNf1XyxikTo19Z7ffWf+1e+rr16TWSa9wT33rCZ5LAM4MQiEMWWf9Ey1fuKEwI5xFxN6Hb1py5YbXX9vz+mvL4odPpVduXPpELNvz+msbSpbedNX2m15/bc/rG+5cnz3uvHP5ulj2+mt7frwilvzDYOYjRkQUln83Oaac7Dt8t+6JN5IDzevKC/sU8OKDsfzJ1FTC9fNfvPm1Pa+/tueZK5f/t8SGC2/60RdeTLT2TMxPzETMaj/RYOvNr+15/d5rYvfDNyy94pnX9rz+2p5vxbb1J3xCATgDCIUwVO/u+GHc/LmLIiLG3JAaQX635ed3PnPvNRERcVHF3Xem1y5bsaxiTESMLZky5cG/vCYiYmxxWXarU6q/VX5RRBR+bnrZz1uPP1XxyuLCiHSH3w1Ldza2tkVcVHLlziU39ZlxmCrgohu/MKXlrWSwq9xw78SIiJj4l9Xxwx93RltLJAvIWJjdfqLB+YltO996I91OYfndlcetGYAzmFAIQ3Toxz/auXPJTYlB1ZuW7Nz5o5ffjWhr2Xn6Stj7D8ujeGzEq2uufqIk0S+4IRlDJ9675/XXbvrREC9SHkCO9jMdbD2NxwzAKSYUwtB0vrwtViSHWV9/bc/rL1bH0g1745qbK59KDbC+W/fEU8dp5UPY+/C1c35e/a3yi+JQa0tcUTImImLv9sw9XrPotRcfPOZFMOu3J0eo9/7D8vjCDYUxtiQS48gZCwdsP2ni1N5x8M76JwwfA3yknZPvAuCj5d0dP4ybl13Uu2DMDTdPWf6j3fcuundDydU3XbU0IqY8uOLOOMnXXexcctO1SxIPKze8vu6aiIgx5Qsrr51z9VMRUVmZ6Ml7t27hTUt2RkSUrXjxf46JgToLK+PFq66en2yt/KKIqFi3oSVZf3phdvt9Tbr3mSuvveHq5RFRtqK68mQfMwCnU0F3d3dE9PT09PT0pB+8996vL7nkk/muDU6r1tbWsWPH5rsKIA/a2tqKi4vzXQWcVoe7j/ZbYvgYAAChEAAAoRAAgBAKAQAIoRAAgBAKAQAIoRAAgBAKAQAIoRAAgPA1d5B29OjRI0eO5LsKIA+OHu3/1Q4wDAmFkFRQUCAUwvBUUFCQ7xIg/4RCSCooKPjEJz6R7yqAPOjo6Mh3CZB/5hQCACAUAgAgFAIAEEIhAAAhFAIAEEIhAAAhFAIAEEIhAAAhFAIAEEIhAAAhFAIAEEIhAAAhFAIAEEIhAAAhFAIAEEIhDN3elaVrd2f8vnvNgk3tuVftqFtwV11n5oPTafeaCSt3neZ9Mji71hav2ZvvIoaive6uqrqOfFexe82E0/93BMOHUAicwfIbnoa6949c1Du2EwiCpzg7Tlq078mKwlPWPAx3QiEAAEIhnEydm6omFJdOKC49xrht7zoD9Sp11C3ofaq97q7EaHV73V2lfRvP7JUZsIdm78o+++q3985NVb2l9o5x71qbXCe7zfRTpb2D5rvXJNtMbt5banKcvf8K6aqSjQxw3natLZ6zPmrmpveVbidHYb1tZo8w7l1ZunZ3qvL0s7vXTFhZV3dXcknW6zLw3nvbzzxR/dfPPqj0kgWbDuR8pdZuqlsw4OZZL0r22cicMJB+3Pcwj/9iJbXX3VW2dHvj0skZL8rbdQv6vPT93gy5NslxaDn2mH7t1m5KvQkHPJZdJ3KugEHp7u7u7u7u6uo6fPjw4cOHf//73//ud79ra/tFDwwzLS0tg1txz7euvOqKPj/3PPvLnp6ejme/nHiQWGfNrp6edzbfU7m5o6f3QcezX74qsaSnp2fXQ72Ps3axZldPT++Gv9xceWVm4/c8+8uenl9urvzy5ncSyzIfp+x66Korku2kNumVqvZf1lzx0J4BlvTWn0NqtXc235Nev095GWV861/67LR/sxl7HGgvycPJKGzATTLOXsaS9La95e166KorkidtgNel7977HUXPLzdX9ttR9snMqCej/o5nv3xVVv17vnVluobszTOXDHg2MorsfZxxmFnnLfNtk/0q9HuDpcrLcfLT2+Z6H/Y5tBx7zDz5vWsOdCzf+pchn6vBGPSfP/zh+H3XkX4/5+Q7lMJHUeXm5vsmpX7ZvWbB/oiIg/sbG2vKJixOLi4b3x6f6r/hwf2x4qHUpKhJ81bEkh0dFRWj+682cWbV3C277pt0XWfDCzHzwcJoa41VD84qSj5796r45kudsz5//EKrnknUOXFmVeOWtoiiVAdY4tm2iOtmVM3ZunvRxEntO7aULniyKDpeaoma9cU16SYORmTO4urcVFW2uDFxiMUdcWnDC7H6wYm9z+/aWlO1oLWod/39zVFTM6G3vbaYNa5k+5yyleP2PXBdRESMLZ5aM/euksZjThfr3N9cubkmuaPRFQuqSrfuXjRxUsYaHXULJt+frGx8e0wqyty8cvOixLaps1dRGBFVCxMn/7ivS46j6DiwNVY9mFlAhuw3Q2f01l84a2Hl4m3ZW1V+NVlD9uaF40sbby9bOz75xst9NnLX0nuYnf1frLbW7Y3rJ5cuTe2nuCMmZr0bU8qSp2j052dMfaGlIyaO7v9mGHjb9KHl2GNknPyJd68q++aAjeRq8PjnChgsoRBOoj5hMSJOeOhq0rwVj27cG2NbEkEt2k5CcRERu9YWrytuat43OmL3mglbItIBNLYtHT99X2KtqasGymedm6rK9i/c11oT0V5315KIOLi/sWRmRvzqONAytaSy71Zlqxsfn9Unot3X2nzf7jUTiucknqp4srmio25BcWlj1TOppDhEHXULJrcsaG1+PKJzU9WSE2niOPofxe5tjeOnHyPF9nsz7F3ZGOOHsLv+76VYtK910d6VpRNuL1vRVHPjEFrq1f/Fioioerp14DR5TNlvhsHpt8f2uv0ntPsMxz5X2R+6gNzMKYST5dLxZesfPc79Mi4dH0u/mZ7TtnFpfPHG3P9jFd04s3nrppe2jp8+MSJibHHcvyQ1h2/vE/fHzM8XRlHJ+MatDe0RER0vbd0+iBI7DrREacnoiIi9W1K9XpPmrdi/be2W5hV3XxcRMXpcyfb71+/O3cDB/Y1l48dm7nHizKr1t2dMjhz9+RkZpUZE4fjSxsUbc8yenLRoX9Oq2PJS8myMrni89ZnKmm0DXb1bOL60d0cddY/XVM3IzAFvtzROLbk0IqJ9x5bG7M3Xb0lOUEudvT6O+7rkOIpJ0ytr5qwd4ERlvxkmzqxKL+nctG79AIc50ObJRh5oblwdWxvac5+NT5WUpU5g7+vbr4bMFyvGFk+teXygGyodT/abYRCy91h048xY+kTvq5N88Y53LGnHPVeDrAwQCuGkKZxV8/T4+8uOOcO9zzq3x9OJDrlcdzosnPbFlsUvzEgEtSiqePKZksVlidn0c+OZRJfVxLtXRWLhN1tKpg6ixNEVC6pq5haXTigu3RpVqaVFN85sXr8/HYOuu69pVcvt/S5qScqxx0mLGlc3z+29dqFPqWt3910hsaQjeb3ChMkvzHioorD3soA5sblfr9V1M6pSl25ktjP5hRlNfdecNG9FJE7sktbxZdmHXhnb+p29478uA+09eYVE5olKvNy96+d4M0xalF6yJL5YmVXhgPUUV9V19F5LUbbliw/OKsp9NnK/vpln6VgvVtYFOkU3zozsq0bScr39jrNJ5Npj4awHV+yfk1iydfyq5It33GMZ/LkCBqmgu7s7IhJTDtMP3nvv15dc8sl81wanVWtra3FxcT723LlpzY5pi/oPcnXULfhmPOiubCfD3pWlW2eaYfZRkK+3ff7+/CFvDncf7bdETyHkW/uOLVGSNYicc5QTAE4VoRDyrajiyb4joR11CwYY5QSAU8XwMSQZP4Jhy58/w5DhYwAAchAKAQAQCgEAEAoBAAihEACAEArhZNu7snSgrz7rY/earC+QOCEddQtOSjtZBnsgp7fBE2tk78rS7O+MAaAPoRDyY9Kifb6tZJB2rxn4a9MGZeIDzcmbPn7opgD+YAmFAAAIhTBke1eWTigunVBc2jv+21G3ILWkJWO1tbt3rS0unVBcunZ3dG6qmlBcOqG4qq4jIjK6rHavmbByV6rNNXv77Wz3mgkr6+ruSu1r95rkrtPtZEjtojS7M6z3qdQuMsvrXT/XgQxUTNbuUq0VZ4zVHrPB7Ko6N1Wlt00+3r1mwu01UTMn45Czys6x6/a6u6rqNq1JnPzkoHNGUxv+V1Xfo8468wDDjVAIQzXxgeZ9rc37WpufHn//+t0RsWvt5PtLNjfva23e91Bsreldc/3t22a0Nu9rWtVye+mSeHBfa3Pj6lj6RNbwZc2crTOb97U2P11V83j21LeaF+Kh5n1PVhTuXjPh9ni6tXlfa/O+pi9undwnx3RuqkrsYl9r89Mxp9/Eu8JZNYmnGlc3p3eRLK/1mcqadXUdxzqQ7GIix+6uuy9RW+szJYs37o3jN5izqv4mLdq3uSqqntnXWlMxeoCyi+dEYi+tjTO2lKWOvXHp/un7Wpvvm5SjqflfXlhZsy2ZRBteiNXzJmbvGmBYEQphyFK9X3NromV/e3QcaKl6Jpk8RlcsqOpdsXLzookRMXpcSVQtmFUUEYXjS3M0mNp84syqxv1tWc8uTIShzv3NyQaTO6rZmpH8Du5vbFxcNiGzsD6SfWllixvTu0i1dt2MqsbWt+MYB5JdTM7dpXr+5qyP5paOwTSYo6rjOlbZUVTx1ar1WxKxu2zF3dcN3Mx1M5InsH3HlpgxzddMA8PeOfkuAD5iOuoWTG5Z0Nr8eLJzLuLtlsYYl++yIiIqN2f0ivWxa23xuuKm5n2jI3avmbBlgO2HeCD9dte5qaps/8J9rTUR7XV3LRlEg4Or6pSZePeqx5/YFZ86sHX8wsdHn+69A5xx9BTC0Lzd0ji15NKIiPYdWxojIiZNT41jRnTUPZ5z1PVkKBxfuv721JBxR93jNVUzMjLZpePL1j86wL1pOg60RGnJ6IiIvVsGrm8oB5K9u4P7G8vGj42I6Hhp6/ZBNJirqsLxpY1bXuqM6D29xzV6XElNeri8ve7RmsqZx+ggzNzw8zP2b6treKEkuf6utWYWAsOZUAhDM2neiri/rLh0QvGS1vFlERFx3X2bS5dOLp1QXDrhmzEj56jrydn1osbVzXMTV1RMfmFG06LMaXCFs2qeHp8oLOsylNEVC6pqEhtujWPUN4QDyd7dxLtXRWJA+ZstJVMH0WDOqnKc3kS4nJPz2prkXppWtdyeqKRs68zGAbpLs5squnFm89ItX6w8xvoAw0dBd3d3RPT09PT09KQfvPfery+55JP5rg1Oq9bW1uLi4nxXwemUuDoneQtDhjN//gxDh7uP9ltiTiEwXO1avzhmNEmEABFh+BgYljo3VU0onhObk7e5AUBPITAcFc6q2Tcr30UAnFH0FAIAIBQCACAUAgAQQiEAACEUAgAQQiEAACEUAgAQQiEAACEUAgAQQiEAACEUAgAQQiEAACEUAgAQQiEAACEUAgAQQm+nwrIAAAWJSURBVCEAACEUAgAQQiEAACEUAgAQQiEAACEUAgAQQiGk9fT05LsEID/8+UMIhZA2YsSII0eO5LsK4HQ7cuTIiBEj8l0F5J9QCEkXX3zxwYMH5UIYVo4cOXLw4MGLL74434VA/p2T7wLgTDFy5MhELiwoKBg5cmS+ywFOua6urp6enosvvtifPIRQCJk+9rGPXX755V1dXR988EG+awFOufPPP18chDShEPobOXKk/ycAGG7MKQQAQCgEAEAoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAghEIAAEIoBAAgMkNhQUFBHusAACCPBuopFBABAIYRw8cAAMRZRo0BANBTCACAUAgAgFAIAEDkDIVmGQIADDd6CgEASIVCvYMAAMNZ/55C6RAAYBgyfAwAQN9QqJsQAGB4OityZUHhEABgWDF8DABARihM9xcaRAYAGG5cfQwAwAD3KZQMAQCGlbMy46BuQgCA4cl3HwMAkHFLmsx/I+RCAIBhxC1pAADoe6FJ385CAACGC7ekAQAg4+pjcRAAYNg6JyIKCgp6enrSDxLp8HD30TyXBgDA6VJw5MiRiEiEwswHHxx1DQoAwHDR/xtNDCIDAAxDvd2BmblQNAQAGFZ8zR0AAPH/AdeDhvRafM3YAAAAAElFTkSuQmCC"},1151:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>o});var s=r(7294);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);